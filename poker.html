<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ†ã‚­ã‚µã‚¹ãƒ›ãƒ¼ãƒ«ãƒ‡ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f4c29 0%, #1a5f3f 100%);
            min-height: 100vh;
            min-width: 1440px;
            overflow-x: auto;
            overflow-y: auto;
        }

        /* é›£æ˜“åº¦é¸æŠç”»é¢ */
        .screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .screen-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 400px;
        }

        h1 {
            color: #0f4c29;
            margin-bottom: 10px;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #666;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .difficulty-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }

        .difficulty-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 25px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            font-size: 1em;
        }

        .difficulty-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .difficulty-btn.easy:hover { border-color: #4caf50; }
        .difficulty-btn.normal:hover { border-color: #ff9800; }
        .difficulty-btn.hard:hover { border-color: #f44336; }

        .diff-icon { font-size: 2em; }
        .diff-name {
            font-size: 1em;
            font-weight: bold;
            color: #333;
        }
        .diff-desc {
            font-size: 0.9em;
            color: #666;
        }

        /* ã‚²ãƒ¼ãƒ ç”»é¢ */
        #gameScreen {
            display: none;
            padding: 20px;
            width: 1400px;
            min-width: 1400px;
            min-height: 900px;
            margin: 0 auto;
            overflow: visible;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px 25px;
            border-radius: 10px;
        }

        .game-title {
            color: #ffd700;
            font-size: 1.8em;
            font-weight: bold;
        }

        .info-toggle-btn {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            border: 1px solid #ffd700;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .info-toggle-btn:hover {
            background: rgba(255, 215, 0, 0.4);
            transform: translateY(-2px);
        }

        .sound-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sound-toggle {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: all 0.3s;
        }

        .sound-toggle.off {
            background: #f44336;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            font-size: 1em;
        }

        .volume-slider {
            width: 100px;
        }

        /* ãƒãƒ¼ã‚«ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ« */
        .poker-table {
            background: radial-gradient(ellipse at center, #2d5016 0%, #1a3d0f 100%);
            border: 15px solid #8b4513;
            border-radius: 50%;
            width: 1000px;
            height: 625px;
            margin: 0 auto 30px;
            position: relative;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), inset 0 0 50px rgba(0, 0, 0, 0.3);
        }

        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é…ç½® */
        .player-seat {
            position: absolute;
            width: 350px;
            text-align: center;
        }

        .player-seat.seat-0 { bottom: -90px; left: 50%; transform: translateX(-50%); z-index: 10; }
        .player-seat.seat-1 { bottom: 18%; left: -2%; }
        .player-seat.seat-2 { top: 12%; left: 2%; }
        .player-seat.seat-3 { top: 12%; right: 2%; }
        .player-seat.seat-4 { bottom: 18%; right: -2%; }

        .player-info {
            background: rgba(0, 0, 0, 0.85);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 12px 15px;
            margin-bottom: 10px;
            transition: all 0.3s;
            position: relative;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 12px;
        }

        .player-info-column {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
            flex: 1;
            min-width: 0;
            max-width: 150px;
        }

        .player-info.active {
            border-color: #4caf50;
            box-shadow: 0 0 25px rgba(76, 175, 80, 0.6);
            animation: pulse-border 1.5s infinite;
            transform: scale(1.05);
        }

        @keyframes pulse-border {
            0%, 100% {
                border-color: #4caf50;
                box-shadow: 0 0 25px rgba(76, 175, 80, 0.6);
            }
            50% {
                border-color: #8bc34a;
                box-shadow: 0 0 35px rgba(139, 195, 74, 0.8);
            }
        }

        .turn-indicator {
            position: absolute;
            top: -33px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            white-space: nowrap;
            animation: turnIndicatorPulse 1.5s ease-in-out infinite;
            box-shadow: 0 3px 12px rgba(76, 175, 80, 0.6);
            border: 1px solid white;
            z-index: 250;
        }

        @keyframes turnIndicatorPulse {
            0%, 100% {
                transform: translateX(-50%) scale(1);
                box-shadow: 0 3px 12px rgba(76, 175, 80, 0.6);
            }
            50% {
                transform: translateX(-50%) scale(1.05);
                box-shadow: 0 5px 18px rgba(76, 175, 80, 0.8);
            }
        }

        .player-info.folded {
            opacity: 0.4;
            border-color: #666;
        }

        .player-info.all-in {
            border-color: #ff5722;
            box-shadow: 0 0 20px rgba(255, 87, 34, 0.6);
        }

        .player-avatar {
            font-size: 2.5em;
            filter: drop-shadow(2px 2px 3px rgba(0, 0, 0, 0.5));
            flex-shrink: 0;
        }

        .player-name {
            color: #ffd700;
            font-weight: bold;
            font-size: 1.15em;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            white-space: nowrap;
        }

        .player-chips {
            color: #fff;
            font-size: 1.15em;
            font-weight: 500;
        }

        .player-bet {
            background: rgba(255, 152, 0, 0.4);
            color: #ffeb3b;
            padding: 6px 12px;
            border-radius: 10px;
            font-size: 1.3em;
            font-weight: bold;
            border: 1px solid rgba(255, 215, 0, 0.5);
            box-shadow: 0 2px 8px rgba(255, 152, 0, 0.4);
        }

        .player-status {
            color: #4caf50;
            font-size: 0.9em;
            font-style: italic;
            font-weight: bold;
        }

        .action-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            white-space: nowrap;
            animation: actionPop 0.5s ease-out;
            pointer-events: none;
            z-index: 100;
            border: 1px solid white;
        }

        @keyframes actionPop {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.15);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .action-indicator.fold { background: #f44336; }
        .action-indicator.call { background: #2196f3; }
        .action-indicator.raise { background: #ff9800; }
        .action-indicator.check { background: #4caf50; }
        .action-indicator.allin { background: #9c27b0; }

        .winner-glow {
            animation: winnerGlow 1s ease-in-out 3;
            border-color: #ffd700 !important;
        }

        @keyframes winnerGlow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            }
            50% {
                box-shadow: 0 0 40px rgba(255, 215, 0, 1);
            }
        }

        .win-badge {
            position: absolute;
            top: -55px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #000;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1.4em;
            font-weight: bold;
            white-space: nowrap;
            animation: winBadgeAppear 0.6s ease-out;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.6);
            border: 2px solid #fff;
            z-index: 300;
        }

        @keyframes winBadgeAppear {
            0% {
                opacity: 0;
                transform: translateX(-50%) scale(0.3) translateY(30px);
            }
            60% {
                transform: translateX(-50%) scale(1.2) translateY(0);
            }
            100% {
                opacity: 1;
                transform: translateX(-50%) scale(1) translateY(0);
            }
        }

        .hand-badge {
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            color: #ffd700;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 1.1em;
            font-weight: bold;
            white-space: nowrap;
            animation: handBadgeAppear 0.8s ease-out;
            border: 1px solid #ffd700;
            z-index: 150;
        }

        @keyframes handBadgeAppear {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            100% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .chip-animation {
            position: absolute;
            font-size: 3.5em;
            animation: chipToPot 1.2s ease-in-out forwards;
            pointer-events: none;
            z-index: 50;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.8));
        }

        @keyframes chipToPot {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0.5);
            }
        }

        .dealer-button {
            background: white;
            color: #0f4c29;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1em;
            position: absolute;
            top: -15px;
            right: -15px;
            border: 1px solid #ffd700;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .blind-indicator {
            position: absolute;
            top: -12px;
            left: -12px;
            background: linear-gradient(135deg, #f44336 0%, #e53935 100%);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            border: 1px solid white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
            z-index: 10;
        }

        /* ã‚«ãƒ¼ãƒ‰è¡¨ç¤º */
        .player-cards {
            display: flex;
            gap: 5px;
            justify-content: center;
            flex-shrink: 0;
        }

        .card {
            width: 65px;
            height: 90px;
            background: white;
            border: 1px solid #333;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.3em;
            box-shadow: 0 3px 7px rgba(0, 0, 0, 0.5);
            position: relative;
            transition: transform 0.3s ease;
            /* animation removed - only animate when explicitly adding animation classes */
        }

        @keyframes cardAppear {
            from {
                opacity: 0;
                transform: scale(0.3) translateY(-50px) rotateY(90deg);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0) rotateY(0deg);
            }
        }

        .card.deal-animation {
            animation: cardDeal 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes cardDeal {
            0% {
                opacity: 0;
                transform: translate(var(--deal-from-x, 0px), var(--deal-from-y, 150px)) scale(0.5) rotate(-20deg);
            }
            60% {
                opacity: 1;
                transform: translate(0, 0) scale(1.1) rotate(3deg);
            }
            100% {
                opacity: 1;
                transform: translate(0, 0) scale(1) rotate(0deg);
            }
        }

        .card.initial-deal {
            animation: cardInitialDeal 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes cardInitialDeal {
            0% {
                opacity: 0;
                transform: translate(var(--deal-from-x, 0px), var(--deal-from-y, 150px)) rotate(-180deg) scale(0.5);
            }
            70% {
                opacity: 1;
                transform: translate(0, 0) rotate(10deg) scale(1.1);
            }
            100% {
                opacity: 1;
                transform: translate(0, 0) rotate(0deg) scale(1);
            }
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card.back {
            background:
                repeating-linear-gradient(45deg, #1e3c72 0px, #1e3c72 10px, #2a5298 10px, #2a5298 20px),
                repeating-linear-gradient(-45deg, #2a5298 0px, #2a5298 10px, #1e3c72 10px, #1e3c72 20px);
            border: 3px solid #4a6fa5;
            position: relative;
            overflow: hidden;
        }

        .card.back::before {
            content: 'â™ â™¥â™¦â™£';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5em;
            color: rgba(255, 255, 255, 0.3);
            letter-spacing: 3px;
        }

        .card.back::after {
            content: '';
            position: absolute;
            width: 40px;
            height: 40px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .card.hearts, .card.diamonds {
            color: #e53935;
        }

        .card.spades, .card.clubs {
            color: #212121;
        }

        .card-suit {
            font-size: 1.1em;
        }

        .card-value {
            font-size: 1.4em;
        }

        /* ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚«ãƒ¼ãƒ‰ */
        .community-cards {
            position: absolute;
            top: 45%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 12px;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            min-height: 130px;
            align-items: center;
            border: 1px dashed rgba(255, 255, 255, 0.2);
        }

        .card-placeholder {
            width: 80px;
            height: 110px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px dashed rgba(255, 255, 255, 0.3);
            border-radius: 5px;
        }

        .community-cards .card {
            width: 80px;
            height: 110px;
            font-size: 1.5em;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.5);
        }

        .community-cards .card .card-value {
            font-size: 1.6em;
        }

        /* ãƒãƒƒãƒˆ */
        .pot-display {
            position: absolute;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 15px 30px;
            color: #ffd700;
            font-size: 1.5em;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        /* ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰æƒ…å ± */
        .blinds-info {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #ff9800;
            border-radius: 10px;
            padding: 12px 20px;
            color: white;
            font-size: 0.95em;
        }

        .blinds-info div {
            margin: 2px 0;
        }

        .blinds-label {
            color: #ffd700;
            font-weight: bold;
        }

        /* ãƒˆãƒ©ãƒ³ãƒ—ã®å±± */
        .deck-area {
            position: absolute;
            top: 65%;
            left: 50%;
            transform: translateX(-50%);
        }

        .deck-stack {
            position: relative;
            width: 53px;
            height: 73px;
        }

        .deck-card {
            position: absolute;
            width: 53px;
            height: 73px;
            background: repeating-linear-gradient(45deg, #1e3c72 0px, #1e3c72 7px, #2a5298 7px, #2a5298 14px);
            border: 2px solid #4a6fa5;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .deck-card:nth-child(1) { top: 0; left: 0; }
        .deck-card:nth-child(2) { top: 1px; left: 1px; }
        .deck-card:nth-child(3) { top: 2px; left: 2px; }

        /* ãƒ•ã‚§ãƒ¼ã‚ºã‚¢ãƒŠã‚¦ãƒ³ã‚¹ãƒ¡ãƒ³ãƒˆ */
        .phase-announcement {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 500;
            pointer-events: none;
            display: none;
        }

        .phase-announcement.show {
            display: block;
            animation: phaseIn 2s ease-out forwards;
        }

        .phase-text {
            font-size: 4em;
            font-weight: 900;
            color: #ffd700;
            text-shadow:
                0 0 20px rgba(255, 215, 0, 0.8),
                0 0 40px rgba(255, 215, 0, 0.4),
                3px 3px 6px rgba(0, 0, 0, 0.8);
            letter-spacing: 8px;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .phase-sub {
            font-size: 1.2em;
            color: white;
            text-align: center;
            margin-top: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            letter-spacing: 4px;
        }

        .phase-announcement.showdown .phase-text {
            font-size: 4.5em;
            color: #ff4444;
            text-shadow:
                0 0 30px rgba(255, 68, 68, 0.8),
                0 0 60px rgba(255, 68, 68, 0.4),
                3px 3px 6px rgba(0, 0, 0, 0.8);
            animation: showdownPulse 0.5s ease-in-out 3;
        }

        @keyframes phaseIn {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(3);
            }
            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            70% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
        }

        @keyframes showdownPulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.15);
            }
        }

        /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ‘ãƒãƒ« */
        .action-panel {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 20px;
            max-width: 400px;
            margin: 0 auto;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .action-btn {
            flex: 1;
            min-width: 80px;
            padding: 15px 20px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .action-btn.fold {
            background: #f44336;
            color: white;
        }

        .action-btn.check {
            background: #4caf50;
            color: white;
        }

        .action-btn.call {
            background: #2196f3;
            color: white;
        }

        .action-btn.raise {
            background: #ff9800;
            color: white;
        }

        .action-btn.all-in {
            background: #9c27b0;
            color: white;
        }

        .action-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .raise-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .raise-amount {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 10px;
        }

        .amount-display {
            color: #ffd700;
            font-size: 1.5em;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
        }

        .amount-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
        }

        .amount-btn:hover {
            background: #45a049;
        }

        .increment-selector {
            display: flex;
            gap: 10px;
        }

        .increment-radio {
            display: none;
        }

        .increment-label {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }

        .increment-radio:checked + .increment-label {
            background: #ffd700;
            color: #333;
        }

        /* ã‚²ãƒ¼ãƒ ãƒ­ã‚° */
        .game-log {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #666;
            border-radius: 10px;
            padding: 15px;
            max-width: 400px;
            margin: 20px auto;
            max-height: 180px;
            overflow-y: auto;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5);
            display: none;
        }

        .game-log.visible {
            display: block;
        }

        .log-entry {
            color: #e0e0e0;
            padding: 6px 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            font-size: 0.95em;
            line-height: 1.4;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-entry:first-child {
            color: #ffeb3b;
            font-weight: 500;
        }

        /* ãƒãƒ³ãƒ‰ãƒ©ãƒ³ã‚­ãƒ³ã‚° */
        .hand-ranking {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #ffd700;
            border-radius: 10px;
            padding: 15px;
            max-width: 520px;
            margin: 20px auto;
            color: white;
            display: none;
        }

        .hand-ranking.visible {
            display: block;
        }

        .hand-ranking h3 {
            color: #ffd700;
            margin-bottom: 10px;
            text-align: center;
            font-size: 1.5em;
        }

        .hand-list {
            font-size: 0.9em;
            line-height: 1.4;
        }

        .hand-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hand-row:last-child {
            border-bottom: none;
        }

        .hand-row-name {
            flex-shrink: 0;
            width: 170px;
        }

        .hand-row-cards {
            display: flex;
            gap: 3px;
        }

        .mini-card {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 38px;
            background: white;
            border-radius: 3px;
            font-size: 0.75em;
            font-weight: bold;
            line-height: 1;
            flex-direction: column;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
        }

        .mini-card.red { color: #e53935; }
        .mini-card.black { color: #212121; }

        .back-btn {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 30px;
            background: #e0e0e0;
            color: #333;
            text-decoration: none;
            border-radius: 50px;
            transition: all 0.3s;
            font-weight: bold;
            font-size: 1em;
        }

        .back-btn:hover {
            background: #d0d0d0;
            transform: translateY(-2px);
        }

        /* ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒœã‚¿ãƒ³ */
        .tutorial-btn {
            display: inline-block;
            margin-top: 15px;
            padding: 12px 30px;
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-size: 1em;
        }

        .tutorial-btn:hover {
            background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }

        /* ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1100;
        }

        .tutorial-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .tutorial-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .tutorial-header h2 {
            color: #0f4c29;
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .tutorial-progress {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e0e0e0;
            transition: all 0.3s;
        }

        .progress-dot.active {
            background: #2196f3;
            transform: scale(1.2);
        }

        .tutorial-step {
            display: none;
            animation: tutorialFadeIn 0.4s ease-out;
        }

        .tutorial-step.active {
            display: block;
        }

        @keyframes tutorialFadeIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .tutorial-step h3 {
            color: #0f4c29;
            font-size: 1.4em;
            margin-bottom: 15px;
            border-bottom: 2px solid #4caf50;
            padding-bottom: 8px;
        }

        .tutorial-step p {
            color: #333;
            font-size: 1em;
            line-height: 1.8;
            margin-bottom: 12px;
        }

        .tutorial-step .highlight {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
            font-size: 0.95em;
        }

        .tutorial-step .hand-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 0.9em;
        }

        .tutorial-step .hand-table th {
            background: #0f4c29;
            color: #ffd700;
            padding: 8px 12px;
            text-align: left;
        }

        .tutorial-step .hand-table td {
            padding: 8px 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .tutorial-step .hand-table tr:nth-child(even) {
            background: #f5f5f5;
        }

        .tutorial-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }

        .tutorial-nav-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: all 0.3s;
        }

        .tutorial-nav-btn.prev {
            background: #e0e0e0;
            color: #333;
        }

        .tutorial-nav-btn.next {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
            color: white;
        }

        .tutorial-nav-btn.close {
            background: linear-gradient(135deg, #0f4c29 0%, #1a5f3f 100%);
            color: white;
        }

        .tutorial-nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .tutorial-nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* çµæœç”»é¢ */
        .result-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        /* æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸ã®å¾…æ©Ÿã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        .next-round-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 900;
            cursor: pointer;
        }

        .next-round-message {
            background: linear-gradient(135deg, #1a5f3f 0%, #0f4c29 100%);
            padding: 40px 60px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid #ffd700;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            animation: messageFloat 2s ease-in-out infinite;
        }

        @keyframes messageFloat {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .next-round-message h2 {
            color: #ffd700;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .next-round-message p {
            color: white;
            font-size: 1.2em;
            margin: 10px 0;
        }

        .click-hint {
            color: #ffeb3b;
            font-size: 1.5em;
            margin-top: 20px;
            animation: blink 1.5s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.3;
            }
        }

        .result-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
        }

        .result-title {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .result-message {
            font-size: 1.3em;
            color: #666;
            margin-bottom: 20px;
        }

        .result-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .result-btn {
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .result-btn.primary {
            background: linear-gradient(135deg, #0f4c29 0%, #1a5f3f 100%);
            color: white;
        }

        .result-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 1050px) {
            .poker-table {
                width: 900px;
                height: 562px;
            }
        }

        @media (max-width: 950px) {
            .poker-table {
                width: 800px;
                height: 500px;
            }

            .player-seat {
                width: 100px;
            }

            .card {
                width: 30px;
                height: 42px;
                font-size: 0.6em;
            }

            .community-cards {
                gap: 5px;
                padding: 7px 10px;
            }

            .community-cards .card {
                width: 37px;
                height: 51px;
            }

            .pot-display {
                font-size: 0.8em;
                padding: 7px 13px;
            }

            .blinds-info {
                font-size: 0.57em;
                padding: 5px 10px;
            }

            .player-name {
                font-size: 0.67em;
            }

            .player-chips {
                font-size: 0.67em;
            }

            .player-avatar {
                font-size: 1.33em;
            }

            .action-indicator {
                font-size: 0.53em;
                padding: 4px 7px;
            }
        }

        @media (max-width: 600px) {
            .card {
                width: 25px;
                height: 35px;
            }

            .community-cards .card {
                width: 30px;
                height: 42px;
            }

            .player-seat {
                width: 80px;
            }

            .blinds-info {
                top: 7px;
                right: 7px;
                font-size: 0.5em;
                padding: 4px 7px;
            }

            .player-avatar {
                font-size: 1.2em;
            }

            .action-indicator {
                font-size: 0.47em;
                padding: 3px 5px;
            }
        }

        /* ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é–‹å§‹ãƒœã‚¿ãƒ³ */
        .tutorial-start-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed #ccc;
            text-align: center;
        }

        .tutorial-start-btn {
            background: linear-gradient(135deg, #4caf50, #388e3c);
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .tutorial-start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.6);
        }

        /* ã‚¬ã‚¤ãƒ‰ãƒ€ã‚¤ã‚¢ãƒ­ã‚° */
        .guide-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1100;
        }

        .guide-dialog {
            background: white;
            border-radius: 16px;
            padding: 30px 35px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            text-align: center;
            animation: guideAppear 0.3s ease-out;
        }

        @keyframes guideAppear {
            from { opacity: 0; transform: scale(0.9) translateY(-20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .guide-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #0f4c29;
            margin-bottom: 15px;
        }

        .guide-text {
            font-size: 1em;
            color: #444;
            line-height: 1.7;
            margin-bottom: 20px;
            text-align: left;
        }

        .guide-ok-btn {
            background: linear-gradient(135deg, #0f4c29, #1a5f3f);
            color: white;
            border: none;
            padding: 12px 40px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .guide-ok-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(15, 76, 41, 0.4);
        }

        .guide-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .guide-retry-btn {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .guide-retry-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
        }
    </style>
</head>
<body>
    <!-- é›£æ˜“åº¦é¸æŠç”»é¢ -->
    <div id="difficultyScreen" class="screen">
        <div class="screen-container">
            <h1>ğŸ° ãƒ†ã‚­ã‚µã‚¹ãƒ›ãƒ¼ãƒ«ãƒ‡ãƒ </h1>
            <h2>é›£æ˜“åº¦ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
            <div class="difficulty-buttons">
                <button class="difficulty-btn easy" onclick="startGame('easy')">
                    <span class="diff-icon">ğŸ˜Š</span>
                    <span class="diff-name">åˆç´š</span>
                    <span class="diff-desc">ã‚¿ã‚¤ãƒˆãƒ—ãƒ¬ã‚¤ - å¼·ã„æ‰‹ã®ã¿</span>
                </button>
                <button class="difficulty-btn normal" onclick="startGame('normal')">
                    <span class="diff-icon">ğŸ¤”</span>
                    <span class="diff-name">ä¸­ç´š</span>
                    <span class="diff-desc">ãƒãƒ©ãƒ³ã‚¹å‹ - é©åº¦ã«ãƒ–ãƒ©ãƒ•</span>
                </button>
                <button class="difficulty-btn hard" onclick="startGame('hard')">
                    <span class="diff-icon">ğŸ§ </span>
                    <span class="diff-name">ä¸Šç´š</span>
                    <span class="diff-desc">ã‚¢ã‚°ãƒ¬ãƒƒã‚·ãƒ– - ãƒ–ãƒ©ãƒ•å¤šç”¨</span>
                </button>
            </div>
            <button class="tutorial-btn" onclick="showTutorial()">ğŸ“– éŠã³æ–¹</button>
            <br>
            <a href="index.html" class="back-btn">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</a>
        </div>
    </div>

    <!-- ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« -->
    <div class="tutorial-overlay" id="tutorialOverlay">
        <div class="tutorial-content">
            <div class="tutorial-header">
                <h2>ğŸ“– ãƒ†ã‚­ã‚µã‚¹ãƒ›ãƒ¼ãƒ«ãƒ‡ãƒ  éŠã³æ–¹</h2>
                <div class="tutorial-progress" id="tutorialProgress"></div>
            </div>

            <div class="tutorial-step" data-step="0">
                <h3>ğŸ¯ ã‚²ãƒ¼ãƒ ã®ç›®çš„</h3>
                <p>ãƒ†ã‚­ã‚µã‚¹ãƒ›ãƒ¼ãƒ«ãƒ‡ãƒ ã¯ã€<strong>2æšã®æ‰‹æœ­</strong>ã¨<strong>5æšã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚«ãƒ¼ãƒ‰</strong>ï¼ˆå ´æœ­ï¼‰ã‚’çµ„ã¿åˆã‚ã›ã¦ã€æœ€ã‚‚å¼·ã„5æšã®å½¹ã‚’ä½œã‚‹ãƒãƒ¼ã‚«ãƒ¼ã‚²ãƒ¼ãƒ ã§ã™ã€‚</p>
                <div class="highlight">
                    ğŸƒ æ‰‹æœ­2æš ï¼‹ å ´æœ­5æš ï¼ åˆè¨ˆ7æšã‹ã‚‰æœ€å¼·ã®5æšã‚’é¸ã¶ï¼
                </div>
                <p>ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å…¨å“¡ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã•ã›ã‚‹ã‹ã€ã‚·ãƒ§ãƒ¼ãƒ€ã‚¦ãƒ³ã§æœ€å¼·ã®å½¹ã‚’æŒã£ã¦ã„ã‚Œã°ãƒãƒƒãƒˆï¼ˆè³­ã‘é‡‘ã®åˆè¨ˆï¼‰ã‚’ç²å¾—ã§ãã¾ã™ã€‚</p>
            </div>

            <div class="tutorial-step" data-step="1">
                <h3>ğŸ”„ ã‚²ãƒ¼ãƒ ã®æµã‚Œ</h3>
                <p>1ãƒ©ã‚¦ãƒ³ãƒ‰ã¯4ã¤ã®ãƒ•ã‚§ãƒ¼ã‚ºã§é€²è¡Œã—ã¾ã™ã€‚å„ãƒ•ã‚§ãƒ¼ã‚ºã§ãƒ™ãƒƒãƒ†ã‚£ãƒ³ã‚°ï¼ˆè³­ã‘ï¼‰ãŒè¡Œã‚ã‚Œã¾ã™ã€‚</p>
                <div class="highlight">
                    <strong>â‘  ãƒ—ãƒªãƒ•ãƒ­ãƒƒãƒ—</strong> - æ‰‹æœ­2æšãŒé…ã‚‰ã‚Œã‚‹<br>
                    <strong>â‘¡ ãƒ•ãƒ­ãƒƒãƒ—</strong> - å ´ã«3æšã®ã‚«ãƒ¼ãƒ‰ãŒå…¬é–‹<br>
                    <strong>â‘¢ ã‚¿ãƒ¼ãƒ³</strong> - å ´ã«4æšç›®ã®ã‚«ãƒ¼ãƒ‰ãŒå…¬é–‹<br>
                    <strong>â‘£ ãƒªãƒãƒ¼</strong> - å ´ã«5æšç›®ï¼ˆæœ€å¾Œï¼‰ã®ã‚«ãƒ¼ãƒ‰ãŒå…¬é–‹
                </div>
                <p>ãƒªãƒãƒ¼ã®ãƒ™ãƒƒãƒ†ã‚£ãƒ³ã‚°å¾Œã€æ®‹ã£ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§<strong>ã‚·ãƒ§ãƒ¼ãƒ€ã‚¦ãƒ³</strong>ï¼ˆæ‰‹æœ­å…¬é–‹ï¼‰ã‚’è¡Œã„ã€æœ€å¼·ã®å½¹ã‚’æŒã¤ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå‹åˆ©ã—ã¾ã™ã€‚</p>
            </div>

            <div class="tutorial-step" data-step="2">
                <h3>ğŸ® ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆè¡Œå‹•ï¼‰</h3>
                <p>å„ãƒ•ã‚§ãƒ¼ã‚ºã§è‡ªåˆ†ã®ã‚¿ãƒ¼ãƒ³ãŒæ¥ãŸã‚‰ã€ä»¥ä¸‹ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸ã¹ã¾ã™ã€‚</p>
                <div class="highlight">
                    <strong>ğŸŸ¥ ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰</strong> - é™ã‚Šã‚‹ï¼ˆã“ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã‚’æ”¾æ£„ï¼‰<br><br>
                    <strong>ğŸŸ© ãƒã‚§ãƒƒã‚¯</strong> - ãƒ‘ã‚¹ã™ã‚‹ï¼ˆèª°ã‚‚ãƒ™ãƒƒãƒˆã—ã¦ã„ãªã„æ™‚ã®ã¿ï¼‰<br><br>
                    <strong>ğŸŸ¦ ã‚³ãƒ¼ãƒ«</strong> - ç›¸æ‰‹ã®ãƒ™ãƒƒãƒˆã«åˆã‚ã›ã‚‹<br><br>
                    <strong>ğŸŸ§ ãƒ¬ã‚¤ã‚º</strong> - ãƒ™ãƒƒãƒˆé¡ã‚’å¼•ãä¸Šã’ã‚‹<br><br>
                    <strong>ğŸŸª ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³</strong> - æŒã¡ãƒãƒƒãƒ—å…¨é¡ã‚’è³­ã‘ã‚‹
                </div>
            </div>

            <div class="tutorial-step" data-step="3">
                <h3>ğŸ† å½¹ä¸€è¦§ï¼ˆå¼·ã„é †ï¼‰</h3>
                <table class="hand-table">
                    <tr><th>å½¹å</th><th>ä¾‹</th><th>èª¬æ˜</th></tr>
                    <tr><td>ğŸ¥‡ ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ•ãƒ©ãƒƒã‚·ãƒ¥</td><td><div class="hand-row-cards"><span class="mini-card black">A<br>â™ </span><span class="mini-card black">K<br>â™ </span><span class="mini-card black">Q<br>â™ </span><span class="mini-card black">J<br>â™ </span><span class="mini-card black">10<br>â™ </span></div></td><td>åŒã˜ãƒãƒ¼ã‚¯ã®A-K-Q-J-10</td></tr>
                    <tr><td>ğŸ¥ˆ ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥</td><td><div class="hand-row-cards"><span class="mini-card red">9<br>â™¥</span><span class="mini-card red">8<br>â™¥</span><span class="mini-card red">7<br>â™¥</span><span class="mini-card red">6<br>â™¥</span><span class="mini-card red">5<br>â™¥</span></div></td><td>åŒã˜ãƒãƒ¼ã‚¯ã®é€£ç¶š5æš</td></tr>
                    <tr><td>ğŸ¥‰ ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰</td><td><div class="hand-row-cards"><span class="mini-card black">K<br>â™ </span><span class="mini-card red">K<br>â™¥</span><span class="mini-card red">K<br>â™¦</span><span class="mini-card black">K<br>â™£</span><span class="mini-card black">3<br>â™ </span></div></td><td>åŒã˜æ•°å­—ãŒ4æš</td></tr>
                    <tr><td>ãƒ•ãƒ«ãƒã‚¦ã‚¹</td><td><div class="hand-row-cards"><span class="mini-card red">Q<br>â™¥</span><span class="mini-card black">Q<br>â™£</span><span class="mini-card red">Q<br>â™¦</span><span class="mini-card black">8<br>â™ </span><span class="mini-card red">8<br>â™¥</span></div></td><td>ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ï¼‹ãƒ¯ãƒ³ãƒšã‚¢</td></tr>
                    <tr><td>ãƒ•ãƒ©ãƒƒã‚·ãƒ¥</td><td><div class="hand-row-cards"><span class="mini-card red">A<br>â™¦</span><span class="mini-card red">J<br>â™¦</span><span class="mini-card red">9<br>â™¦</span><span class="mini-card red">6<br>â™¦</span><span class="mini-card red">3<br>â™¦</span></div></td><td>åŒã˜ãƒãƒ¼ã‚¯ã®5æš</td></tr>
                    <tr><td>ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ</td><td><div class="hand-row-cards"><span class="mini-card red">10<br>â™¥</span><span class="mini-card black">9<br>â™£</span><span class="mini-card red">8<br>â™¦</span><span class="mini-card black">7<br>â™ </span><span class="mini-card red">6<br>â™¥</span></div></td><td>é€£ç¶šã™ã‚‹æ•°å­—ã®5æš</td></tr>
                    <tr><td>ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰</td><td><div class="hand-row-cards"><span class="mini-card black">J<br>â™ </span><span class="mini-card red">J<br>â™¥</span><span class="mini-card black">J<br>â™£</span><span class="mini-card red">9<br>â™¦</span><span class="mini-card black">4<br>â™ </span></div></td><td>åŒã˜æ•°å­—ãŒ3æš</td></tr>
                    <tr><td>ãƒ„ãƒ¼ãƒšã‚¢</td><td><div class="hand-row-cards"><span class="mini-card red">A<br>â™¥</span><span class="mini-card black">A<br>â™£</span><span class="mini-card red">7<br>â™¦</span><span class="mini-card black">7<br>â™ </span><span class="mini-card red">2<br>â™¥</span></div></td><td>ãƒšã‚¢ãŒ2çµ„</td></tr>
                    <tr><td>ãƒ¯ãƒ³ãƒšã‚¢</td><td><div class="hand-row-cards"><span class="mini-card black">10<br>â™ </span><span class="mini-card red">10<br>â™¦</span><span class="mini-card red">K<br>â™¥</span><span class="mini-card black">5<br>â™£</span><span class="mini-card red">3<br>â™¦</span></div></td><td>åŒã˜æ•°å­—ãŒ2æš</td></tr>
                    <tr><td>ãƒã‚¤ã‚«ãƒ¼ãƒ‰</td><td><div class="hand-row-cards"><span class="mini-card black">A<br>â™ </span><span class="mini-card red">J<br>â™¥</span><span class="mini-card black">8<br>â™£</span><span class="mini-card red">5<br>â™¦</span><span class="mini-card red">2<br>â™¥</span></div></td><td>å½¹ãªã—ï¼ˆä¸€ç•ªé«˜ã„ã‚«ãƒ¼ãƒ‰ï¼‰</td></tr>
                </table>
            </div>

            <div class="tutorial-step" data-step="4">
                <h3>ğŸ’° ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ã¨ãƒãƒƒãƒˆ</h3>
                <p>å„ãƒ©ã‚¦ãƒ³ãƒ‰ã®é–‹å§‹æ™‚ã«ã€2äººã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå¼·åˆ¶ãƒ™ãƒƒãƒˆï¼ˆãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ï¼‰ã‚’æ”¯æ‰•ã„ã¾ã™ã€‚</p>
                <div class="highlight">
                    <strong>SBï¼ˆã‚¹ãƒ¢ãƒ¼ãƒ«ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ï¼‰</strong> - ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã®å·¦éš£ã€‚æœ€ä½è³­ã‘é¡ã®åŠåˆ†ã‚’æ”¯æ‰•ã†<br><br>
                    <strong>BBï¼ˆãƒ“ãƒƒã‚°ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ï¼‰</strong> - SBã®å·¦éš£ã€‚æœ€ä½è³­ã‘é¡ã‚’æ”¯æ‰•ã†
                </div>
                <p>å…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ™ãƒƒãƒˆã¯<strong>ãƒãƒƒãƒˆ</strong>ã«é›†ã‚ã‚‰ã‚Œã€ãƒ©ã‚¦ãƒ³ãƒ‰ã®å‹è€…ãŒãƒãƒƒãƒˆå…¨é¡ã‚’ç²å¾—ã—ã¾ã™ã€‚</p>
                <p>ç›¸æ‰‹ã®ãƒãƒƒãƒ—ã‚’å…¨ã¦å¥ªãˆã°ã‚²ãƒ¼ãƒ å‹åˆ©ã§ã™ï¼</p>
            </div>

            <div class="tutorial-step" data-step="5">
                <h3>ğŸ’¡ åˆå¿ƒè€…å‘ã‘ã®ã‚³ãƒ„</h3>
                <div class="highlight">
                    <strong>â‘  ãƒãƒ³ãƒ‰ã‚’é¸ã¶</strong><br>
                    å…¨ã¦ã®æ‰‹æœ­ã§ãƒ—ãƒ¬ã‚¤ã›ãšã€å¼·ã„æ‰‹æœ­ï¼ˆãƒšã‚¢ã€é«˜ã„ã‚«ãƒ¼ãƒ‰åŒå£«ï¼‰ã®æ™‚ã ã‘å‚åŠ ã—ã¾ã—ã‚‡ã†ã€‚<br><br>
                    <strong>â‘¡ ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚’æ„è­˜ã™ã‚‹</strong><br>
                    å¾Œã‹ã‚‰è¡Œå‹•ã™ã‚‹æ–¹ãŒæœ‰åˆ©ã§ã™ã€‚ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¡Œå‹•ã‚’è¦‹ã¦ã‹ã‚‰åˆ¤æ–­ã§ãã¾ã™ã€‚<br><br>
                    <strong>â‘¢ ç„¡ç†ã‚’ã—ãªã„</strong><br>
                    å¼±ã„æ‰‹æœ­ã§å¤§ããªãƒ™ãƒƒãƒˆã«ã‚³ãƒ¼ãƒ«ã—ç¶šã‘ã‚‹ã®ã¯æã§ã™ã€‚æ€ã„åˆ‡ã£ã¦ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã™ã‚‹å‹‡æ°—ã‚‚å¤§åˆ‡ï¼<br><br>
                    <strong>â‘£ ãƒãƒƒãƒˆã‚µã‚¤ã‚ºã‚’æ„è­˜ã™ã‚‹</strong><br>
                    ãƒãƒƒãƒˆã«å¯¾ã—ã¦ãƒ™ãƒƒãƒˆé¡ãŒå¤§ãã™ãã‚‹å ´åˆã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã‚‚æ¤œè¨ã—ã¾ã—ã‚‡ã†ã€‚
                </div>
            </div>

            <div class="tutorial-start-section">
                <button class="tutorial-start-btn" onclick="startInteractiveTutorial()">ğŸ® å®Ÿéš›ã«ãƒ—ãƒ¬ã‚¤ã—ã¦å­¦ã¶</button>
            </div>

            <div class="tutorial-nav">
                <button class="tutorial-nav-btn prev" id="tutorialPrev" onclick="tutorialStep(-1)">â† å‰ã¸</button>
                <span id="tutorialPageNum" style="color: #666; font-weight: bold;"></span>
                <button class="tutorial-nav-btn next" id="tutorialNext" onclick="tutorialStep(1)">æ¬¡ã¸ â†’</button>
            </div>
        </div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
    <div id="gameScreen">
        <div class="game-header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div class="game-title">ğŸ° Texas Hold'em</div>
                <button class="info-toggle-btn" onclick="toggleInfo()">ğŸ“Š æƒ…å ±è¡¨ç¤º</button>
            </div>
            <div class="sound-controls">
                <button id="soundToggle" class="sound-toggle" onclick="toggleSound()">ğŸ”Š ON</button>
                <div class="volume-control">
                    <span>ğŸ”‰</span>
                    <input type="range" id="volumeSlider" class="volume-slider" min="0" max="100" value="50" oninput="changeVolume(this.value)">
                    <span id="volumeDisplay">50%</span>
                </div>
            </div>
        </div>

        <div class="poker-table" id="pokerTable">
            <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å¸­ï¼ˆå‹•çš„ã«ç”Ÿæˆï¼‰ -->
            <div class="pot-display" id="potDisplay">Pot: $0</div>
            <div class="blinds-info">
                <div><span class="blinds-label">SB:</span> $<span id="sbAmount">100</span></div>
                <div><span class="blinds-label">BB:</span> $<span id="bbAmount">200</span></div>
            </div>
            <div class="deck-area">
                <div class="deck-stack">
                    <div class="deck-card"></div>
                    <div class="deck-card"></div>
                    <div class="deck-card"></div>
                </div>
            </div>
            <div class="community-cards" id="communityCards"></div>
            <div class="phase-announcement" id="phaseAnnouncement"></div>
        </div>

        <div class="action-panel" id="actionPanel">
            <div class="action-buttons">
                <button class="action-btn fold" onclick="playerAction('fold')">Fold</button>
                <button class="action-btn check" id="checkBtn" onclick="playerAction('check')">Check</button>
                <button class="action-btn call" id="callBtn" onclick="playerAction('call')">Call</button>
                <button class="action-btn raise" onclick="playerAction('raise')">Raise</button>
                <button class="action-btn all-in" onclick="playerAction('allin')">All In</button>
            </div>
            <div class="raise-controls" id="raiseControls">
                <div class="increment-selector">
                    <input type="radio" name="increment" id="inc100" class="increment-radio" value="100" checked>
                    <label for="inc100" class="increment-label">+100</label>
                    <input type="radio" name="increment" id="inc1000" class="increment-radio" value="1000">
                    <label for="inc1000" class="increment-label">+1000</label>
                </div>
                <div class="raise-amount">
                    <button class="amount-btn" onclick="adjustRaise(-1)">â–¼</button>
                    <div class="amount-display" id="raiseAmount">400</div>
                    <button class="amount-btn" onclick="adjustRaise(1)">â–²</button>
                </div>
            </div>
        </div>

        <div class="game-log" id="gameLog"></div>

        <div class="hand-ranking">
            <h3>ãƒãƒ³ãƒ‰ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h3>
            <div class="hand-list">
                <div class="hand-row"><span class="hand-row-name">1. ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ•ãƒ©ãƒƒã‚·ãƒ¥</span><div class="hand-row-cards"><span class="mini-card black">A<br>â™ </span><span class="mini-card black">K<br>â™ </span><span class="mini-card black">Q<br>â™ </span><span class="mini-card black">J<br>â™ </span><span class="mini-card black">10<br>â™ </span></div></div>
                <div class="hand-row"><span class="hand-row-name">2. ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥</span><div class="hand-row-cards"><span class="mini-card red">9<br>â™¥</span><span class="mini-card red">8<br>â™¥</span><span class="mini-card red">7<br>â™¥</span><span class="mini-card red">6<br>â™¥</span><span class="mini-card red">5<br>â™¥</span></div></div>
                <div class="hand-row"><span class="hand-row-name">3. ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰</span><div class="hand-row-cards"><span class="mini-card black">K<br>â™ </span><span class="mini-card red">K<br>â™¥</span><span class="mini-card red">K<br>â™¦</span><span class="mini-card black">K<br>â™£</span><span class="mini-card black">3<br>â™ </span></div></div>
                <div class="hand-row"><span class="hand-row-name">4. ãƒ•ãƒ«ãƒã‚¦ã‚¹</span><div class="hand-row-cards"><span class="mini-card red">Q<br>â™¥</span><span class="mini-card black">Q<br>â™£</span><span class="mini-card red">Q<br>â™¦</span><span class="mini-card black">8<br>â™ </span><span class="mini-card red">8<br>â™¥</span></div></div>
                <div class="hand-row"><span class="hand-row-name">5. ãƒ•ãƒ©ãƒƒã‚·ãƒ¥</span><div class="hand-row-cards"><span class="mini-card red">A<br>â™¦</span><span class="mini-card red">J<br>â™¦</span><span class="mini-card red">9<br>â™¦</span><span class="mini-card red">6<br>â™¦</span><span class="mini-card red">3<br>â™¦</span></div></div>
                <div class="hand-row"><span class="hand-row-name">6. ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ</span><div class="hand-row-cards"><span class="mini-card red">10<br>â™¥</span><span class="mini-card black">9<br>â™£</span><span class="mini-card red">8<br>â™¦</span><span class="mini-card black">7<br>â™ </span><span class="mini-card red">6<br>â™¥</span></div></div>
                <div class="hand-row"><span class="hand-row-name">7. ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰</span><div class="hand-row-cards"><span class="mini-card black">J<br>â™ </span><span class="mini-card red">J<br>â™¥</span><span class="mini-card black">J<br>â™£</span><span class="mini-card red">9<br>â™¦</span><span class="mini-card black">4<br>â™ </span></div></div>
                <div class="hand-row"><span class="hand-row-name">8. ãƒ„ãƒ¼ãƒšã‚¢</span><div class="hand-row-cards"><span class="mini-card red">A<br>â™¥</span><span class="mini-card black">A<br>â™£</span><span class="mini-card red">7<br>â™¦</span><span class="mini-card black">7<br>â™ </span><span class="mini-card red">2<br>â™¥</span></div></div>
                <div class="hand-row"><span class="hand-row-name">9. ãƒ¯ãƒ³ãƒšã‚¢</span><div class="hand-row-cards"><span class="mini-card black">10<br>â™ </span><span class="mini-card red">10<br>â™¦</span><span class="mini-card red">K<br>â™¥</span><span class="mini-card black">5<br>â™£</span><span class="mini-card red">3<br>â™¦</span></div></div>
                <div class="hand-row"><span class="hand-row-name">10. ãƒã‚¤ã‚«ãƒ¼ãƒ‰</span><div class="hand-row-cards"><span class="mini-card black">A<br>â™ </span><span class="mini-card red">J<br>â™¥</span><span class="mini-card black">8<br>â™£</span><span class="mini-card red">5<br>â™¦</span><span class="mini-card red">2<br>â™¥</span></div></div>
            </div>
        </div>
    </div>

    <!-- çµæœã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div class="result-overlay" id="resultOverlay">
        <div class="result-content">
            <div class="result-title" id="resultTitle"></div>
            <div class="result-message" id="resultMessage"></div>
            <div class="result-buttons">
                <button class="result-btn primary" onclick="restartGame()">å†æŒ‘æˆ¦</button>
                <button class="result-btn" onclick="backToMenu()">é›£æ˜“åº¦é¸æŠ</button>
            </div>
        </div>
    </div>

    <!-- æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸ -->
    <div class="next-round-overlay" id="nextRoundOverlay" onclick="proceedToNextRound()">
        <div class="next-round-message">
            <h2 id="roundResultTitle">ãƒ©ã‚¦ãƒ³ãƒ‰çµ‚äº†</h2>
            <p id="roundResultText"></p>
            <div class="click-hint">ğŸ‘† ã‚¯ãƒªãƒƒã‚¯ã§æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸</div>
        </div>
    </div>

    <!-- ã‚¬ã‚¤ãƒ‰ãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
    <div class="guide-overlay" id="guideOverlay">
        <div class="guide-dialog">
            <div class="guide-title" id="guideTitle"></div>
            <div class="guide-text" id="guideText"></div>
            <div class="guide-buttons">
                <button class="guide-ok-btn" onclick="closeGuide()">OK</button>
                <button class="guide-retry-btn" id="guideRetryBtn" onclick="retryTutorial()" style="display:none;">ğŸ”„ ã‚‚ã†ä¸€åº¦</button>
            </div>
        </div>
    </div>

    <script>
// ã‚²ãƒ¼ãƒ è¨­å®š
const INITIAL_CHIPS = 10000;
const SMALL_BLIND = 100;
const BIG_BLIND = 200;
const PLAYER_NAMES = ['ã‚ãªãŸ', 'CPU1', 'CPU2', 'CPU3', 'CPU4'];
const PLAYER_AVATARS = ['ğŸ¦', 'ğŸ±', 'ğŸ¨', 'ğŸ˜', 'ğŸ¶'];

// ã‚¿ã‚¤ãƒŸãƒ³ã‚°å®šæ•°
const DELAYS = {
    CPU_TURN: 1500,
    CPU_ACTION: 1000,
    NEXT_PLAYER: 800,
    CARD_ANIMATION: 2000,
    ANIMATION_CLEAR: 1000,
    BLIND_ANIMATION: 100,
    WINNER_HIGHLIGHT: 1500,
    SHOWDOWN_CARDS: 500,
    NEXT_ROUND_PROMPT: 3000,
    SHOWDOWN_NEXT_ROUND: 5000,
    GAME_END_CHECK: 2000
};

// ã‚²ãƒ¼ãƒ çŠ¶æ…‹
let difficulty = 'normal';
let players = [];
let deck = [];
let communityCards = [];
let pot = 0;
let currentBet = 0;
let dealerPosition = 0;
let currentPlayerIndex = 0;
let lastRaiser = -1; // æœ€å¾Œã«ãƒ¬ã‚¤ã‚º/ãƒ™ãƒƒãƒˆã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
let isTutorialMode = false; // ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒ¢ãƒ¼ãƒ‰
let guideResolve = null; // ã‚¬ã‚¤ãƒ‰ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®Promiseè§£æ±ºé–¢æ•°
let gamePhase = 'preflop'; // preflop, flop, turn, river, showdown
let soundEnabled = true;
let volume = 0.5;
let justDealtCards = false; // ã‚«ãƒ¼ãƒ‰ãŒé…ã‚‰ã‚ŒãŸç›´å¾Œã‹ã©ã†ã‹
let newCommunityCards = []; // æ–°ã—ãè¿½åŠ ã•ã‚ŒãŸã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚«ãƒ¼ãƒ‰

// BGMç”¨ã®AudioContext
let audioContext = null;
let bgmGainNode = null;
let bgmOscillators = [];
let bgmIsPlaying = false;

// ã‚µã‚¦ãƒ³ãƒ‰è¨­å®š
function toggleSound() {
    soundEnabled = !soundEnabled;
    const btn = document.getElementById('soundToggle');
    btn.textContent = soundEnabled ? 'ğŸ”Š ON' : 'ğŸ”‡ OFF';
    btn.classList.toggle('off', !soundEnabled);
    localStorage.setItem('soundEnabled', soundEnabled);

    // BGMã®åˆ¶å¾¡
    if (soundEnabled) {
        playBGM();
    } else {
        stopBGM();
    }
}

function changeVolume(value) {
    volume = value / 100;
    document.getElementById('volumeDisplay').textContent = value + '%';
    localStorage.setItem('volume', volume);
    updateBGMVolume();
}

// localStorage ã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã¿
window.addEventListener('load', () => {
    const savedSound = localStorage.getItem('soundEnabled');
    const savedVolume = localStorage.getItem('volume');
    if (savedSound !== null) {
        soundEnabled = savedSound === 'true';
        const btn = document.getElementById('soundToggle');
        btn.textContent = soundEnabled ? 'ğŸ”Š ON' : 'ğŸ”‡ OFF';
        btn.classList.toggle('off', !soundEnabled);
    }
    if (savedVolume !== null) {
        volume = parseFloat(savedVolume);
        const slider = document.getElementById('volumeSlider');
        slider.value = volume * 100;
        document.getElementById('volumeDisplay').textContent = Math.round(volume * 100) + '%';
    }
});

// BGMåˆæœŸåŒ–
function initBGM() {
    if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        bgmGainNode = audioContext.createGain();
        bgmGainNode.connect(audioContext.destination);
        bgmGainNode.gain.value = volume * 0.15; // BGMã¯æ§ãˆã‚ã«
    }
}

// BGMå†ç”Ÿ
function playBGM() {
    if (bgmIsPlaying) return;

    try {
        initBGM();

        // ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å†é–‹ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒãƒªã‚·ãƒ¼å¯¾ç­–ï¼‰
        if (audioContext.state === 'suspended') {
            audioContext.resume();
        }

        bgmIsPlaying = true;
    } catch (error) {
        console.error('BGM playback error:', error);
        return;
    }

    // ã‚³ãƒ¼ãƒ‰é€²è¡Œ: Cm - Ab - Eb - Bb (æš—ã‚ã®ãƒãƒ¼ã‚«ãƒ¼é›°å›²æ°—)
    const chords = [
        [261.63, 311.13, 392.00], // Cm
        [207.65, 261.63, 311.13], // Ab
        [311.13, 369.99, 466.16], // Eb
        [233.08, 293.66, 349.23]  // Bb
    ];

    let chordIndex = 0;

    function playChord() {
        if (!bgmIsPlaying) return;

        // å‰ã®ã‚ªã‚·ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’åœæ­¢
        bgmOscillators.forEach(osc => {
            try {
                osc.stop();
            } catch(e) {}
        });
        bgmOscillators = [];

        const chord = chords[chordIndex];
        const now = audioContext.currentTime;

        // å„éŸ³ã‚’å†ç”Ÿ
        chord.forEach((freq, i) => {
            const osc = audioContext.createOscillator();
            const oscGain = audioContext.createGain();

            osc.type = 'sine';
            osc.frequency.value = freq;

            // éŸ³é‡ã‚¨ãƒ³ãƒ™ãƒ­ãƒ¼ãƒ—ï¼ˆã‚†ã£ãã‚Šãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³/ã‚¢ã‚¦ãƒˆï¼‰
            oscGain.gain.setValueAtTime(0, now);
            oscGain.gain.linearRampToValueAtTime(0.05 * (1 - i * 0.2), now + 0.5);
            oscGain.gain.setValueAtTime(0.05 * (1 - i * 0.2), now + 3.5);
            oscGain.gain.linearRampToValueAtTime(0, now + 4);

            osc.connect(oscGain);
            oscGain.connect(bgmGainNode);

            osc.start(now);
            osc.stop(now + 4);

            bgmOscillators.push(osc);
        });

        // ãƒ™ãƒ¼ã‚¹éŸ³ï¼ˆã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸‹ï¼‰
        const bassOsc = audioContext.createOscillator();
        const bassGain = audioContext.createGain();

        bassOsc.type = 'triangle';
        bassOsc.frequency.value = chord[0] / 2;

        bassGain.gain.setValueAtTime(0, now);
        bassGain.gain.linearRampToValueAtTime(0.08, now + 0.3);
        bassGain.gain.setValueAtTime(0.08, now + 3.7);
        bassGain.gain.linearRampToValueAtTime(0, now + 4);

        bassOsc.connect(bassGain);
        bassGain.connect(bgmGainNode);

        bassOsc.start(now);
        bassOsc.stop(now + 4);

        bgmOscillators.push(bassOsc);

        chordIndex = (chordIndex + 1) % chords.length;

        // æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’äºˆç´„
        if (bgmIsPlaying) {
            setTimeout(playChord, 3800);
        }
    }

    playChord();
}

// BGMåœæ­¢
function stopBGM() {
    bgmIsPlaying = false;
    bgmOscillators.forEach(osc => {
        try {
            osc.stop();
        } catch(e) {}
    });
    bgmOscillators = [];
}

// BGMéŸ³é‡æ›´æ–°
function updateBGMVolume() {
    if (bgmGainNode) {
        bgmGainNode.gain.value = volume * 0.15;
    }
}

// ã‚µã‚¦ãƒ³ãƒ‰å†ç”Ÿï¼ˆWeb Audio APIã§åŠ¹æœéŸ³ã‚’ç”Ÿæˆï¼‰
function playSound(type) {
    if (!soundEnabled) return;

    try {
        initBGM(); // AudioContextã‚’ç¢ºä¿

        const now = audioContext.currentTime;

    switch(type) {
        case 'shuffle':
        case 'card':
            // ã‚«ãƒ¼ãƒ‰éŸ³ï¼ˆçŸ­ã„ãƒ›ãƒ¯ã‚¤ãƒˆãƒã‚¤ã‚ºï¼‰
            const cardBuffer = audioContext.createBuffer(1, audioContext.sampleRate * 0.1, audioContext.sampleRate);
            const cardData = cardBuffer.getChannelData(0);
            for (let i = 0; i < cardData.length; i++) {
                cardData[i] = (Math.random() * 2 - 1) * 0.3;
            }
            const cardSource = audioContext.createBufferSource();
            const cardGain = audioContext.createGain();
            const cardFilter = audioContext.createBiquadFilter();

            cardFilter.type = 'highpass';
            cardFilter.frequency.value = 2000;

            cardSource.buffer = cardBuffer;
            cardGain.gain.setValueAtTime(volume * 0.3, now);
            cardGain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);

            cardSource.connect(cardFilter);
            cardFilter.connect(cardGain);
            cardGain.connect(audioContext.destination);

            cardSource.start(now);
            break;

        case 'chips':
            // ãƒãƒƒãƒ—éŸ³ï¼ˆè¤‡æ•°ã®çŸ­ã„ãƒ“ãƒ¼ãƒ—ï¼‰
            for (let i = 0; i < 3; i++) {
                const chipOsc = audioContext.createOscillator();
                const chipGain = audioContext.createGain();

                chipOsc.type = 'square';
                chipOsc.frequency.value = 800 + i * 100;

                const startTime = now + i * 0.05;
                chipGain.gain.setValueAtTime(volume * 0.15, startTime);
                chipGain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.08);

                chipOsc.connect(chipGain);
                chipGain.connect(audioContext.destination);

                chipOsc.start(startTime);
                chipOsc.stop(startTime + 0.08);
            }
            break;

        case 'win':
            // å‹åˆ©éŸ³ï¼ˆä¸Šæ˜‡ã™ã‚‹ã‚¢ãƒ«ãƒšã‚¸ã‚ªï¼‰
            const winNotes = [523.25, 659.25, 783.99, 1046.50]; // C5-E5-G5-C6
            winNotes.forEach((freq, i) => {
                const winOsc = audioContext.createOscillator();
                const winGain = audioContext.createGain();

                winOsc.type = 'sine';
                winOsc.frequency.value = freq;

                const startTime = now + i * 0.15;
                winGain.gain.setValueAtTime(volume * 0.2, startTime);
                winGain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);

                winOsc.connect(winGain);
                winGain.connect(audioContext.destination);

                winOsc.start(startTime);
                winOsc.stop(startTime + 0.3);
            });
            break;

        case 'click':
            // ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯éŸ³
            const clickOsc = audioContext.createOscillator();
            const clickGain = audioContext.createGain();

            clickOsc.type = 'sine';
            clickOsc.frequency.setValueAtTime(600, now);
            clickOsc.frequency.exponentialRampToValueAtTime(300, now + 0.05);

            clickGain.gain.setValueAtTime(volume * 0.2, now);
            clickGain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);

            clickOsc.connect(clickGain);
            clickGain.connect(audioContext.destination);

            clickOsc.start(now);
            clickOsc.stop(now + 0.05);
            break;
    }
    } catch (error) {
        console.error('Sound playback error:', error);
    }
}

// ã‚²ãƒ¼ãƒ é–‹å§‹
function startGame(selectedDifficulty) {
    difficulty = selectedDifficulty;
    initGame();
    document.getElementById('difficultyScreen').style.display = 'none';
    document.getElementById('gameScreen').style.display = 'block';

    // BGMé–‹å§‹
    if (soundEnabled) {
        playBGM();
    }

    startNewRound();
}

// ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
function initGame() {
    players = PLAYER_NAMES.map((name, index) => ({
        id: index,
        name: name,
        chips: INITIAL_CHIPS,
        cards: [],
        bet: 0,
        folded: false,
        allIn: false,
        isDealer: false,
        isSmallBlind: false,
        isBigBlind: false,
        isActive: true
    }));
    
    dealerPosition = 0;
    renderPlayers();
    addLog('ã‚²ãƒ¼ãƒ é–‹å§‹ï¼åˆæœŸãƒãƒƒãƒ—: $' + INITIAL_CHIPS);
}

// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¡¨ç¤ºã‚’ä½œæˆï¼ˆåˆæœŸåŒ–æ™‚ã®ã¿ï¼‰
function renderPlayers() {
    const table = document.getElementById('pokerTable');
    // æ—¢å­˜ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å¸­ã‚’å‰Šé™¤
    document.querySelectorAll('.player-seat').forEach(el => el.remove());

    players.forEach((player, index) => {
        const seat = document.createElement('div');
        seat.className = `player-seat seat-${index}`;
        seat.id = `player-${index}`;

        seat.innerHTML = `
            <div class="player-info" id="info-${index}">
                <div class="player-avatar">${PLAYER_AVATARS[index]}</div>
                <div class="player-info-column">
                    <div class="player-name">${player.name}</div>
                    <div class="player-chips" id="chips-${index}">ğŸ’° $${player.chips}</div>
                    <div class="player-bet" id="bet-${index}"></div>
                    <div class="player-status" id="status-${index}"></div>
                </div>
                <div class="player-cards" id="cards-${index}"></div>
            </div>
        `;

        table.appendChild(seat);
    });
}

// æ–°ã—ã„ãƒ©ã‚¦ãƒ³ãƒ‰é–‹å§‹
function startNewRound() {
    // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯
    const activePlayers = players.filter(p => p.isActive);
    if (activePlayers.length === 1) {
        // ã‚²ãƒ¼ãƒ çµ‚äº†
        if (activePlayers[0].id === 0) {
            showResult('ğŸ‰ å„ªå‹ï¼', 'ã™ã¹ã¦ã®ç›¸æ‰‹ã‚’å€’ã—ã¾ã—ãŸï¼');
        }
        return;
    }

    // çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
    deck = createDeck();
    communityCards = [];
    pot = 0;
    currentBet = 0;
    gamePhase = 'preflop';

    players.forEach(player => {
        player.cards = [];
        player.bet = 0;
        player.folded = false;
        player.allIn = false;
        player.isDealer = false;
        player.isSmallBlind = false;
        player.isBigBlind = false;
    });

    // ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ãƒ»ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ã‚’è¨­å®š
    setPositions();

    // ã‚«ãƒ¼ãƒ‰ã‚’é…ã‚‹
    dealCards();

    // ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ã‚’å¾´å
    collectBlinds();

    // ãƒ—ãƒªãƒ•ãƒ­ãƒƒãƒ—é–‹å§‹ï¼ˆãƒ“ãƒƒã‚°ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ã®æ¬¡ã‹ã‚‰ï¼‰
    let bbPos = players.findIndex(p => p.isBigBlind);
    currentPlayerIndex = (bbPos + 1) % players.length;

    // ã‚¹ã‚­ãƒƒãƒ—ã—ã¦æ¬¡ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸
    while (!players[currentPlayerIndex].isActive || players[currentPlayerIndex].folded) {
        currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
    }

    updateDisplay();
    playSound('shuffle');
    addLog('--- æ–°ã—ã„ãƒ©ã‚¦ãƒ³ãƒ‰é–‹å§‹ ---');

    if (currentPlayerIndex !== 0) {
        setTimeout(() => cpuTurn(), DELAYS.CPU_TURN);
    }
}

// ãƒ‡ãƒƒã‚­ã‚’ä½œæˆ
function createDeck() {
    const suits = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
    const suitNames = ['spades', 'hearts', 'diamonds', 'clubs'];
    const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    const deck = [];
    
    suits.forEach((suit, suitIndex) => {
        values.forEach(value => {
            deck.push({
                suit: suit,
                suitName: suitNames[suitIndex],
                value: value,
                numValue: value === 'A' ? 14 : (value === 'K' ? 13 : (value === 'Q' ? 12 : (value === 'J' ? 11 : parseInt(value))))
            });
        });
    });
    
    // ã‚·ãƒ£ãƒƒãƒ•ãƒ«
    for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
    }
    
    return deck;
}

// ãƒã‚¸ã‚·ãƒ§ãƒ³è¨­å®š
function setPositions() {
    // ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ãƒœã‚¿ãƒ³ã‚’æ¬¡ã®äººã«
    do {
        dealerPosition = (dealerPosition + 1) % players.length;
    } while (!players[dealerPosition].isActive);
    
    players[dealerPosition].isDealer = true;
    
    // ã‚¹ãƒ¢ãƒ¼ãƒ«ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰
    let sbPos = (dealerPosition + 1) % players.length;
    while (!players[sbPos].isActive) {
        sbPos = (sbPos + 1) % players.length;
    }
    players[sbPos].isSmallBlind = true;
    
    // ãƒ“ãƒƒã‚°ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰
    let bbPos = (sbPos + 1) % players.length;
    while (!players[bbPos].isActive) {
        bbPos = (bbPos + 1) % players.length;
    }
    players[bbPos].isBigBlind = true;
}

// ã‚«ãƒ¼ãƒ‰ã‚’é…ã‚‹
function dealCards() {
    players.forEach(player => {
        if (player.isActive && !player.folded) {
            player.cards = [deck.pop(), deck.pop()];
        }
    });

    justDealtCards = true; // ã‚«ãƒ¼ãƒ‰é…å¸ƒãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
}

// ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰å¾´å
function collectBlinds() {
    const sbPlayer = players.find(p => p.isSmallBlind);
    const bbPlayer = players.find(p => p.isBigBlind);

    const sbAmount = Math.min(SMALL_BLIND, sbPlayer.chips);
    const bbAmount = Math.min(BIG_BLIND, bbPlayer.chips);

    sbPlayer.chips -= sbAmount;
    sbPlayer.bet = sbAmount;
    pot += sbAmount;

    bbPlayer.chips -= bbAmount;
    bbPlayer.bet = bbAmount;
    pot += bbAmount;

    currentBet = BIG_BLIND;
    lastRaiser = bbPlayer.id;

    addLog(`${sbPlayer.name} ãŒã‚¹ãƒ¢ãƒ¼ãƒ«ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ $${sbAmount} ã‚’æ”¯æ‰•ã„ã¾ã—ãŸ`);
    addLog(`${bbPlayer.name} ãŒãƒ“ãƒƒã‚°ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ $${bbAmount} ã‚’æ”¯æ‰•ã„ã¾ã—ãŸ`);

    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯è¡¨ç¤ºæ›´æ–°å¾Œã«å®Ÿè¡Œ
    setTimeout(() => {
        animateChipToPot(sbPlayer.id, sbAmount);
        animateChipToPot(bbPlayer.id, bbAmount);
    }, DELAYS.BLIND_ANIMATION);
}

// è¡¨ç¤ºæ›´æ–°
function updateDisplay() {
    // ãƒãƒƒãƒˆè¡¨ç¤º
    document.getElementById('potDisplay').textContent = `Pot: $${pot}`;

    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±æ›´æ–°
    players.forEach((player, index) => {
        if (!player.isActive) return;

        const infoEl = document.getElementById(`info-${index}`);
        if (infoEl) {
            infoEl.className = 'player-info';
            if (index === currentPlayerIndex) infoEl.classList.add('active');
            if (player.folded) infoEl.classList.add('folded');
            if (player.allIn) infoEl.classList.add('all-in');

            // ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ãƒœã‚¿ãƒ³ã®æ›´æ–°
            const existingDealer = infoEl.querySelector('.dealer-button');
            if (player.isDealer && !existingDealer) {
                const dealerBtn = document.createElement('div');
                dealerBtn.className = 'dealer-button';
                dealerBtn.textContent = 'D';
                infoEl.appendChild(dealerBtn);
            } else if (!player.isDealer && existingDealer) {
                existingDealer.remove();
            }

            // ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã®æ›´æ–°
            const existingBlind = infoEl.querySelector('.blind-indicator');
            if (existingBlind) existingBlind.remove();
            if (player.isSmallBlind) {
                const blindInd = document.createElement('div');
                blindInd.className = 'blind-indicator';
                blindInd.textContent = 'SB';
                infoEl.appendChild(blindInd);
            } else if (player.isBigBlind) {
                const blindInd = document.createElement('div');
                blindInd.className = 'blind-indicator';
                blindInd.textContent = 'BB';
                infoEl.appendChild(blindInd);
            }

            // ã‚¿ãƒ¼ãƒ³ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼
            const existingTurnInd = infoEl.querySelector('.turn-indicator');
            if (existingTurnInd) existingTurnInd.remove();

            if (index === currentPlayerIndex && !player.folded && player.isActive) {
                const turnInd = document.createElement('div');
                turnInd.className = 'turn-indicator';
                turnInd.textContent = index === 0 ? 'ğŸ¯ YOUR TURN' : `ğŸ¯ ${player.name} TURN`;
                infoEl.appendChild(turnInd);
            }
        }

        const chipsEl = document.getElementById(`chips-${index}`);
        if (chipsEl) chipsEl.textContent = `ğŸ’° $${player.chips}`;

        const betEl = document.getElementById(`bet-${index}`);
        if (betEl) betEl.textContent = player.bet > 0 ? `Bet: $${player.bet}` : '';

        // ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
        const cardsEl = document.getElementById(`cards-${index}`);
        if (cardsEl) {
            if (player.folded) {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã—ãŸã‚‰ã‚«ãƒ¼ãƒ‰ã‚’æ¶ˆã™
                cardsEl.innerHTML = '';
            } else if (index === 0 && player.cards.length > 0) {
                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚«ãƒ¼ãƒ‰ã¯è¡¨ç¤º
                const animClass = justDealtCards ? 'initial-deal' : '';
                cardsEl.innerHTML = player.cards.map((card, cardIdx) =>
                    `<div class="card ${card.suitName} ${animClass}" style="${justDealtCards ? `animation-delay: ${index * 0.15 + cardIdx * 0.1}s` : ''}">
                        <div class="card-value">${card.value}</div>
                        <div class="card-suit">${card.suit}</div>
                    </div>`
                ).join('');
            } else if (player.cards.length > 0) {
                // CPUã®ã‚«ãƒ¼ãƒ‰ã¯è£å‘ã
                const animClass = justDealtCards ? 'initial-deal' : '';
                cardsEl.innerHTML = player.cards.map((card, cardIdx) =>
                    `<div class="card back ${animClass}" style="${justDealtCards ? `animation-delay: ${index * 0.15 + cardIdx * 0.1}s` : ''}"></div>`
                ).join('');
            } else {
                cardsEl.innerHTML = '';
            }
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
        const statusEl = document.getElementById(`status-${index}`);
        if (statusEl) {
            if (player.folded) statusEl.textContent = 'Folded';
            else if (player.allIn) statusEl.textContent = 'All In!';
            else statusEl.textContent = '';
        }
    });

    // ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼ˆ5æšåˆ†ã®æ ã‚’å¸¸ã«è¡¨ç¤ºï¼‰
    const communityEl = document.getElementById('communityCards');
    if (communityEl) {
        let cardsHtml = '';
        for (let i = 0; i < 5; i++) {
            if (i < communityCards.length) {
                const card = communityCards[i];
                const isNewCard = newCommunityCards.includes(i);
                const animClass = isNewCard ? 'deal-animation' : '';
                const animDelay = isNewCard ? `animation-delay: ${newCommunityCards.indexOf(i) * 0.2}s` : '';
                cardsHtml += `<div class="card ${card.suitName} ${animClass}" style="${animDelay}">
                    <div class="card-value">${card.value}</div>
                    <div class="card-suit">${card.suit}</div>
                </div>`;
            } else {
                cardsHtml += '<div class="card-placeholder"></div>';
            }
        }
        communityEl.innerHTML = cardsHtml;
    }

    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹
    updateActionButtons();

    // ã‚«ãƒ¼ãƒ‰é…å¸ƒãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ
    if (justDealtCards) {
        setTimeout(() => {
            justDealtCards = false;
        }, DELAYS.CARD_ANIMATION);
    }
}

// ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®æ›´æ–°
function updateActionButtons() {
    const player = players[0];
    const canCheck = currentBet === player.bet;
    const callAmount = currentBet - player.bet;
    
    document.getElementById('checkBtn').style.display = canCheck ? 'inline-block' : 'none';
    document.getElementById('callBtn').style.display = !canCheck ? 'inline-block' : 'none';
    if (!canCheck) {
        document.getElementById('callBtn').textContent = `Call $${callAmount}`;
    }
    
    // ãƒ¬ã‚¤ã‚ºã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
    const minRaise = currentBet === 0 ? BIG_BLIND : currentBet * 2;
    document.getElementById('raiseAmount').textContent = minRaise;
}

// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
function playerAction(action) {
    if (currentPlayerIndex !== 0) return;

    const player = players[0];

    switch(action) {
        case 'fold':
            player.folded = true;
            addLog(`${player.name} ãŒãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã—ã¾ã—ãŸ`);
            showActionIndicator(0, 'fold');
            playSound('click');
            break;

        case 'check':
            addLog(`${player.name} ãŒãƒã‚§ãƒƒã‚¯ã—ã¾ã—ãŸ`);
            showActionIndicator(0, 'check');
            playSound('click');
            break;

        case 'call':
            const callAmount = Math.min(currentBet - player.bet, player.chips);
            player.chips -= callAmount;
            player.bet += callAmount;
            pot += callAmount;
            addLog(`${player.name} ãŒ $${callAmount} ã‚’ã‚³ãƒ¼ãƒ«ã—ã¾ã—ãŸ`);
            showActionIndicator(0, 'call', callAmount);
            animateChipToPot(0, callAmount);
            playSound('chips');
            break;

        case 'raise':
            const raiseAmount = parseInt(document.getElementById('raiseAmount').textContent);
            const minRaiseAmount = currentBet === 0 ? BIG_BLIND : currentBet * 2;

            if (raiseAmount < minRaiseAmount) {
                alert(`æœ€ä½ãƒ¬ã‚¤ã‚ºé¡ã¯ $${minRaiseAmount} ã§ã™ï¼`);
                return;
            }

            const totalBet = raiseAmount - player.bet;
            if (totalBet > player.chips) {
                alert('ãƒãƒƒãƒ—ãŒè¶³ã‚Šã¾ã›ã‚“ï¼');
                return;
            }

            player.chips -= totalBet;
            player.bet = raiseAmount;
            pot += totalBet;
            currentBet = raiseAmount;
            lastRaiser = 0;
            addLog(`${player.name} ãŒ $${raiseAmount} ã«ãƒ¬ã‚¤ã‚ºã—ã¾ã—ãŸ`);
            showActionIndicator(0, 'raise', raiseAmount);
            animateChipToPot(0, totalBet);
            playSound('chips');
            break;

        case 'allin':
            const allInAmount = player.chips;
            player.chips = 0;
            player.bet += allInAmount;
            pot += allInAmount;
            if (player.bet > currentBet) {
                currentBet = player.bet;
                lastRaiser = 0;
            }
            player.allIn = true;
            addLog(`${player.name} ãŒã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ï¼ $${allInAmount}`);
            showActionIndicator(0, 'allin', allInAmount);
            animateChipToPot(0, allInAmount);
            playSound('chips');
            break;
    }

    updateDisplay();
    nextPlayer();
}

// ãƒ¬ã‚¤ã‚ºé‡‘é¡èª¿æ•´
function adjustRaise(direction) {
    const incrementRadios = document.getElementsByName('increment');
    let increment = 100;
    for (const radio of incrementRadios) {
        if (radio.checked) {
            increment = parseInt(radio.value);
            break;
        }
    }
    
    const currentAmount = parseInt(document.getElementById('raiseAmount').textContent);
    const minRaise = currentBet === 0 ? BIG_BLIND : currentBet * 2;
    const maxRaise = players[0].chips + players[0].bet;
    
    let newAmount = currentAmount + (increment * direction);
    newAmount = Math.max(minRaise, Math.min(maxRaise, newAmount));
    
    document.getElementById('raiseAmount').textContent = newAmount;
}

// æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸
function nextPlayer() {
    const activePlayers = players.filter(p => p.isActive && !p.folded);

    if (activePlayers.length === 1) {
        // 1äººã—ã‹æ®‹ã£ã¦ã„ãªã„
        endRound();
        return;
    }

    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¯èƒ½ãªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã›ãšã€ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ã§ã‚‚ãªã„ï¼‰
    const playersWhoCanAct = players.filter(p => p.isActive && !p.folded && !p.allIn);

    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¯èƒ½ãªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã„ãªã„å ´åˆã¯æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã¸
    if (playersWhoCanAct.length === 0) {
        nextPhase();
        return;
    }

    // å…¨å“¡ãŒãƒ™ãƒƒãƒˆã‚’æƒãˆãŸã‹ãƒã‚§ãƒƒã‚¯
    const allBetsEqual = playersWhoCanAct.every(p => p.bet === currentBet);

    // æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ¢ã™
    let attempts = 0;
    let nextIndex = (currentPlayerIndex + 1) % players.length;

    while (attempts < players.length) {
        if (players[nextIndex].isActive && !players[nextIndex].folded && !players[nextIndex].allIn) {
            if (allBetsEqual) {
                if (lastRaiser >= 0) {
                    // ãƒ¬ã‚¤ã‚ºã—ãŸäººã«æˆ»ã£ãŸã‚‰ãƒ•ã‚§ãƒ¼ã‚ºçµ‚äº†
                    if (nextIndex === lastRaiser) {
                        nextPhase();
                        return;
                    }
                } else {
                    // èª°ã‚‚ãƒ¬ã‚¤ã‚ºã—ã¦ã„ãªã„å ´åˆã€ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã®æ¬¡ã«æˆ»ã£ãŸã‚‰ãƒ•ã‚§ãƒ¼ã‚ºçµ‚äº†
                    let firstToAct = (dealerPosition + 1) % players.length;
                    while (players[firstToAct].folded || !players[firstToAct].isActive || players[firstToAct].allIn) {
                        firstToAct = (firstToAct + 1) % players.length;
                    }
                    if (nextIndex === firstToAct) {
                        nextPhase();
                        return;
                    }
                }
            }

            break;
        }
        nextIndex = (nextIndex + 1) % players.length;
        attempts++;
    }

    // å…¨å“¡ãŒãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã¾ãŸã¯ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ã®å ´åˆ
    if (attempts >= players.length) {
        nextPhase();
        return;
    }

    currentPlayerIndex = nextIndex;
    updateDisplay();

    if (currentPlayerIndex !== 0) {
        setTimeout(() => cpuTurn(), DELAYS.CPU_ACTION);
    }
}

// CPUã®ã‚¿ãƒ¼ãƒ³
function cpuTurn() {
    const cpu = players[currentPlayerIndex];
    if (!cpu.isActive || cpu.folded || cpu.allIn) {
        nextPlayer();
        return;
    }
    
    // é›£æ˜“åº¦åˆ¥ã®AI
    const action = decideCpuAction(cpu);
    executeCpuAction(cpu, action);
    
    updateDisplay();
    setTimeout(() => nextPlayer(), DELAYS.NEXT_PLAYER);
}

// CPUã®è¡Œå‹•æ±ºå®š
function decideCpuAction(cpu) {
    const callAmount = currentBet - cpu.bet;
    const hand = evaluateHand(cpu.cards, communityCards);
    
    // ç°¡æ˜“AIï¼ˆé›£æ˜“åº¦ã«ã‚ˆã‚Šèª¿æ•´ï¼‰
    let aggression = difficulty === 'easy' ? 0.3 : (difficulty === 'normal' ? 0.5 : 0.7);
    let bluffChance = difficulty === 'easy' ? 0.1 : (difficulty === 'normal' ? 0.2 : 0.4);
    
    const random = Math.random();
    
    // ãƒãƒ³ãƒ‰ãŒå¼·ã„å ´åˆ
    if (hand.rank >= 7 || random < bluffChance) {
        if (random < aggression) {
            return { type: 'raise', amount: currentBet + BIG_BLIND * 2 };
        } else {
            return { type: 'call' };
        }
    }
    
    // ãƒãƒ³ãƒ‰ãŒä¸­ç¨‹åº¦
    if (hand.rank >= 4) {
        if (callAmount <= cpu.chips * 0.3) {
            return { type: 'call' };
        } else if (Math.random() < 0.3) {
            return { type: 'call' };
        } else {
            return { type: 'fold' };
        }
    }

    // ãƒãƒ³ãƒ‰ãŒå¼±ã„
    if (callAmount === 0) {
        return { type: 'check' };
    } else if (Math.random() < 0.3) {
        // 30%ã®ç¢ºç‡ã§ã‚³ãƒ¼ãƒ«
        return { type: 'call' };
    } else {
        return { type: 'fold' };
    }
}

// CPUã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
function executeCpuAction(cpu, action) {
    const cpuIndex = cpu.id;

    switch(action.type) {
        case 'fold':
            cpu.folded = true;
            addLog(`${cpu.name} ãŒãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã—ã¾ã—ãŸ`);
            showActionIndicator(cpuIndex, 'fold');
            break;
        case 'check':
            addLog(`${cpu.name} ãŒãƒã‚§ãƒƒã‚¯ã—ã¾ã—ãŸ`);
            showActionIndicator(cpuIndex, 'check');
            break;
        case 'call':
            const callAmount = Math.min(currentBet - cpu.bet, cpu.chips);
            if (callAmount === 0) {
                addLog(`${cpu.name} ãŒãƒã‚§ãƒƒã‚¯ã—ã¾ã—ãŸ`);
                showActionIndicator(cpuIndex, 'check');
            } else {
                cpu.chips -= callAmount;
                cpu.bet += callAmount;
                pot += callAmount;
                addLog(`${cpu.name} ãŒ $${callAmount} ã‚’ã‚³ãƒ¼ãƒ«ã—ã¾ã—ãŸ`);
                showActionIndicator(cpuIndex, 'call', callAmount);
                animateChipToPot(cpuIndex, callAmount);
            }
            break;
        case 'raise':
            const raiseAmount = Math.min(action.amount, cpu.chips + cpu.bet);
            const totalBet = raiseAmount - cpu.bet;
            cpu.chips -= totalBet;
            cpu.bet = raiseAmount;
            pot += totalBet;
            currentBet = raiseAmount;
            lastRaiser = cpuIndex;
            addLog(`${cpu.name} ãŒ $${raiseAmount} ã«ãƒ¬ã‚¤ã‚ºã—ã¾ã—ãŸ`);
            showActionIndicator(cpuIndex, 'raise', raiseAmount);
            animateChipToPot(cpuIndex, totalBet);
            break;
    }
}

// æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã¸
function nextPhase() {
    // ãƒ™ãƒƒãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
    players.forEach(p => {
        p.bet = 0;
    });
    currentBet = 0;
    lastRaiser = -1;

    // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã§æœªãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°ã‚’ãƒã‚§ãƒƒã‚¯
    const activePlayers = players.filter(p => p.isActive && !p.folded);
    if (activePlayers.length === 1) {
        endRound();
        return;
    }

    switch(gamePhase) {
        case 'preflop':
            // ãƒ•ãƒ­ãƒƒãƒ—ï¼ˆãƒ•ãƒ­ãƒƒãƒ—3æšï¼‰
            const flopCards = [deck.pop(), deck.pop(), deck.pop()];
            newCommunityCards = [0, 1, 2]; // æ–°ã—ãè¿½åŠ ã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
            communityCards = flopCards;
            gamePhase = 'flop';
            addLog('--- ãƒ•ãƒ­ãƒƒãƒ— ---');
            showPhaseAnnouncement('FLOP', 'ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚«ãƒ¼ãƒ‰ 3æš');
            playSound('card');
            break;
        case 'flop':
            // ã‚¿ãƒ¼ãƒ³ï¼ˆã‚¿ãƒ¼ãƒ³1æšï¼‰
            newCommunityCards = [communityCards.length]; // æ–°ã—ãè¿½åŠ ã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
            communityCards.push(deck.pop());
            gamePhase = 'turn';
            addLog('--- ã‚¿ãƒ¼ãƒ³ ---');
            showPhaseAnnouncement('TURN', '4æšç›®ã®ã‚«ãƒ¼ãƒ‰');
            playSound('card');
            break;
        case 'turn':
            // ãƒªãƒãƒ¼ï¼ˆãƒªãƒãƒ¼1æšï¼‰
            newCommunityCards = [communityCards.length]; // æ–°ã—ãè¿½åŠ ã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
            communityCards.push(deck.pop());
            gamePhase = 'river';
            addLog('--- ãƒªãƒãƒ¼ ---');
            showPhaseAnnouncement('RIVER', 'æœ€å¾Œã®ã‚«ãƒ¼ãƒ‰');
            playSound('card');
            break;
        case 'river':
            // ã‚·ãƒ§ãƒ¼ãƒ€ã‚¦ãƒ³
            gamePhase = 'showdown';
            showdown();
            return;
    }

    // è¡¨ç¤ºã‚’æ›´æ–°ã—ã¦ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
    updateDisplay();

    // æ–°ã—ã„ã‚«ãƒ¼ãƒ‰ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œå¾Œã€ãƒ•ãƒ©ã‚°ã‚’ã‚¯ãƒªã‚¢
    setTimeout(() => {
        newCommunityCards = [];
    }, DELAYS.ANIMATION_CLEAR);

    // ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã®æ¬¡ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰é–‹å§‹
    currentPlayerIndex = (dealerPosition + 1) % players.length;
    let attempts = 0;
    while (attempts < players.length && (players[currentPlayerIndex].folded || !players[currentPlayerIndex].isActive || players[currentPlayerIndex].allIn)) {
        currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
        attempts++;
    }

    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¯èƒ½ãªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã„ãªã„å ´åˆã¯æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã¸
    if (attempts >= players.length) {
        setTimeout(() => nextPhase(), DELAYS.ANIMATION_CLEAR);
        return;
    }

    updateDisplay();

    // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒ¢ãƒ¼ãƒ‰ï¼šãƒ•ã‚§ãƒ¼ã‚ºã‚¬ã‚¤ãƒ‰è¡¨ç¤º
    if (isTutorialMode) {
        showTutorialGuide(gamePhase).then(() => {
            if (currentPlayerIndex !== 0) {
                setTimeout(() => cpuTurn(), DELAYS.CPU_TURN);
            }
        });
        return;
    }

    if (currentPlayerIndex !== 0) {
        setTimeout(() => cpuTurn(), DELAYS.CPU_TURN);
    }
}

// ãƒ©ã‚¦ãƒ³ãƒ‰çµ‚äº†
function endRound() {
    const winner = players.find(p => p.isActive && !p.folded);
    const winAmount = pot;
    winner.chips += pot;
    addLog(`ğŸ‰ ${winner.name} ãŒ $${winAmount} ã‚’ç²å¾—ã—ã¾ã—ãŸï¼`);
    highlightWinner(winner.id, winAmount);
    playSound('win');

    if (isTutorialMode) {
        setTimeout(async () => {
            await showTutorialGuide('end');
            endInteractiveTutorial();
        }, DELAYS.NEXT_ROUND_PROMPT);
    } else {
        setTimeout(() => {
            showNextRoundPrompt(`${winner.name} ãŒå‹åˆ©ï¼`, `+$${winAmount}`);
        }, DELAYS.NEXT_ROUND_PROMPT);
    }
}

// ã‚·ãƒ§ãƒ¼ãƒ€ã‚¦ãƒ³
function showdown() {
    addLog('--- ã‚·ãƒ§ãƒ¼ãƒ€ã‚¦ãƒ³ ---');
    showPhaseAnnouncement('SHOWDOWN', 'æ‰‹æœ­å…¬é–‹', true);

    const activePlayers = players.filter(p => p.isActive && !p.folded);
    const hands = activePlayers.map(p => ({
        player: p,
        hand: evaluateHand(p.cards, communityCards)
    }));

    // å…¨å“¡ã®æ‰‹æœ­ã‚’è¡¨ç¤º
    activePlayers.forEach(p => {
        const hand = hands.find(h => h.player.id === p.id).hand;
        addLog(`${p.name}: ${hand.name} ${p.cards.map(c => c.value + c.suit).join(' ')}`);
    });

    // æœ€å¼·ã®ãƒãƒ³ãƒ‰ã‚’è¦‹ã¤ã‘ã‚‹
    hands.sort((a, b) => compareHands(b.hand, a.hand));

    const winner = hands[0].player;
    const winAmount = pot;
    winner.chips += pot;

    addLog(`ğŸ‰ ${winner.name} ãŒ ${hands[0].hand.name} ã§ $${winAmount} ã‚’ç²å¾—ã—ã¾ã—ãŸï¼`);

    // å…¨å“¡ã®ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãï¼‰
    updateDisplay();
    setTimeout(() => {
        activePlayers.forEach((p, idx) => {
            const cardsEl = document.getElementById(`cards-${p.id}`);
            const infoEl = document.getElementById(`info-${p.id}`);

            if (cardsEl && p.id !== 0) {
                cardsEl.innerHTML = p.cards.map((card, cardIdx) =>
                    `<div class="card ${card.suitName}" style="animation-delay: ${idx * 0.2 + cardIdx * 0.1}s">
                        <div class="card-value">${card.value}</div>
                        <div class="card-suit">${card.suit}</div>
                    </div>`
                ).join('');
            }

            // å½¹åãƒãƒƒã‚¸ã‚’è¡¨ç¤º
            if (infoEl) {
                const hand = hands.find(h => h.player.id === p.id).hand;
                const handBadge = document.createElement('div');
                handBadge.className = 'hand-badge';
                handBadge.style.animationDelay = `${idx * 0.2}s`;
                handBadge.textContent = hand.name;
                infoEl.appendChild(handBadge);

                // å¾Œã§å‰Šé™¤
                setTimeout(() => handBadge.remove(), 6000);
            }
        });
    }, DELAYS.SHOWDOWN_CARDS);

    playSound('win');

    // å‹è€…ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
    setTimeout(() => {
        highlightWinner(winner.id, winAmount);
    }, DELAYS.WINNER_HIGHLIGHT);

    if (isTutorialMode) {
        setTimeout(async () => {
            await showTutorialGuide('showdown');
            await showTutorialGuide('end');
            endInteractiveTutorial();
        }, DELAYS.SHOWDOWN_NEXT_ROUND);
    } else {
        setTimeout(() => {
            showNextRoundPrompt(`${winner.name} ãŒ ${hands[0].hand.name} ã§å‹åˆ©ï¼`, `+$${winAmount}`);
        }, DELAYS.SHOWDOWN_NEXT_ROUND);
    }
}

// ã‚²ãƒ¼ãƒ çµ‚äº†ãƒã‚§ãƒƒã‚¯
function checkGameEnd() {
    // ãƒãƒƒãƒ—0ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é€€å ´ã•ã›ã‚‹
    players.forEach(p => {
        if (p.chips === 0) {
            p.isActive = false;
            if (p.id === 0) {
                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç ´ç”£
                showResult('ğŸ’¸ ç ´ç”£', 'ãƒãƒƒãƒ—ãŒãªããªã‚Šã¾ã—ãŸ...');
            } else {
                addLog(`${p.name} ãŒç ´ç”£ã—ã¾ã—ãŸ`);
            }
        }
    });
    
    const activePlayers = players.filter(p => p.isActive);
    
    if (activePlayers.length === 1) {
        if (activePlayers[0].id === 0) {
            showResult('ğŸ‰ å„ªå‹ï¼', 'ã™ã¹ã¦ã®ç›¸æ‰‹ã‚’å€’ã—ã¾ã—ãŸï¼');
        }
        return;
    }
    
    // æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸
    setTimeout(() => startNewRound(), DELAYS.GAME_END_CHECK);
}

// çµæœè¡¨ç¤º
function showResult(title, message) {
    document.getElementById('resultTitle').textContent = title;
    document.getElementById('resultMessage').textContent = message;
    document.getElementById('resultOverlay').style.display = 'flex';
}

// ã‚²ãƒ¼ãƒ å†ã‚¹ã‚¿ãƒ¼ãƒˆ
function restartGame() {
    document.getElementById('resultOverlay').style.display = 'none';
    stopBGM();
    initGame();
    if (soundEnabled) {
        playBGM();
    }
    startNewRound();
}

// ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹
function backToMenu() {
    stopBGM();
    document.getElementById('resultOverlay').style.display = 'none';
    document.getElementById('gameScreen').style.display = 'none';
    document.getElementById('difficultyScreen').style.display = 'flex';
}

// ãƒ•ã‚§ãƒ¼ã‚ºã‚¢ãƒŠã‚¦ãƒ³ã‚¹ãƒ¡ãƒ³ãƒˆè¡¨ç¤º
// ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«
let currentTutorialStep = 0;
const TOTAL_TUTORIAL_STEPS = 6;

function showTutorial() {
    currentTutorialStep = 0;
    document.getElementById('tutorialOverlay').style.display = 'flex';
    updateTutorialDisplay();
}

function closeTutorial() {
    document.getElementById('tutorialOverlay').style.display = 'none';
}

function tutorialStep(direction) {
    currentTutorialStep += direction;
    if (currentTutorialStep < 0) currentTutorialStep = 0;
    if (currentTutorialStep >= TOTAL_TUTORIAL_STEPS) {
        closeTutorial();
        return;
    }
    updateTutorialDisplay();
}

function updateTutorialDisplay() {
    // ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤ºåˆ‡æ›¿
    document.querySelectorAll('.tutorial-step').forEach(el => {
        el.classList.remove('active');
    });
    const activeStep = document.querySelector(`.tutorial-step[data-step="${currentTutorialStep}"]`);
    if (activeStep) activeStep.classList.add('active');

    // é€²æ—ãƒ‰ãƒƒãƒˆæ›´æ–°
    const progressEl = document.getElementById('tutorialProgress');
    progressEl.innerHTML = Array.from({length: TOTAL_TUTORIAL_STEPS}, (_, i) =>
        `<div class="progress-dot ${i === currentTutorialStep ? 'active' : ''}"></div>`
    ).join('');

    // ãƒšãƒ¼ã‚¸ç•ªå·
    document.getElementById('tutorialPageNum').textContent = `${currentTutorialStep + 1} / ${TOTAL_TUTORIAL_STEPS}`;

    // ãƒœã‚¿ãƒ³åˆ¶å¾¡
    const prevBtn = document.getElementById('tutorialPrev');
    const nextBtn = document.getElementById('tutorialNext');
    prevBtn.disabled = currentTutorialStep === 0;

    if (currentTutorialStep === TOTAL_TUTORIAL_STEPS - 1) {
        nextBtn.textContent = 'é–‰ã˜ã‚‹ âœ•';
        nextBtn.className = 'tutorial-nav-btn close';
    } else {
        nextBtn.textContent = 'æ¬¡ã¸ â†’';
        nextBtn.className = 'tutorial-nav-btn next';
    }
}

// ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«
function showGuide(title, text) {
    return new Promise(resolve => {
        guideResolve = resolve;
        document.getElementById('guideTitle').textContent = title;
        document.getElementById('guideText').innerHTML = text;
        document.getElementById('guideOverlay').style.display = 'flex';
    });
}

function closeGuide() {
    document.getElementById('guideOverlay').style.display = 'none';
    if (guideResolve) {
        const resolve = guideResolve;
        guideResolve = null;
        resolve();
    }
}

async function showTutorialGuide(phase) {
    const guides = {
        welcome: {
            title: 'ğŸ® ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é–‹å§‹',
            text: 'ã‚ãªãŸã«2æšã®ã‚«ãƒ¼ãƒ‰ãŒé…ã‚‰ã‚Œã¾ã—ãŸã€‚ã“ã‚ŒãŒ<strong>æ‰‹æœ­</strong>ã§ã™ã€‚<br><br>ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚«ãƒ¼ãƒ‰ï¼ˆå ´ã®å…±é€šã‚«ãƒ¼ãƒ‰ï¼‰ã¨çµ„ã¿åˆã‚ã›ã¦ã€æœ€å¼·ã®å½¹ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ï¼'
        },
        preflop: {
            title: 'ğŸ“‹ ãƒ—ãƒªãƒ•ãƒ­ãƒƒãƒ—',
            text: 'ã¾ã ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚«ãƒ¼ãƒ‰ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<strong>æ‰‹æœ­ã®å¼·ã•ã ã‘</strong>ã§åˆ¤æ–­ã—ã¾ã™ã€‚<br><br>SBï¼ˆã‚¹ãƒ¢ãƒ¼ãƒ«ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ï¼‰ã¨BBï¼ˆãƒ“ãƒƒã‚°ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ï¼‰ãŒè‡ªå‹•ã§æ”¯æ‰•ã‚ã‚Œã¦ã„ã¾ã™ã€‚<br><br>ã‚ãªãŸã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„ï¼<br>ãƒ»<strong>ã‚³ãƒ¼ãƒ«</strong>ï¼šåŒé¡ã‚’å‡ºã—ã¦å‚åŠ <br>ãƒ»<strong>ãƒ¬ã‚¤ã‚º</strong>ï¼šé‡‘é¡ã‚’ä¸Šã’ã‚‹<br>ãƒ»<strong>ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰</strong>ï¼šé™ã‚Šã‚‹'
        },
        flop: {
            title: 'ğŸƒ ãƒ•ãƒ­ãƒƒãƒ—',
            text: '3æšã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚«ãƒ¼ãƒ‰ãŒå…¬é–‹ã•ã‚Œã¾ã—ãŸï¼<br><br>æ‰‹æœ­ã¨åˆã‚ã›ã¦<strong>5æš</strong>ã§å½¹ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚<br>è‰¯ã„å½¹ãŒã§ããã†ãªã‚‰<strong>ãƒ¬ã‚¤ã‚º</strong>ã€å¾®å¦™ãªã‚‰<strong>ãƒã‚§ãƒƒã‚¯</strong>ã‹<strong>ã‚³ãƒ¼ãƒ«</strong>ã‚’é¸ã³ã¾ã—ã‚‡ã†ã€‚'
        },
        turn: {
            title: 'ğŸƒ ã‚¿ãƒ¼ãƒ³',
            text: '4æšç›®ã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚«ãƒ¼ãƒ‰ãŒå…¬é–‹ã•ã‚Œã¾ã—ãŸã€‚<br><br>å½¹ãŒå®Œæˆã«è¿‘ã¥ã„ã¦ã„ã¾ã™ã‹ï¼Ÿ<strong>æ®‹ã‚Š1æš</strong>ã§ã™ã€‚<br>ã“ã“ã‹ã‚‰ãƒ™ãƒƒãƒˆãŒå¤§ãããªã‚‹ã“ã¨ã‚‚å¤šã„ã§ã™ã€‚'
        },
        river: {
            title: 'ğŸƒ ãƒªãƒãƒ¼',
            text: 'æœ€å¾Œã®<strong>5æšç›®</strong>ãŒå…¬é–‹ã•ã‚Œã¾ã—ãŸï¼<br><br>ã“ã‚Œã§å…¨ã¦ã®ã‚«ãƒ¼ãƒ‰ãŒæƒã„ã¾ã—ãŸã€‚æœ€çµ‚çš„ãªå½¹ã§å‹è² ã—ã¾ã—ã‚‡ã†ã€‚<br>è‡ªä¿¡ãŒã‚ã‚Œã°ãƒ¬ã‚¤ã‚ºã€ãªã‘ã‚Œã°ãƒã‚§ãƒƒã‚¯ã‹ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã‚‚æ¤œè¨ã—ã¦ãã ã•ã„ã€‚'
        },
        showdown: {
            title: 'ğŸ† ã‚·ãƒ§ãƒ¼ãƒ€ã‚¦ãƒ³',
            text: 'å…¨å“¡ã®æ‰‹æœ­ãŒå…¬é–‹ã•ã‚Œã¾ã™ï¼<br><br>æœ€ã‚‚å¼·ã„å½¹ã‚’æŒã¤ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒ<strong>ãƒãƒƒãƒˆ</strong>ï¼ˆå ´ã®è³­ã‘é‡‘å…¨é¡ï¼‰ã‚’ç²å¾—ã—ã¾ã™ã€‚'
        },
        end: {
            title: 'âœ… ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å®Œäº†',
            text: 'ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼åŸºæœ¬çš„ãªæµã‚Œã¯ç†è§£ã§ãã¾ã—ãŸã‹ï¼Ÿ<br><br><strong>ãƒ—ãƒªãƒ•ãƒ­ãƒƒãƒ— â†’ ãƒ•ãƒ­ãƒƒãƒ— â†’ ã‚¿ãƒ¼ãƒ³ â†’ ãƒªãƒãƒ¼ â†’ ã‚·ãƒ§ãƒ¼ãƒ€ã‚¦ãƒ³</strong><br><br>æœ¬ç•ªã§ã¯é›£æ˜“åº¦ã‚’é¸ã‚“ã§ãƒ—ãƒ¬ã‚¤ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼'
        }
    };
    const guide = guides[phase];
    if (guide) {
        // å®Œäº†ã‚¬ã‚¤ãƒ‰ã§ã¯ãƒªãƒˆãƒ©ã‚¤ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
        document.getElementById('guideRetryBtn').style.display = phase === 'end' ? 'inline-block' : 'none';
        await showGuide(guide.title, guide.text);
    }
}

async function startInteractiveTutorial() {
    isTutorialMode = true;
    closeTutorial();
    document.getElementById('difficultyScreen').style.display = 'none';
    document.getElementById('gameScreen').style.display = 'block';
    difficulty = 'easy';
    initGame();
    startNewRound();
    await showTutorialGuide('welcome');
    if (isTutorialMode && currentPlayerIndex === 0) {
        await showTutorialGuide('preflop');
    }
}

function endInteractiveTutorial() {
    isTutorialMode = false;
    document.getElementById('gameScreen').style.display = 'none';
    document.getElementById('difficultyScreen').style.display = 'flex';
    stopBGM();
}

function retryTutorial() {
    closeGuide();
    startInteractiveTutorial();
}

function showPhaseAnnouncement(phaseName, subText, isShowdown = false) {
    const el = document.getElementById('phaseAnnouncement');
    el.className = 'phase-announcement';
    el.innerHTML = `
        <div class="phase-text">${phaseName}</div>
        ${subText ? `<div class="phase-sub">${subText}</div>` : ''}
    `;
    if (isShowdown) el.classList.add('showdown');

    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
    void el.offsetWidth; // reflowå¼·åˆ¶
    el.classList.add('show');

    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã«ãƒªã‚»ãƒƒãƒˆ
    setTimeout(() => {
        el.classList.remove('show', 'showdown');
    }, 2000);
}

// ãƒ­ã‚°è¿½åŠ 
function addLog(message) {
    const logEl = document.getElementById('gameLog');
    const entry = document.createElement('div');
    entry.className = 'log-entry';
    entry.textContent = message;
    logEl.insertBefore(entry, logEl.firstChild);

    // æœ€å¤§20ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã¾ã§
    while (logEl.children.length > 20) {
        logEl.removeChild(logEl.lastChild);
    }
}

// ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼è¡¨ç¤º
function showActionIndicator(playerIndex, actionType, amount = null) {
    const infoEl = document.getElementById(`info-${playerIndex}`);
    if (!infoEl) return;

    // æ—¢å­˜ã®ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’å‰Šé™¤
    const existing = infoEl.querySelector('.action-indicator');
    if (existing) existing.remove();

    const indicator = document.createElement('div');
    indicator.className = `action-indicator ${actionType}`;

    let text = actionType.toUpperCase();
    if (amount !== null) {
        text += ` $${amount}`;
    }
    indicator.textContent = text;

    infoEl.appendChild(indicator);

    // 2ç§’å¾Œã«å‰Šé™¤
    setTimeout(() => {
        if (indicator.parentNode) {
            indicator.remove();
        }
    }, 2000);
}

// ãƒãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
function animateChipToPot(playerIndex, amount) {
    const playerEl = document.getElementById(`player-${playerIndex}`);
    const potEl = document.getElementById('potDisplay');
    if (!playerEl || !potEl) {
        console.warn(`Cannot animate chip: player-${playerIndex} or pot not found`);
        return;
    }

    const playerRect = playerEl.getBoundingClientRect();
    const potRect = potEl.getBoundingClientRect();

    // è¦ç´ ãŒç”»é¢ä¸Šã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
    if (playerRect.width === 0 || playerRect.height === 0) {
        console.warn(`Player element not rendered yet: player-${playerIndex}`);
        return;
    }

    const chip = document.createElement('div');
    chip.className = 'chip-animation';
    chip.textContent = 'ğŸ’°';
    chip.style.position = 'fixed';
    chip.style.left = (playerRect.left + playerRect.width / 2) + 'px';
    chip.style.top = (playerRect.top + playerRect.height / 2) + 'px';
    chip.style.setProperty('--tx', (potRect.left + potRect.width / 2 - playerRect.left - playerRect.width / 2) + 'px');
    chip.style.setProperty('--ty', (potRect.top + potRect.height / 2 - playerRect.top - playerRect.height / 2) + 'px');

    document.body.appendChild(chip);

    setTimeout(() => chip.remove(), 1000);
}

// å‹è€…ãƒã‚¤ãƒ©ã‚¤ãƒˆ
function highlightWinner(playerIndex, amount) {
    // å…¨ã‚¿ãƒ¼ãƒ³ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’å‰Šé™¤
    document.querySelectorAll('.turn-indicator').forEach(el => el.remove());

    const infoEl = document.getElementById(`info-${playerIndex}`);
    if (!infoEl) return;

    infoEl.classList.add('winner-glow');

    // Win ãƒãƒƒã‚¸ã‚’è¡¨ç¤º
    const winBadge = document.createElement('div');
    winBadge.className = 'win-badge';
    winBadge.textContent = `WIN +$${amount}`;
    infoEl.appendChild(winBadge);

    setTimeout(() => {
        infoEl.classList.remove('winner-glow');
        winBadge.remove();
    }, 4000);
}

// ãƒãƒ³ãƒ‰è©•ä¾¡ï¼ˆå®Œå…¨ç‰ˆï¼‰
function evaluateHand(holeCards, community) {
    const allCards = [...holeCards, ...community];
    if (allCards.length < 2) return { rank: 0, name: 'ãƒã‚¤ã‚«ãƒ¼ãƒ‰', highCard: 0 };

    // 5æšã®æœ€å¼·ãƒãƒ³ãƒ‰ã‚’è¦‹ã¤ã‘ã‚‹
    let bestHand = { rank: 0, name: 'ãƒã‚¤ã‚«ãƒ¼ãƒ‰', highCard: 0 };

    // 7æšã‹ã‚‰5æšã‚’é¸ã¶çµ„ã¿åˆã‚ã›ã‚’è©•ä¾¡
    if (allCards.length >= 5) {
        const combinations = getCombinations(allCards, 5);
        combinations.forEach(fiveCards => {
            const hand = evaluateFiveCards(fiveCards);
            if (hand.rank > bestHand.rank ||
                (hand.rank === bestHand.rank && hand.highCard > bestHand.highCard)) {
                bestHand = hand;
            }
        });
    } else {
        bestHand = evaluateFiveCards(allCards);
    }

    return bestHand;
}

// 5æšã®ã‚«ãƒ¼ãƒ‰ã‚’è©•ä¾¡
function evaluateFiveCards(cards) {
    const values = cards.map(c => c.numValue).sort((a, b) => b - a);
    const suits = cards.map(c => c.suit);
    const highCard = Math.max(...values);

    // ã‚¹ãƒ¼ãƒˆã®ã‚«ã‚¦ãƒ³ãƒˆ
    const suitCounts = {};
    suits.forEach(s => {
        suitCounts[s] = (suitCounts[s] || 0) + 1;
    });
    const isFlush = Object.values(suitCounts).some(count => count >= 5);

    // ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆåˆ¤å®š
    const isStraight = checkStraight(values);
    const isLowStraight = checkLowStraight(values); // A-2-3-4-5

    // æ•°å­—ã®ã‚«ã‚¦ãƒ³ãƒˆ
    const valueCounts = {};
    values.forEach(v => {
        valueCounts[v] = (valueCounts[v] || 0) + 1;
    });
    const counts = Object.values(valueCounts).sort((a, b) => b - a);

    // ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ•ãƒ©ãƒƒã‚·ãƒ¥åˆ¤å®š (10-J-Q-K-A ã®åŒã˜ã‚¹ãƒ¼ãƒˆ)
    if (isFlush && isStraight && values[0] === 14 && values[1] === 13) {
        return { rank: 10, name: 'ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ•ãƒ©ãƒƒã‚·ãƒ¥', highCard: 14 };
    }

    // ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥åˆ¤å®š
    if (isFlush && (isStraight || isLowStraight)) {
        return { rank: 9, name: 'ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥', highCard: isLowStraight ? 5 : highCard };
    }

    // ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰åˆ¤å®š
    if (counts[0] === 4) {
        return { rank: 8, name: 'ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰', highCard };
    }

    // ãƒ•ãƒ«ãƒã‚¦ã‚¹åˆ¤å®š
    if (counts[0] === 3 && counts[1] >= 2) {
        return { rank: 7, name: 'ãƒ•ãƒ«ãƒã‚¦ã‚¹', highCard };
    }

    // ãƒ•ãƒ©ãƒƒã‚·ãƒ¥åˆ¤å®š
    if (isFlush) {
        return { rank: 6, name: 'ãƒ•ãƒ©ãƒƒã‚·ãƒ¥', highCard };
    }

    // ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆåˆ¤å®š
    if (isStraight || isLowStraight) {
        return { rank: 5, name: 'ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ', highCard: isLowStraight ? 5 : highCard };
    }

    // ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰åˆ¤å®š
    if (counts[0] === 3) {
        return { rank: 4, name: 'ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰', highCard };
    }

    // ãƒ„ãƒ¼ãƒšã‚¢åˆ¤å®š
    if (counts[0] === 2 && counts[1] === 2) {
        return { rank: 3, name: 'ãƒ„ãƒ¼ãƒšã‚¢', highCard };
    }

    // ãƒ¯ãƒ³ãƒšã‚¢åˆ¤å®š
    if (counts[0] === 2) {
        return { rank: 2, name: 'ãƒ¯ãƒ³ãƒšã‚¢', highCard };
    }

    // ãƒã‚¤ã‚«ãƒ¼ãƒ‰
    return { rank: 1, name: 'ãƒã‚¤ã‚«ãƒ¼ãƒ‰', highCard };
}

// ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆåˆ¤å®šï¼ˆé€šå¸¸ï¼‰
function checkStraight(sortedValues) {
    for (let i = 0; i < sortedValues.length - 4; i++) {
        let isStraight = true;
        for (let j = 0; j < 4; j++) {
            if (sortedValues[i + j] - sortedValues[i + j + 1] !== 1) {
                isStraight = false;
                break;
            }
        }
        if (isStraight) return true;
    }
    return false;
}

// ãƒ­ãƒ¼ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆåˆ¤å®šï¼ˆA-2-3-4-5ï¼‰
function checkLowStraight(sortedValues) {
    const hasAce = sortedValues.includes(14);
    const hasTwo = sortedValues.includes(2);
    const hasThree = sortedValues.includes(3);
    const hasFour = sortedValues.includes(4);
    const hasFive = sortedValues.includes(5);
    return hasAce && hasTwo && hasThree && hasFour && hasFive;
}

// é…åˆ—ã‹ã‚‰çµ„ã¿åˆã‚ã›ã‚’ç”Ÿæˆ
function getCombinations(arr, k) {
    const result = [];

    function backtrack(start, current) {
        if (current.length === k) {
            result.push([...current]);
            return;
        }

        for (let i = start; i < arr.length; i++) {
            current.push(arr[i]);
            backtrack(i + 1, current);
            current.pop();
        }
    }

    backtrack(0, []);
    return result;
}

// ãƒãƒ³ãƒ‰æ¯”è¼ƒ
function compareHands(hand1, hand2) {
    if (hand1.rank !== hand2.rank) {
        return hand1.rank - hand2.rank;
    }
    // åŒã˜å½¹ã®å ´åˆã¯ãƒã‚¤ã‚«ãƒ¼ãƒ‰ã§æ¯”è¼ƒ
    return hand1.highCard - hand2.highCard;
}

// æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨ç¤º
function showNextRoundPrompt(title, text) {
    document.getElementById('roundResultTitle').textContent = title;
    document.getElementById('roundResultText').textContent = text;
    document.getElementById('nextRoundOverlay').style.display = 'flex';
}

// æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸é€²ã‚€
function proceedToNextRound() {
    document.getElementById('nextRoundOverlay').style.display = 'none';
    checkGameEnd();
}

// æƒ…å ±è¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆ
function toggleInfo() {
    const log = document.getElementById('gameLog');
    const ranking = document.querySelector('.hand-ranking');

    log.classList.toggle('visible');
    ranking.classList.toggle('visible');
}

console.log('Texas Hold\'em Poker loaded successfully!');
    </script>
</body>
</html>
