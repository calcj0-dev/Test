<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„ÉÜ„Ç≠„Çµ„Çπ„Éõ„Éº„É´„Éá„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f4c29 0%, #1a5f3f 100%);
            min-height: 100vh;
            min-width: 1440px;
            overflow-x: auto;
            overflow-y: auto;
        }

        /* Èõ£ÊòìÂ∫¶ÈÅ∏ÊäûÁîªÈù¢ */
        .screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .screen-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 400px;
        }

        h1 {
            color: #0f4c29;
            margin-bottom: 10px;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #666;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .difficulty-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }

        .difficulty-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 25px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            font-size: 1em;
        }

        .difficulty-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .difficulty-btn.easy:hover { border-color: #4caf50; }
        .difficulty-btn.normal:hover { border-color: #ff9800; }
        .difficulty-btn.hard:hover { border-color: #f44336; }

        .diff-icon { font-size: 2em; }
        .diff-name {
            font-size: 1em;
            font-weight: bold;
            color: #333;
        }
        .diff-desc {
            font-size: 0.9em;
            color: #666;
        }

        /* „Ç≤„Éº„É†ÁîªÈù¢ */
        #gameScreen {
            display: none;
            padding: 20px;
            width: 1400px;
            min-width: 1400px;
            min-height: 900px;
            margin: 0 auto;
            overflow: visible;
        }

        /* „Éò„ÉÉ„ÉÄ„Éº */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px 25px;
            border-radius: 10px;
        }

        .game-title {
            color: #ffd700;
            font-size: 1.8em;
            font-weight: bold;
        }

        .info-toggle-btn {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            border: 1px solid #ffd700;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .info-toggle-btn:hover {
            background: rgba(255, 215, 0, 0.4);
            transform: translateY(-2px);
        }

        .sound-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sound-toggle {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: all 0.3s;
        }

        .sound-toggle.off {
            background: #f44336;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            font-size: 1em;
        }

        .volume-slider {
            width: 100px;
        }

        /* „Éù„Éº„Ç´„Éº„ÉÜ„Éº„Éñ„É´ */
        .poker-table {
            background: radial-gradient(ellipse at center, #2d5016 0%, #1a3d0f 100%);
            border: 15px solid #8b4513;
            border-radius: 50%;
            width: 1000px;
            height: 625px;
            margin: 0 auto 30px;
            position: relative;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), inset 0 0 50px rgba(0, 0, 0, 0.3);
        }

        /* „Éó„É¨„Ç§„É§„ÉºÈÖçÁΩÆ */
        .player-seat {
            position: absolute;
            width: 350px;
            text-align: center;
        }

        .player-seat.seat-0 { bottom: -90px; left: 50%; transform: translateX(-50%); z-index: 10; }
        .player-seat.seat-1 { bottom: 38%; left: -2%; }
        .player-seat.seat-2 { top: 12%; left: 2%; }
        .player-seat.seat-3 { top: 12%; right: 2%; }
        .player-seat.seat-4 { bottom: 38%; right: -2%; }

        .player-info {
            background: rgba(0, 0, 0, 0.85);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 12px 15px;
            margin-bottom: 10px;
            transition: all 0.3s;
            position: relative;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 12px;
        }

        .player-info-column {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
            flex: 1;
            min-width: 0;
            max-width: 150px;
        }

        .player-info.active {
            border-color: #4caf50;
            box-shadow: 0 0 25px rgba(76, 175, 80, 0.6);
            animation: pulse-border 1.5s infinite;
            transform: scale(1.05);
        }

        @keyframes pulse-border {
            0%, 100% {
                border-color: #4caf50;
                box-shadow: 0 0 25px rgba(76, 175, 80, 0.6);
            }
            50% {
                border-color: #8bc34a;
                box-shadow: 0 0 35px rgba(139, 195, 74, 0.8);
            }
        }

        .turn-indicator {
            position: absolute;
            top: -33px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            white-space: nowrap;
            animation: turnIndicatorPulse 1.5s ease-in-out infinite;
            box-shadow: 0 3px 12px rgba(76, 175, 80, 0.6);
            border: 1px solid white;
            z-index: 250;
        }

        @keyframes turnIndicatorPulse {
            0%, 100% {
                transform: translateX(-50%) scale(1);
                box-shadow: 0 3px 12px rgba(76, 175, 80, 0.6);
            }
            50% {
                transform: translateX(-50%) scale(1.05);
                box-shadow: 0 5px 18px rgba(76, 175, 80, 0.8);
            }
        }

        .player-info.folded {
            opacity: 0.4;
            border-color: #666;
        }

        .player-info.all-in {
            border-color: #ff5722;
            box-shadow: 0 0 20px rgba(255, 87, 34, 0.6);
        }

        .player-avatar {
            font-size: 2.5em;
            filter: drop-shadow(2px 2px 3px rgba(0, 0, 0, 0.5));
            flex-shrink: 0;
        }

        .player-name {
            color: #ffd700;
            font-weight: bold;
            font-size: 1.15em;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            white-space: nowrap;
        }

        .player-chips {
            color: #fff;
            font-size: 1.15em;
            font-weight: 500;
        }

        .player-bet {
            background: rgba(255, 152, 0, 0.4);
            color: #ffeb3b;
            padding: 6px 12px;
            border-radius: 10px;
            font-size: 1.3em;
            font-weight: bold;
            border: 1px solid rgba(255, 215, 0, 0.5);
            box-shadow: 0 2px 8px rgba(255, 152, 0, 0.4);
        }

        .player-status {
            color: #4caf50;
            font-size: 0.9em;
            font-style: italic;
            font-weight: bold;
        }

        .action-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            white-space: nowrap;
            animation: actionPop 0.5s ease-out;
            pointer-events: none;
            z-index: 100;
            border: 1px solid white;
        }

        @keyframes actionPop {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.15);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .action-indicator.fold { background: #f44336; }
        .action-indicator.call { background: #2196f3; }
        .action-indicator.raise { background: #ff9800; }
        .action-indicator.check { background: #4caf50; }
        .action-indicator.allin { background: #9c27b0; }

        .winner-glow {
            animation: winnerGlow 1s ease-in-out 3;
            border-color: #ffd700 !important;
        }

        @keyframes winnerGlow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            }
            50% {
                box-shadow: 0 0 40px rgba(255, 215, 0, 1);
            }
        }

        .win-badge {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #000;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1.4em;
            font-weight: bold;
            white-space: nowrap;
            animation: winBadgeAppear 0.6s ease-out;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.6);
            border: 2px solid #fff;
            z-index: 200;
        }

        @keyframes winBadgeAppear {
            0% {
                opacity: 0;
                transform: translateX(-50%) scale(0.3) translateY(30px);
            }
            60% {
                transform: translateX(-50%) scale(1.2) translateY(0);
            }
            100% {
                opacity: 1;
                transform: translateX(-50%) scale(1) translateY(0);
            }
        }

        .hand-badge {
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            color: #ffd700;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 1.1em;
            font-weight: bold;
            white-space: nowrap;
            animation: handBadgeAppear 0.8s ease-out;
            border: 1px solid #ffd700;
            z-index: 150;
        }

        @keyframes handBadgeAppear {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            100% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .chip-animation {
            position: absolute;
            font-size: 3.5em;
            animation: chipToPot 1.2s ease-in-out forwards;
            pointer-events: none;
            z-index: 50;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.8));
        }

        @keyframes chipToPot {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0.5);
            }
        }

        .dealer-button {
            background: white;
            color: #0f4c29;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1em;
            position: absolute;
            top: -15px;
            right: -15px;
            border: 1px solid #ffd700;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .blind-indicator {
            position: absolute;
            top: -12px;
            left: -12px;
            background: linear-gradient(135deg, #f44336 0%, #e53935 100%);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            border: 1px solid white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
            z-index: 10;
        }

        /* „Ç´„Éº„ÉâË°®Á§∫ */
        .player-cards {
            display: flex;
            gap: 5px;
            justify-content: center;
            flex-shrink: 0;
        }

        .card {
            width: 65px;
            height: 90px;
            background: white;
            border: 1px solid #333;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.3em;
            box-shadow: 0 3px 7px rgba(0, 0, 0, 0.5);
            position: relative;
            transition: transform 0.3s ease;
            /* animation removed - only animate when explicitly adding animation classes */
        }

        @keyframes cardAppear {
            from {
                opacity: 0;
                transform: scale(0.3) translateY(-50px) rotateY(90deg);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0) rotateY(0deg);
            }
        }

        .card.deal-animation {
            animation: cardDeal 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes cardDeal {
            0% {
                opacity: 0;
                transform: translate(var(--deal-from-x, 0px), var(--deal-from-y, 150px)) scale(0.5) rotate(-20deg);
            }
            60% {
                opacity: 1;
                transform: translate(0, 0) scale(1.1) rotate(3deg);
            }
            100% {
                opacity: 1;
                transform: translate(0, 0) scale(1) rotate(0deg);
            }
        }

        .card.initial-deal {
            animation: cardInitialDeal 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes cardInitialDeal {
            0% {
                opacity: 0;
                transform: translate(var(--deal-from-x, 0px), var(--deal-from-y, 150px)) rotate(-180deg) scale(0.5);
            }
            70% {
                opacity: 1;
                transform: translate(0, 0) rotate(10deg) scale(1.1);
            }
            100% {
                opacity: 1;
                transform: translate(0, 0) rotate(0deg) scale(1);
            }
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card.back {
            background:
                repeating-linear-gradient(45deg, #1e3c72 0px, #1e3c72 10px, #2a5298 10px, #2a5298 20px),
                repeating-linear-gradient(-45deg, #2a5298 0px, #2a5298 10px, #1e3c72 10px, #1e3c72 20px);
            border: 3px solid #4a6fa5;
            position: relative;
            overflow: hidden;
        }

        .card.back::before {
            content: '‚ô†‚ô•‚ô¶‚ô£';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5em;
            color: rgba(255, 255, 255, 0.3);
            letter-spacing: 3px;
        }

        .card.back::after {
            content: '';
            position: absolute;
            width: 40px;
            height: 40px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .card.hearts, .card.diamonds {
            color: #e53935;
        }

        .card.spades, .card.clubs {
            color: #212121;
        }

        .card-suit {
            font-size: 1.1em;
        }

        .card-value {
            font-size: 1.4em;
        }

        /* „Ç≥„Éü„É•„Éã„ÉÜ„Ç£„Ç´„Éº„Éâ */
        .community-cards {
            position: absolute;
            top: 45%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 12px;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            min-height: 130px;
            align-items: center;
            border: 1px dashed rgba(255, 255, 255, 0.2);
        }

        .card-placeholder {
            width: 80px;
            height: 110px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px dashed rgba(255, 255, 255, 0.3);
            border-radius: 5px;
        }

        .community-cards .card {
            width: 80px;
            height: 110px;
            font-size: 1.5em;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.5);
        }

        .community-cards .card .card-value {
            font-size: 1.6em;
        }

        /* „Éù„ÉÉ„Éà */
        .pot-display {
            position: absolute;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 15px 30px;
            color: #ffd700;
            font-size: 1.5em;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        /* „Éñ„É©„Ç§„É≥„ÉâÊÉÖÂ†± */
        .blinds-info {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #ff9800;
            border-radius: 10px;
            padding: 12px 20px;
            color: white;
            font-size: 0.95em;
        }

        .blinds-info div {
            margin: 2px 0;
        }

        .blinds-label {
            color: #ffd700;
            font-weight: bold;
        }

        /* „Éà„É©„É≥„Éó„ÅÆÂ±± */
        .deck-area {
            position: absolute;
            top: 65%;
            left: 50%;
            transform: translateX(-50%);
        }

        .deck-stack {
            position: relative;
            width: 53px;
            height: 73px;
        }

        .deck-card {
            position: absolute;
            width: 53px;
            height: 73px;
            background: repeating-linear-gradient(45deg, #1e3c72 0px, #1e3c72 7px, #2a5298 7px, #2a5298 14px);
            border: 2px solid #4a6fa5;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .deck-card:nth-child(1) { top: 0; left: 0; }
        .deck-card:nth-child(2) { top: 1px; left: 1px; }
        .deck-card:nth-child(3) { top: 2px; left: 2px; }

        /* „Ç¢„ÇØ„Ç∑„Éß„É≥„Éë„Éç„É´ */
        .action-panel {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 20px;
            max-width: 400px;
            margin: 0 auto;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .action-btn {
            flex: 1;
            min-width: 80px;
            padding: 15px 20px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .action-btn.fold {
            background: #f44336;
            color: white;
        }

        .action-btn.check {
            background: #4caf50;
            color: white;
        }

        .action-btn.call {
            background: #2196f3;
            color: white;
        }

        .action-btn.raise {
            background: #ff9800;
            color: white;
        }

        .action-btn.all-in {
            background: #9c27b0;
            color: white;
        }

        .action-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .raise-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .raise-amount {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 10px;
        }

        .amount-display {
            color: #ffd700;
            font-size: 1.5em;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
        }

        .amount-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
        }

        .amount-btn:hover {
            background: #45a049;
        }

        .increment-selector {
            display: flex;
            gap: 10px;
        }

        .increment-radio {
            display: none;
        }

        .increment-label {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }

        .increment-radio:checked + .increment-label {
            background: #ffd700;
            color: #333;
        }

        /* „Ç≤„Éº„É†„É≠„Ç∞ */
        .game-log {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #666;
            border-radius: 10px;
            padding: 15px;
            max-width: 400px;
            margin: 20px auto;
            max-height: 180px;
            overflow-y: auto;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5);
            display: none;
        }

        .game-log.visible {
            display: block;
        }

        .log-entry {
            color: #e0e0e0;
            padding: 6px 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            font-size: 0.95em;
            line-height: 1.4;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-entry:first-child {
            color: #ffeb3b;
            font-weight: 500;
        }

        /* „Éè„É≥„Éâ„É©„É≥„Ç≠„É≥„Ç∞ */
        .hand-ranking {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #ffd700;
            border-radius: 10px;
            padding: 15px;
            max-width: 400px;
            margin: 20px auto;
            color: white;
            display: none;
        }

        .hand-ranking.visible {
            display: block;
        }

        .hand-ranking h3 {
            color: #ffd700;
            margin-bottom: 10px;
            text-align: center;
            font-size: 1.5em;
        }

        .hand-list {
            font-size: 0.9em;
            line-height: 1.8;
        }

        .back-btn {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 30px;
            background: #e0e0e0;
            color: #333;
            text-decoration: none;
            border-radius: 50px;
            transition: all 0.3s;
            font-weight: bold;
            font-size: 1em;
        }

        .back-btn:hover {
            background: #d0d0d0;
            transform: translateY(-2px);
        }

        /* ÁµêÊûúÁîªÈù¢ */
        .result-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        /* Ê¨°„ÅÆ„É©„Ç¶„É≥„Éâ„Å∏„ÅÆÂæÖÊ©ü„Ç™„Éº„Éê„Éº„É¨„Ç§ */
        .next-round-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 900;
            cursor: pointer;
        }

        .next-round-message {
            background: linear-gradient(135deg, #1a5f3f 0%, #0f4c29 100%);
            padding: 40px 60px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid #ffd700;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            animation: messageFloat 2s ease-in-out infinite;
        }

        @keyframes messageFloat {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .next-round-message h2 {
            color: #ffd700;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .next-round-message p {
            color: white;
            font-size: 1.2em;
            margin: 10px 0;
        }

        .click-hint {
            color: #ffeb3b;
            font-size: 1.5em;
            margin-top: 20px;
            animation: blink 1.5s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.3;
            }
        }

        .result-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
        }

        .result-title {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .result-message {
            font-size: 1.3em;
            color: #666;
            margin-bottom: 20px;
        }

        .result-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .result-btn {
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .result-btn.primary {
            background: linear-gradient(135deg, #0f4c29 0%, #1a5f3f 100%);
            color: white;
        }

        .result-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* „É¨„Çπ„Éù„É≥„Ç∑„Éñ */
        @media (max-width: 1050px) {
            .poker-table {
                width: 900px;
                height: 562px;
            }
        }

        @media (max-width: 950px) {
            .poker-table {
                width: 800px;
                height: 500px;
            }

            .player-seat {
                width: 100px;
            }

            .card {
                width: 30px;
                height: 42px;
                font-size: 0.6em;
            }

            .community-cards {
                gap: 5px;
                padding: 7px 10px;
            }

            .community-cards .card {
                width: 37px;
                height: 51px;
            }

            .pot-display {
                font-size: 0.8em;
                padding: 7px 13px;
            }

            .blinds-info {
                font-size: 0.57em;
                padding: 5px 10px;
            }

            .player-name {
                font-size: 0.67em;
            }

            .player-chips {
                font-size: 0.67em;
            }

            .player-avatar {
                font-size: 1.33em;
            }

            .action-indicator {
                font-size: 0.53em;
                padding: 4px 7px;
            }
        }

        @media (max-width: 600px) {
            .card {
                width: 25px;
                height: 35px;
            }

            .community-cards .card {
                width: 30px;
                height: 42px;
            }

            .player-seat {
                width: 80px;
            }

            .blinds-info {
                top: 7px;
                right: 7px;
                font-size: 0.5em;
                padding: 4px 7px;
            }

            .player-avatar {
                font-size: 1.2em;
            }

            .action-indicator {
                font-size: 0.47em;
                padding: 3px 5px;
            }
        }
    </style>
</head>
<body>
    <!-- Èõ£ÊòìÂ∫¶ÈÅ∏ÊäûÁîªÈù¢ -->
    <div id="difficultyScreen" class="screen">
        <div class="screen-container">
            <h1>üé∞ „ÉÜ„Ç≠„Çµ„Çπ„Éõ„Éº„É´„Éá„É†</h1>
            <h2>Èõ£ÊòìÂ∫¶„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h2>
            <div class="difficulty-buttons">
                <button class="difficulty-btn easy" onclick="startGame('easy')">
                    <span class="diff-icon">üòä</span>
                    <span class="diff-name">ÂàùÁ¥ö</span>
                    <span class="diff-desc">„Çø„Ç§„Éà„Éó„É¨„Ç§ - Âº∑„ÅÑÊâã„ÅÆ„Åø</span>
                </button>
                <button class="difficulty-btn normal" onclick="startGame('normal')">
                    <span class="diff-icon">ü§î</span>
                    <span class="diff-name">‰∏≠Á¥ö</span>
                    <span class="diff-desc">„Éê„É©„É≥„ÇπÂûã - ÈÅ©Â∫¶„Å´„Éñ„É©„Éï</span>
                </button>
                <button class="difficulty-btn hard" onclick="startGame('hard')">
                    <span class="diff-icon">üß†</span>
                    <span class="diff-name">‰∏äÁ¥ö</span>
                    <span class="diff-desc">„Ç¢„Ç∞„É¨„ÉÉ„Ç∑„Éñ - „Éñ„É©„ÉïÂ§öÁî®</span>
                </button>
            </div>
            <a href="index.html" class="back-btn">„É°„Éã„É•„Éº„Å´Êàª„Çã</a>
        </div>
    </div>

    <!-- „Ç≤„Éº„É†ÁîªÈù¢ -->
    <div id="gameScreen">
        <div class="game-header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div class="game-title">üé∞ Texas Hold'em</div>
                <button class="info-toggle-btn" onclick="toggleInfo()">üìä ÊÉÖÂ†±Ë°®Á§∫</button>
            </div>
            <div class="sound-controls">
                <button id="soundToggle" class="sound-toggle" onclick="toggleSound()">üîä ON</button>
                <div class="volume-control">
                    <span>üîâ</span>
                    <input type="range" id="volumeSlider" class="volume-slider" min="0" max="100" value="50" oninput="changeVolume(this.value)">
                    <span id="volumeDisplay">50%</span>
                </div>
            </div>
        </div>

        <div class="poker-table" id="pokerTable">
            <!-- „Éó„É¨„Ç§„É§„ÉºÂ∏≠ÔºàÂãïÁöÑ„Å´ÁîüÊàêÔºâ -->
            <div class="pot-display" id="potDisplay">Pot: $0</div>
            <div class="blinds-info">
                <div><span class="blinds-label">SB:</span> $<span id="sbAmount">100</span></div>
                <div><span class="blinds-label">BB:</span> $<span id="bbAmount">200</span></div>
            </div>
            <div class="deck-area">
                <div class="deck-stack">
                    <div class="deck-card"></div>
                    <div class="deck-card"></div>
                    <div class="deck-card"></div>
                </div>
            </div>
            <div class="community-cards" id="communityCards"></div>
        </div>

        <div class="action-panel" id="actionPanel">
            <div class="action-buttons">
                <button class="action-btn fold" onclick="playerAction('fold')">Fold</button>
                <button class="action-btn check" id="checkBtn" onclick="playerAction('check')">Check</button>
                <button class="action-btn call" id="callBtn" onclick="playerAction('call')">Call</button>
                <button class="action-btn raise" onclick="playerAction('raise')">Raise</button>
                <button class="action-btn all-in" onclick="playerAction('allin')">All In</button>
            </div>
            <div class="raise-controls" id="raiseControls">
                <div class="increment-selector">
                    <input type="radio" name="increment" id="inc100" class="increment-radio" value="100" checked>
                    <label for="inc100" class="increment-label">+100</label>
                    <input type="radio" name="increment" id="inc1000" class="increment-radio" value="1000">
                    <label for="inc1000" class="increment-label">+1000</label>
                </div>
                <div class="raise-amount">
                    <button class="amount-btn" onclick="adjustRaise(-1)">‚ñº</button>
                    <div class="amount-display" id="raiseAmount">400</div>
                    <button class="amount-btn" onclick="adjustRaise(1)">‚ñ≤</button>
                </div>
            </div>
        </div>

        <div class="game-log" id="gameLog"></div>

        <div class="hand-ranking">
            <h3>„Éè„É≥„Éâ„É©„É≥„Ç≠„É≥„Ç∞</h3>
            <div class="hand-list">
                1. „É≠„Ç§„É§„É´„Éï„É©„ÉÉ„Ç∑„É•<br>
                2. „Çπ„Éà„É¨„Éº„Éà„Éï„É©„ÉÉ„Ç∑„É•<br>
                3. „Éï„Ç©„Éº„Ç´„Éº„Éâ<br>
                4. „Éï„É´„Éè„Ç¶„Çπ<br>
                5. „Éï„É©„ÉÉ„Ç∑„É•<br>
                6. „Çπ„Éà„É¨„Éº„Éà<br>
                7. „Çπ„É™„Éº„Ç´„Éº„Éâ<br>
                8. „ÉÑ„Éº„Éö„Ç¢<br>
                9. „ÉØ„É≥„Éö„Ç¢<br>
                10. „Éè„Ç§„Ç´„Éº„Éâ
            </div>
        </div>
    </div>

    <!-- ÁµêÊûú„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
    <div class="result-overlay" id="resultOverlay">
        <div class="result-content">
            <div class="result-title" id="resultTitle"></div>
            <div class="result-message" id="resultMessage"></div>
            <div class="result-buttons">
                <button class="result-btn primary" onclick="restartGame()">ÂÜçÊåëÊà¶</button>
                <button class="result-btn" onclick="backToMenu()">Èõ£ÊòìÂ∫¶ÈÅ∏Êäû</button>
            </div>
        </div>
    </div>

    <!-- Ê¨°„ÅÆ„É©„Ç¶„É≥„Éâ„Å∏ -->
    <div class="next-round-overlay" id="nextRoundOverlay" onclick="proceedToNextRound()">
        <div class="next-round-message">
            <h2 id="roundResultTitle">„É©„Ç¶„É≥„ÉâÁµÇ‰∫Ü</h2>
            <p id="roundResultText"></p>
            <div class="click-hint">üëÜ „ÇØ„É™„ÉÉ„ÇØ„ÅßÊ¨°„ÅÆ„É©„Ç¶„É≥„Éâ„Å∏</div>
        </div>
    </div>

    <script>
// „Ç≤„Éº„É†Ë®≠ÂÆö
const INITIAL_CHIPS = 10000;
const SMALL_BLIND = 100;
const BIG_BLIND = 200;
const PLAYER_NAMES = ['„ÅÇ„Å™„Åü', 'CPU1', 'CPU2', 'CPU3', 'CPU4'];
const PLAYER_AVATARS = ['ü¶Å', 'üê±', 'üê®', 'üêò', 'üê∂'];

// „Çø„Ç§„Éü„É≥„Ç∞ÂÆöÊï∞
const DELAYS = {
    CPU_TURN: 1500,
    CPU_ACTION: 1000,
    NEXT_PLAYER: 800,
    CARD_ANIMATION: 2000,
    ANIMATION_CLEAR: 1000,
    BLIND_ANIMATION: 100,
    WINNER_HIGHLIGHT: 1500,
    SHOWDOWN_CARDS: 500,
    NEXT_ROUND_PROMPT: 3000,
    SHOWDOWN_NEXT_ROUND: 5000,
    GAME_END_CHECK: 2000
};

// „Ç≤„Éº„É†Áä∂ÊÖã
let difficulty = 'normal';
let players = [];
let deck = [];
let communityCards = [];
let pot = 0;
let currentBet = 0;
let dealerPosition = 0;
let currentPlayerIndex = 0;
let gamePhase = 'preflop'; // preflop, flop, turn, river, showdown
let soundEnabled = true;
let volume = 0.5;
let justDealtCards = false; // „Ç´„Éº„Éâ„ÅåÈÖç„Çâ„Çå„ÅüÁõ¥Âæå„Åã„Å©„ÅÜ„Åã
let newCommunityCards = []; // Êñ∞„Åó„ÅèËøΩÂä†„Åï„Çå„Åü„Ç≥„Éü„É•„Éã„ÉÜ„Ç£„Ç´„Éº„Éâ

// BGMÁî®„ÅÆAudioContext
let audioContext = null;
let bgmGainNode = null;
let bgmOscillators = [];
let bgmIsPlaying = false;

// „Çµ„Ç¶„É≥„ÉâË®≠ÂÆö
function toggleSound() {
    soundEnabled = !soundEnabled;
    const btn = document.getElementById('soundToggle');
    btn.textContent = soundEnabled ? 'üîä ON' : 'üîá OFF';
    btn.classList.toggle('off', !soundEnabled);
    localStorage.setItem('soundEnabled', soundEnabled);

    // BGM„ÅÆÂà∂Âæ°
    if (soundEnabled) {
        playBGM();
    } else {
        stopBGM();
    }
}

function changeVolume(value) {
    volume = value / 100;
    document.getElementById('volumeDisplay').textContent = value + '%';
    localStorage.setItem('volume', volume);
    updateBGMVolume();
}

// localStorage „Åã„ÇâË®≠ÂÆö„ÇíË™≠„ÅøËæº„Åø
window.addEventListener('load', () => {
    const savedSound = localStorage.getItem('soundEnabled');
    const savedVolume = localStorage.getItem('volume');
    if (savedSound !== null) {
        soundEnabled = savedSound === 'true';
        const btn = document.getElementById('soundToggle');
        btn.textContent = soundEnabled ? 'üîä ON' : 'üîá OFF';
        btn.classList.toggle('off', !soundEnabled);
    }
    if (savedVolume !== null) {
        volume = parseFloat(savedVolume);
        const slider = document.getElementById('volumeSlider');
        slider.value = volume * 100;
        document.getElementById('volumeDisplay').textContent = Math.round(volume * 100) + '%';
    }
});

// BGMÂàùÊúüÂåñ
function initBGM() {
    if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        bgmGainNode = audioContext.createGain();
        bgmGainNode.connect(audioContext.destination);
        bgmGainNode.gain.value = volume * 0.15; // BGM„ÅØÊéß„Åà„ÇÅ„Å´
    }
}

// BGMÂÜçÁîü
function playBGM() {
    if (bgmIsPlaying) return;

    try {
        initBGM();

        // „Ç™„Éº„Éá„Ç£„Ç™„Ç≥„É≥„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÜçÈñãÔºà„Éñ„É©„Ç¶„Ç∂„ÅÆ„Éù„É™„Ç∑„ÉºÂØæÁ≠ñÔºâ
        if (audioContext.state === 'suspended') {
            audioContext.resume();
        }

        bgmIsPlaying = true;
    } catch (error) {
        console.error('BGM playback error:', error);
        return;
    }

    // „Ç≥„Éº„ÉâÈÄ≤Ë°å: Cm - Ab - Eb - Bb (Êöó„ÇÅ„ÅÆ„Éù„Éº„Ç´„ÉºÈõ∞Âõ≤Ê∞ó)
    const chords = [
        [261.63, 311.13, 392.00], // Cm
        [207.65, 261.63, 311.13], // Ab
        [311.13, 369.99, 466.16], // Eb
        [233.08, 293.66, 349.23]  // Bb
    ];

    let chordIndex = 0;

    function playChord() {
        if (!bgmIsPlaying) return;

        // Ââç„ÅÆ„Ç™„Ç∑„É¨„Éº„Çø„Éº„ÇíÂÅúÊ≠¢
        bgmOscillators.forEach(osc => {
            try {
                osc.stop();
            } catch(e) {}
        });
        bgmOscillators = [];

        const chord = chords[chordIndex];
        const now = audioContext.currentTime;

        // ÂêÑÈü≥„ÇíÂÜçÁîü
        chord.forEach((freq, i) => {
            const osc = audioContext.createOscillator();
            const oscGain = audioContext.createGain();

            osc.type = 'sine';
            osc.frequency.value = freq;

            // Èü≥Èáè„Ç®„É≥„Éô„É≠„Éº„ÉóÔºà„ÇÜ„Å£„Åè„Çä„Éï„Çß„Éº„Éâ„Ç§„É≥/„Ç¢„Ç¶„ÉàÔºâ
            oscGain.gain.setValueAtTime(0, now);
            oscGain.gain.linearRampToValueAtTime(0.05 * (1 - i * 0.2), now + 0.5);
            oscGain.gain.setValueAtTime(0.05 * (1 - i * 0.2), now + 3.5);
            oscGain.gain.linearRampToValueAtTime(0, now + 4);

            osc.connect(oscGain);
            oscGain.connect(bgmGainNode);

            osc.start(now);
            osc.stop(now + 4);

            bgmOscillators.push(osc);
        });

        // „Éô„Éº„ÇπÈü≥Ôºà„Ç™„ÇØ„Çø„Éº„Éñ‰∏ãÔºâ
        const bassOsc = audioContext.createOscillator();
        const bassGain = audioContext.createGain();

        bassOsc.type = 'triangle';
        bassOsc.frequency.value = chord[0] / 2;

        bassGain.gain.setValueAtTime(0, now);
        bassGain.gain.linearRampToValueAtTime(0.08, now + 0.3);
        bassGain.gain.setValueAtTime(0.08, now + 3.7);
        bassGain.gain.linearRampToValueAtTime(0, now + 4);

        bassOsc.connect(bassGain);
        bassGain.connect(bgmGainNode);

        bassOsc.start(now);
        bassOsc.stop(now + 4);

        bgmOscillators.push(bassOsc);

        chordIndex = (chordIndex + 1) % chords.length;

        // Ê¨°„ÅÆ„Ç≥„Éº„Éâ„Çí‰∫àÁ¥Ñ
        if (bgmIsPlaying) {
            setTimeout(playChord, 3800);
        }
    }

    playChord();
}

// BGMÂÅúÊ≠¢
function stopBGM() {
    bgmIsPlaying = false;
    bgmOscillators.forEach(osc => {
        try {
            osc.stop();
        } catch(e) {}
    });
    bgmOscillators = [];
}

// BGMÈü≥ÈáèÊõ¥Êñ∞
function updateBGMVolume() {
    if (bgmGainNode) {
        bgmGainNode.gain.value = volume * 0.15;
    }
}

// „Çµ„Ç¶„É≥„ÉâÂÜçÁîüÔºàWeb Audio API„ÅßÂäπÊûúÈü≥„ÇíÁîüÊàêÔºâ
function playSound(type) {
    if (!soundEnabled) return;

    try {
        initBGM(); // AudioContext„ÇíÁ¢∫‰øù

        const now = audioContext.currentTime;

    switch(type) {
        case 'shuffle':
        case 'card':
            // „Ç´„Éº„ÉâÈü≥ÔºàÁü≠„ÅÑ„Éõ„ÉØ„Ç§„Éà„Éé„Ç§„Ç∫Ôºâ
            const cardBuffer = audioContext.createBuffer(1, audioContext.sampleRate * 0.1, audioContext.sampleRate);
            const cardData = cardBuffer.getChannelData(0);
            for (let i = 0; i < cardData.length; i++) {
                cardData[i] = (Math.random() * 2 - 1) * 0.3;
            }
            const cardSource = audioContext.createBufferSource();
            const cardGain = audioContext.createGain();
            const cardFilter = audioContext.createBiquadFilter();

            cardFilter.type = 'highpass';
            cardFilter.frequency.value = 2000;

            cardSource.buffer = cardBuffer;
            cardGain.gain.setValueAtTime(volume * 0.3, now);
            cardGain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);

            cardSource.connect(cardFilter);
            cardFilter.connect(cardGain);
            cardGain.connect(audioContext.destination);

            cardSource.start(now);
            break;

        case 'chips':
            // „ÉÅ„ÉÉ„ÉóÈü≥ÔºàË§áÊï∞„ÅÆÁü≠„ÅÑ„Éì„Éº„ÉóÔºâ
            for (let i = 0; i < 3; i++) {
                const chipOsc = audioContext.createOscillator();
                const chipGain = audioContext.createGain();

                chipOsc.type = 'square';
                chipOsc.frequency.value = 800 + i * 100;

                const startTime = now + i * 0.05;
                chipGain.gain.setValueAtTime(volume * 0.15, startTime);
                chipGain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.08);

                chipOsc.connect(chipGain);
                chipGain.connect(audioContext.destination);

                chipOsc.start(startTime);
                chipOsc.stop(startTime + 0.08);
            }
            break;

        case 'win':
            // ÂãùÂà©Èü≥Ôºà‰∏äÊòá„Åô„Çã„Ç¢„É´„Éö„Ç∏„Ç™Ôºâ
            const winNotes = [523.25, 659.25, 783.99, 1046.50]; // C5-E5-G5-C6
            winNotes.forEach((freq, i) => {
                const winOsc = audioContext.createOscillator();
                const winGain = audioContext.createGain();

                winOsc.type = 'sine';
                winOsc.frequency.value = freq;

                const startTime = now + i * 0.15;
                winGain.gain.setValueAtTime(volume * 0.2, startTime);
                winGain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);

                winOsc.connect(winGain);
                winGain.connect(audioContext.destination);

                winOsc.start(startTime);
                winOsc.stop(startTime + 0.3);
            });
            break;

        case 'click':
            // „Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØÈü≥
            const clickOsc = audioContext.createOscillator();
            const clickGain = audioContext.createGain();

            clickOsc.type = 'sine';
            clickOsc.frequency.setValueAtTime(600, now);
            clickOsc.frequency.exponentialRampToValueAtTime(300, now + 0.05);

            clickGain.gain.setValueAtTime(volume * 0.2, now);
            clickGain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);

            clickOsc.connect(clickGain);
            clickGain.connect(audioContext.destination);

            clickOsc.start(now);
            clickOsc.stop(now + 0.05);
            break;
    }
    } catch (error) {
        console.error('Sound playback error:', error);
    }
}

// „Ç≤„Éº„É†ÈñãÂßã
function startGame(selectedDifficulty) {
    difficulty = selectedDifficulty;
    initGame();
    document.getElementById('difficultyScreen').style.display = 'none';
    document.getElementById('gameScreen').style.display = 'block';

    // BGMÈñãÂßã
    if (soundEnabled) {
        playBGM();
    }

    startNewRound();
}

// „Ç≤„Éº„É†ÂàùÊúüÂåñ
function initGame() {
    players = PLAYER_NAMES.map((name, index) => ({
        id: index,
        name: name,
        chips: INITIAL_CHIPS,
        cards: [],
        bet: 0,
        folded: false,
        allIn: false,
        isDealer: false,
        isSmallBlind: false,
        isBigBlind: false,
        isActive: true
    }));
    
    dealerPosition = 0;
    renderPlayers();
    addLog('„Ç≤„Éº„É†ÈñãÂßãÔºÅÂàùÊúü„ÉÅ„ÉÉ„Éó: $' + INITIAL_CHIPS);
}

// „Éó„É¨„Ç§„É§„ÉºË°®Á§∫„Çí‰ΩúÊàêÔºàÂàùÊúüÂåñÊôÇ„ÅÆ„ÅøÔºâ
function renderPlayers() {
    const table = document.getElementById('pokerTable');
    // Êó¢Â≠ò„ÅÆ„Éó„É¨„Ç§„É§„ÉºÂ∏≠„ÇíÂâäÈô§
    document.querySelectorAll('.player-seat').forEach(el => el.remove());

    players.forEach((player, index) => {
        const seat = document.createElement('div');
        seat.className = `player-seat seat-${index}`;
        seat.id = `player-${index}`;

        seat.innerHTML = `
            <div class="player-info" id="info-${index}">
                <div class="player-avatar">${PLAYER_AVATARS[index]}</div>
                <div class="player-info-column">
                    <div class="player-name">${player.name}</div>
                    <div class="player-chips" id="chips-${index}">üí∞ $${player.chips}</div>
                    <div class="player-bet" id="bet-${index}"></div>
                    <div class="player-status" id="status-${index}"></div>
                </div>
                <div class="player-cards" id="cards-${index}"></div>
            </div>
        `;

        table.appendChild(seat);
    });
}

// Êñ∞„Åó„ÅÑ„É©„Ç¶„É≥„ÉâÈñãÂßã
function startNewRound() {
    // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Éó„É¨„Ç§„É§„Éº„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    const activePlayers = players.filter(p => p.isActive);
    if (activePlayers.length === 1) {
        // „Ç≤„Éº„É†ÁµÇ‰∫Ü
        if (activePlayers[0].id === 0) {
            showResult('üéâ ÂÑ™ÂãùÔºÅ', '„Åô„Åπ„Å¶„ÅÆÁõ∏Êâã„ÇíÂÄí„Åó„Åæ„Åó„ÅüÔºÅ');
        }
        return;
    }

    // Áä∂ÊÖã„É™„Çª„ÉÉ„Éà
    deck = createDeck();
    communityCards = [];
    pot = 0;
    currentBet = 0;
    gamePhase = 'preflop';

    players.forEach(player => {
        player.cards = [];
        player.bet = 0;
        player.folded = false;
        player.allIn = false;
        player.isDealer = false;
        player.isSmallBlind = false;
        player.isBigBlind = false;
    });

    // „Éá„Ç£„Éº„É©„Éº„Éª„Éñ„É©„Ç§„É≥„Éâ„ÇíË®≠ÂÆö
    setPositions();

    // „Ç´„Éº„Éâ„ÇíÈÖç„Çã
    dealCards();

    // „Éñ„É©„Ç§„É≥„Éâ„ÇíÂæ¥Âèé
    collectBlinds();

    // „Éó„É™„Éï„É≠„ÉÉ„ÉóÈñãÂßãÔºà„Éì„ÉÉ„Ç∞„Éñ„É©„Ç§„É≥„Éâ„ÅÆÊ¨°„Åã„ÇâÔºâ
    let bbPos = players.findIndex(p => p.isBigBlind);
    currentPlayerIndex = (bbPos + 1) % players.length;

    // „Çπ„Ç≠„ÉÉ„Éó„Åó„Å¶Ê¨°„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Éó„É¨„Ç§„É§„Éº„Å∏
    while (!players[currentPlayerIndex].isActive || players[currentPlayerIndex].folded) {
        currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
    }

    updateDisplay();
    playSound('shuffle');
    addLog('--- Êñ∞„Åó„ÅÑ„É©„Ç¶„É≥„ÉâÈñãÂßã ---');

    if (currentPlayerIndex !== 0) {
        setTimeout(() => cpuTurn(), DELAYS.CPU_TURN);
    }
}

// „Éá„ÉÉ„Ç≠„Çí‰ΩúÊàê
function createDeck() {
    const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
    const suitNames = ['spades', 'hearts', 'diamonds', 'clubs'];
    const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    const deck = [];
    
    suits.forEach((suit, suitIndex) => {
        values.forEach(value => {
            deck.push({
                suit: suit,
                suitName: suitNames[suitIndex],
                value: value,
                numValue: value === 'A' ? 14 : (value === 'K' ? 13 : (value === 'Q' ? 12 : (value === 'J' ? 11 : parseInt(value))))
            });
        });
    });
    
    // „Ç∑„É£„ÉÉ„Éï„É´
    for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
    }
    
    return deck;
}

// „Éù„Ç∏„Ç∑„Éß„É≥Ë®≠ÂÆö
function setPositions() {
    // „Éá„Ç£„Éº„É©„Éº„Éú„Çø„É≥„ÇíÊ¨°„ÅÆ‰∫∫„Å´
    do {
        dealerPosition = (dealerPosition + 1) % players.length;
    } while (!players[dealerPosition].isActive);
    
    players[dealerPosition].isDealer = true;
    
    // „Çπ„É¢„Éº„É´„Éñ„É©„Ç§„É≥„Éâ
    let sbPos = (dealerPosition + 1) % players.length;
    while (!players[sbPos].isActive) {
        sbPos = (sbPos + 1) % players.length;
    }
    players[sbPos].isSmallBlind = true;
    
    // „Éì„ÉÉ„Ç∞„Éñ„É©„Ç§„É≥„Éâ
    let bbPos = (sbPos + 1) % players.length;
    while (!players[bbPos].isActive) {
        bbPos = (bbPos + 1) % players.length;
    }
    players[bbPos].isBigBlind = true;
}

// „Ç´„Éº„Éâ„ÇíÈÖç„Çã
function dealCards() {
    players.forEach(player => {
        if (player.isActive && !player.folded) {
            player.cards = [deck.pop(), deck.pop()];
        }
    });

    justDealtCards = true; // „Ç´„Éº„ÉâÈÖçÂ∏É„Éï„É©„Ç∞„ÇíÁ´ã„Å¶„Çã
}

// „Éñ„É©„Ç§„É≥„ÉâÂæ¥Âèé
function collectBlinds() {
    const sbPlayer = players.find(p => p.isSmallBlind);
    const bbPlayer = players.find(p => p.isBigBlind);

    const sbAmount = Math.min(SMALL_BLIND, sbPlayer.chips);
    const bbAmount = Math.min(BIG_BLIND, bbPlayer.chips);

    sbPlayer.chips -= sbAmount;
    sbPlayer.bet = sbAmount;
    pot += sbAmount;

    bbPlayer.chips -= bbAmount;
    bbPlayer.bet = bbAmount;
    pot += bbAmount;

    currentBet = BIG_BLIND;

    addLog(`${sbPlayer.name} „Åå„Çπ„É¢„Éº„É´„Éñ„É©„Ç§„É≥„Éâ $${sbAmount} „ÇíÊîØÊâï„ÅÑ„Åæ„Åó„Åü`);
    addLog(`${bbPlayer.name} „Åå„Éì„ÉÉ„Ç∞„Éñ„É©„Ç§„É≥„Éâ $${bbAmount} „ÇíÊîØÊâï„ÅÑ„Åæ„Åó„Åü`);

    // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÅØË°®Á§∫Êõ¥Êñ∞Âæå„Å´ÂÆüË°å
    setTimeout(() => {
        animateChipToPot(sbPlayer.id, sbAmount);
        animateChipToPot(bbPlayer.id, bbAmount);
    }, DELAYS.BLIND_ANIMATION);
}

// Ë°®Á§∫Êõ¥Êñ∞
function updateDisplay() {
    // „Éù„ÉÉ„ÉàË°®Á§∫
    document.getElementById('potDisplay').textContent = `Pot: $${pot}`;

    // „Éó„É¨„Ç§„É§„ÉºÊÉÖÂ†±Êõ¥Êñ∞
    players.forEach((player, index) => {
        if (!player.isActive) return;

        const infoEl = document.getElementById(`info-${index}`);
        if (infoEl) {
            infoEl.className = 'player-info';
            if (index === currentPlayerIndex) infoEl.classList.add('active');
            if (player.folded) infoEl.classList.add('folded');
            if (player.allIn) infoEl.classList.add('all-in');

            // „Éá„Ç£„Éº„É©„Éº„Éú„Çø„É≥„ÅÆÊõ¥Êñ∞
            const existingDealer = infoEl.querySelector('.dealer-button');
            if (player.isDealer && !existingDealer) {
                const dealerBtn = document.createElement('div');
                dealerBtn.className = 'dealer-button';
                dealerBtn.textContent = 'D';
                infoEl.appendChild(dealerBtn);
            } else if (!player.isDealer && existingDealer) {
                existingDealer.remove();
            }

            // „Éñ„É©„Ç§„É≥„Éâ„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº„ÅÆÊõ¥Êñ∞
            const existingBlind = infoEl.querySelector('.blind-indicator');
            if (existingBlind) existingBlind.remove();
            if (player.isSmallBlind) {
                const blindInd = document.createElement('div');
                blindInd.className = 'blind-indicator';
                blindInd.textContent = 'SB';
                infoEl.appendChild(blindInd);
            } else if (player.isBigBlind) {
                const blindInd = document.createElement('div');
                blindInd.className = 'blind-indicator';
                blindInd.textContent = 'BB';
                infoEl.appendChild(blindInd);
            }

            // „Çø„Éº„É≥„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº
            const existingTurnInd = infoEl.querySelector('.turn-indicator');
            if (existingTurnInd) existingTurnInd.remove();

            if (index === currentPlayerIndex && !player.folded && player.isActive) {
                const turnInd = document.createElement('div');
                turnInd.className = 'turn-indicator';
                turnInd.textContent = index === 0 ? 'üéØ YOUR TURN' : `üéØ ${player.name} TURN`;
                infoEl.appendChild(turnInd);
            }
        }

        const chipsEl = document.getElementById(`chips-${index}`);
        if (chipsEl) chipsEl.textContent = `üí∞ $${player.chips}`;

        const betEl = document.getElementById(`bet-${index}`);
        if (betEl) betEl.textContent = player.bet > 0 ? `Bet: $${player.bet}` : '';

        // „Ç´„Éº„ÉâË°®Á§∫
        const cardsEl = document.getElementById(`cards-${index}`);
        if (cardsEl) {
            if (player.folded) {
                // „Éï„Ç©„Éº„É´„Éâ„Åó„Åü„Çâ„Ç´„Éº„Éâ„ÇíÊ∂à„Åô
                cardsEl.innerHTML = '';
            } else if (index === 0 && player.cards.length > 0) {
                // „Éó„É¨„Ç§„É§„Éº„ÅÆ„Ç´„Éº„Éâ„ÅØË°®Á§∫
                const animClass = justDealtCards ? 'initial-deal' : '';
                cardsEl.innerHTML = player.cards.map((card, cardIdx) =>
                    `<div class="card ${card.suitName} ${animClass}" style="${justDealtCards ? `animation-delay: ${index * 0.15 + cardIdx * 0.1}s` : ''}">
                        <div class="card-value">${card.value}</div>
                        <div class="card-suit">${card.suit}</div>
                    </div>`
                ).join('');
            } else if (player.cards.length > 0) {
                // CPU„ÅÆ„Ç´„Éº„Éâ„ÅØË£èÂêë„Åç
                const animClass = justDealtCards ? 'initial-deal' : '';
                cardsEl.innerHTML = player.cards.map((card, cardIdx) =>
                    `<div class="card back ${animClass}" style="${justDealtCards ? `animation-delay: ${index * 0.15 + cardIdx * 0.1}s` : ''}"></div>`
                ).join('');
            } else {
                cardsEl.innerHTML = '';
            }
        }

        // „Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫
        const statusEl = document.getElementById(`status-${index}`);
        if (statusEl) {
            if (player.folded) statusEl.textContent = 'Folded';
            else if (player.allIn) statusEl.textContent = 'All In!';
            else statusEl.textContent = '';
        }
    });

    // „Ç≥„Éü„É•„Éã„ÉÜ„Ç£„Ç´„Éº„ÉâË°®Á§∫Ôºà5ÊûöÂàÜ„ÅÆÊû†„ÇíÂ∏∏„Å´Ë°®Á§∫Ôºâ
    const communityEl = document.getElementById('communityCards');
    if (communityEl) {
        let cardsHtml = '';
        for (let i = 0; i < 5; i++) {
            if (i < communityCards.length) {
                const card = communityCards[i];
                const isNewCard = newCommunityCards.includes(i);
                const animClass = isNewCard ? 'deal-animation' : '';
                const animDelay = isNewCard ? `animation-delay: ${newCommunityCards.indexOf(i) * 0.2}s` : '';
                cardsHtml += `<div class="card ${card.suitName} ${animClass}" style="${animDelay}">
                    <div class="card-value">${card.value}</div>
                    <div class="card-suit">${card.suit}</div>
                </div>`;
            } else {
                cardsHtml += '<div class="card-placeholder"></div>';
            }
        }
        communityEl.innerHTML = cardsHtml;
    }

    // „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥„ÅÆÊúâÂäπ/ÁÑ°Âäπ
    updateActionButtons();

    // „Ç´„Éº„ÉâÈÖçÂ∏É„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
    if (justDealtCards) {
        setTimeout(() => {
            justDealtCards = false;
        }, DELAYS.CARD_ANIMATION);
    }
}

// „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥„ÅÆÊõ¥Êñ∞
function updateActionButtons() {
    const player = players[0];
    const canCheck = currentBet === player.bet;
    const callAmount = currentBet - player.bet;
    
    document.getElementById('checkBtn').style.display = canCheck ? 'inline-block' : 'none';
    document.getElementById('callBtn').style.display = !canCheck ? 'inline-block' : 'none';
    if (!canCheck) {
        document.getElementById('callBtn').textContent = `Call $${callAmount}`;
    }
    
    // „É¨„Ç§„Ç∫„Ç≥„É≥„Éà„É≠„Éº„É´
    const minRaise = currentBet === 0 ? BIG_BLIND : currentBet * 2;
    document.getElementById('raiseAmount').textContent = minRaise;
}

// „Éó„É¨„Ç§„É§„Éº„Ç¢„ÇØ„Ç∑„Éß„É≥
function playerAction(action) {
    if (currentPlayerIndex !== 0) return;

    const player = players[0];

    switch(action) {
        case 'fold':
            player.folded = true;
            addLog(`${player.name} „Åå„Éï„Ç©„Éº„É´„Éâ„Åó„Åæ„Åó„Åü`);
            showActionIndicator(0, 'fold');
            playSound('click');
            break;

        case 'check':
            addLog(`${player.name} „Åå„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Åæ„Åó„Åü`);
            showActionIndicator(0, 'check');
            playSound('click');
            break;

        case 'call':
            const callAmount = Math.min(currentBet - player.bet, player.chips);
            player.chips -= callAmount;
            player.bet += callAmount;
            pot += callAmount;
            addLog(`${player.name} „Åå $${callAmount} „Çí„Ç≥„Éº„É´„Åó„Åæ„Åó„Åü`);
            showActionIndicator(0, 'call', callAmount);
            animateChipToPot(0, callAmount);
            playSound('chips');
            break;

        case 'raise':
            const raiseAmount = parseInt(document.getElementById('raiseAmount').textContent);
            const minRaiseAmount = currentBet === 0 ? BIG_BLIND : currentBet * 2;

            if (raiseAmount < minRaiseAmount) {
                alert(`ÊúÄ‰Ωé„É¨„Ç§„Ç∫È°ç„ÅØ $${minRaiseAmount} „Åß„ÅôÔºÅ`);
                return;
            }

            const totalBet = raiseAmount - player.bet;
            if (totalBet > player.chips) {
                alert('„ÉÅ„ÉÉ„Éó„ÅåË∂≥„Çä„Åæ„Åõ„ÇìÔºÅ');
                return;
            }

            player.chips -= totalBet;
            player.bet = raiseAmount;
            pot += totalBet;
            currentBet = raiseAmount;
            addLog(`${player.name} „Åå $${raiseAmount} „Å´„É¨„Ç§„Ç∫„Åó„Åæ„Åó„Åü`);
            showActionIndicator(0, 'raise', raiseAmount);
            animateChipToPot(0, totalBet);
            playSound('chips');
            break;

        case 'allin':
            const allInAmount = player.chips;
            player.chips = 0;
            player.bet += allInAmount;
            pot += allInAmount;
            if (player.bet > currentBet) currentBet = player.bet;
            player.allIn = true;
            addLog(`${player.name} „Åå„Ç™„Éº„É´„Ç§„É≥ÔºÅ $${allInAmount}`);
            showActionIndicator(0, 'allin', allInAmount);
            animateChipToPot(0, allInAmount);
            playSound('chips');
            break;
    }

    updateDisplay();
    nextPlayer();
}

// „É¨„Ç§„Ç∫ÈáëÈ°çË™øÊï¥
function adjustRaise(direction) {
    const incrementRadios = document.getElementsByName('increment');
    let increment = 100;
    for (const radio of incrementRadios) {
        if (radio.checked) {
            increment = parseInt(radio.value);
            break;
        }
    }
    
    const currentAmount = parseInt(document.getElementById('raiseAmount').textContent);
    const minRaise = currentBet === 0 ? BIG_BLIND : currentBet * 2;
    const maxRaise = players[0].chips + players[0].bet;
    
    let newAmount = currentAmount + (increment * direction);
    newAmount = Math.max(minRaise, Math.min(maxRaise, newAmount));
    
    document.getElementById('raiseAmount').textContent = newAmount;
}

// Ê¨°„ÅÆ„Éó„É¨„Ç§„É§„Éº„Å∏
function nextPlayer() {
    const activePlayers = players.filter(p => p.isActive && !p.folded);

    if (activePlayers.length === 1) {
        // 1‰∫∫„Åó„ÅãÊÆã„Å£„Å¶„ÅÑ„Å™„ÅÑ
        endRound();
        return;
    }

    // „Ç¢„ÇØ„Ç∑„Éß„É≥ÂèØËÉΩ„Å™„Éó„É¨„Ç§„É§„ÉºÔºà„Éï„Ç©„Éº„É´„Éâ„Åõ„Åö„ÄÅ„Ç™„Éº„É´„Ç§„É≥„Åß„ÇÇ„Å™„ÅÑÔºâ
    const playersWhoCanAct = players.filter(p => p.isActive && !p.folded && !p.allIn);

    // „Ç¢„ÇØ„Ç∑„Éß„É≥ÂèØËÉΩ„Å™„Éó„É¨„Ç§„É§„Éº„Åå„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØÊ¨°„ÅÆ„Éï„Çß„Éº„Ç∫„Å∏
    if (playersWhoCanAct.length === 0) {
        nextPhase();
        return;
    }

    // ÂÖ®Âì°„Åå„Éô„ÉÉ„Éà„ÇíÊèÉ„Åà„Åü„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    const allBetsEqual = playersWhoCanAct.every(p => p.bet === currentBet);

    // Ê¨°„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÇíÊé¢„Åô
    let attempts = 0;
    let nextIndex = (currentPlayerIndex + 1) % players.length;

    while (attempts < players.length) {
        if (players[nextIndex].isActive && !players[nextIndex].folded && !players[nextIndex].allIn) {
            // ÂÖ®Âì°„Åå„Éô„ÉÉ„Éà„ÇíÊèÉ„Åà„Å¶„ÅÑ„Å¶„ÄÅÊúÄÂàù„ÅÆ„Éó„É¨„Ç§„É§„Éº„Å´Êàª„Å£„ÅüÂ†¥Âêà
            if (allBetsEqual && playersWhoCanAct.length === 1) {
                nextPhase();
                return;
            }

            // ÂÖ®Âì°„Åå„Éô„ÉÉ„Éà„ÇíÊèÉ„Åà„Å¶„ÅÑ„Å¶„ÄÅ‰∏ÄÂë®„Åó„ÅüÂ†¥Âêà
            if (allBetsEqual) {
                // „Éá„Ç£„Éº„É©„Éº„ÅÆÊ¨°„ÅÆ„Éó„É¨„Ç§„É§„Éº„Åæ„ÅßÊàª„Å£„Å¶„Åç„Åü„Çâ„Éï„Çß„Éº„Ç∫ÁµÇ‰∫Ü
                let firstToAct = (dealerPosition + 1) % players.length;
                while (players[firstToAct].folded || !players[firstToAct].isActive || players[firstToAct].allIn) {
                    firstToAct = (firstToAct + 1) % players.length;
                }

                if (nextIndex === firstToAct && currentPlayerIndex !== firstToAct) {
                    nextPhase();
                    return;
                }
            }

            break;
        }
        nextIndex = (nextIndex + 1) % players.length;
        attempts++;
    }

    // ÂÖ®Âì°„Åå„Éï„Ç©„Éº„É´„Éâ„Åæ„Åü„ÅØ„Ç™„Éº„É´„Ç§„É≥„ÅÆÂ†¥Âêà
    if (attempts >= players.length) {
        nextPhase();
        return;
    }

    currentPlayerIndex = nextIndex;
    updateDisplay();

    if (currentPlayerIndex !== 0) {
        setTimeout(() => cpuTurn(), DELAYS.CPU_ACTION);
    }
}

// CPU„ÅÆ„Çø„Éº„É≥
function cpuTurn() {
    const cpu = players[currentPlayerIndex];
    if (!cpu.isActive || cpu.folded || cpu.allIn) {
        nextPlayer();
        return;
    }
    
    // Èõ£ÊòìÂ∫¶Âà•„ÅÆAI
    const action = decideCpuAction(cpu);
    executeCpuAction(cpu, action);
    
    updateDisplay();
    setTimeout(() => nextPlayer(), DELAYS.NEXT_PLAYER);
}

// CPU„ÅÆË°åÂãïÊ±∫ÂÆö
function decideCpuAction(cpu) {
    const callAmount = currentBet - cpu.bet;
    const hand = evaluateHand(cpu.cards, communityCards);
    
    // Á∞°ÊòìAIÔºàÈõ£ÊòìÂ∫¶„Å´„Çà„ÇäË™øÊï¥Ôºâ
    let aggression = difficulty === 'easy' ? 0.3 : (difficulty === 'normal' ? 0.5 : 0.7);
    let bluffChance = difficulty === 'easy' ? 0.1 : (difficulty === 'normal' ? 0.2 : 0.4);
    
    const random = Math.random();
    
    // „Éè„É≥„Éâ„ÅåÂº∑„ÅÑÂ†¥Âêà
    if (hand.rank >= 7 || random < bluffChance) {
        if (random < aggression) {
            return { type: 'raise', amount: currentBet + BIG_BLIND * 2 };
        } else {
            return { type: 'call' };
        }
    }
    
    // „Éè„É≥„Éâ„Åå‰∏≠Á®ãÂ∫¶
    if (hand.rank >= 4) {
        if (callAmount <= cpu.chips * 0.1) {
            return { type: 'call' };
        } else {
            return { type: 'fold' };
        }
    }
    
    // „Éè„É≥„Éâ„ÅåÂº±„ÅÑ
    if (callAmount === 0) {
        return { type: 'check' };
    } else {
        return { type: 'fold' };
    }
}

// CPU„Ç¢„ÇØ„Ç∑„Éß„É≥ÂÆüË°å
function executeCpuAction(cpu, action) {
    const cpuIndex = cpu.id;

    switch(action.type) {
        case 'fold':
            cpu.folded = true;
            addLog(`${cpu.name} „Åå„Éï„Ç©„Éº„É´„Éâ„Åó„Åæ„Åó„Åü`);
            showActionIndicator(cpuIndex, 'fold');
            break;
        case 'check':
            addLog(`${cpu.name} „Åå„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Åæ„Åó„Åü`);
            showActionIndicator(cpuIndex, 'check');
            break;
        case 'call':
            const callAmount = Math.min(currentBet - cpu.bet, cpu.chips);
            cpu.chips -= callAmount;
            cpu.bet += callAmount;
            pot += callAmount;
            addLog(`${cpu.name} „Åå $${callAmount} „Çí„Ç≥„Éº„É´„Åó„Åæ„Åó„Åü`);
            showActionIndicator(cpuIndex, 'call', callAmount);
            animateChipToPot(cpuIndex, callAmount);
            break;
        case 'raise':
            const raiseAmount = Math.min(action.amount, cpu.chips + cpu.bet);
            const totalBet = raiseAmount - cpu.bet;
            cpu.chips -= totalBet;
            cpu.bet = raiseAmount;
            pot += totalBet;
            currentBet = raiseAmount;
            addLog(`${cpu.name} „Åå $${raiseAmount} „Å´„É¨„Ç§„Ç∫„Åó„Åæ„Åó„Åü`);
            showActionIndicator(cpuIndex, 'raise', raiseAmount);
            animateChipToPot(cpuIndex, totalBet);
            break;
    }
}

// Ê¨°„ÅÆ„Éï„Çß„Éº„Ç∫„Å∏
function nextPhase() {
    // „Éô„ÉÉ„Éà„Çí„É™„Çª„ÉÉ„Éà
    players.forEach(p => {
        p.bet = 0;
    });
    currentBet = 0;

    // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„ÅßÊú™„Éï„Ç©„Éº„É´„Éâ„ÅÆ„Éó„É¨„Ç§„É§„ÉºÊï∞„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    const activePlayers = players.filter(p => p.isActive && !p.folded);
    if (activePlayers.length === 1) {
        endRound();
        return;
    }

    switch(gamePhase) {
        case 'preflop':
            // „Éï„É≠„ÉÉ„ÉóÔºà„Éï„É≠„ÉÉ„Éó3ÊûöÔºâ
            const flopCards = [deck.pop(), deck.pop(), deck.pop()];
            newCommunityCards = [0, 1, 2]; // Êñ∞„Åó„ÅèËøΩÂä†„Åï„Çå„Åü„Ç´„Éº„Éâ„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ
            communityCards = flopCards;
            gamePhase = 'flop';
            addLog('--- „Éï„É≠„ÉÉ„Éó ---');
            playSound('card');
            break;
        case 'flop':
            // „Çø„Éº„É≥Ôºà„Çø„Éº„É≥1ÊûöÔºâ
            newCommunityCards = [communityCards.length]; // Êñ∞„Åó„ÅèËøΩÂä†„Åï„Çå„Åü„Ç´„Éº„Éâ„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ
            communityCards.push(deck.pop());
            gamePhase = 'turn';
            addLog('--- „Çø„Éº„É≥ ---');
            playSound('card');
            break;
        case 'turn':
            // „É™„Éê„ÉºÔºà„É™„Éê„Éº1ÊûöÔºâ
            newCommunityCards = [communityCards.length]; // Êñ∞„Åó„ÅèËøΩÂä†„Åï„Çå„Åü„Ç´„Éº„Éâ„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ
            communityCards.push(deck.pop());
            gamePhase = 'river';
            addLog('--- „É™„Éê„Éº ---');
            playSound('card');
            break;
        case 'river':
            // „Ç∑„Éß„Éº„ÉÄ„Ç¶„É≥
            gamePhase = 'showdown';
            showdown();
            return;
    }

    // Ë°®Á§∫„ÇíÊõ¥Êñ∞„Åó„Å¶„Ç≥„Éü„É•„Éã„ÉÜ„Ç£„Ç´„Éº„Éâ„ÇíË°®Á§∫
    updateDisplay();

    // Êñ∞„Åó„ÅÑ„Ç´„Éº„Éâ„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆüË°åÂæå„ÄÅ„Éï„É©„Ç∞„Çí„ÇØ„É™„Ç¢
    setTimeout(() => {
        newCommunityCards = [];
    }, DELAYS.ANIMATION_CLEAR);

    // „Éá„Ç£„Éº„É©„Éº„ÅÆÊ¨°„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Éó„É¨„Ç§„É§„Éº„Åã„ÇâÈñãÂßã
    currentPlayerIndex = (dealerPosition + 1) % players.length;
    let attempts = 0;
    while (attempts < players.length && (players[currentPlayerIndex].folded || !players[currentPlayerIndex].isActive || players[currentPlayerIndex].allIn)) {
        currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
        attempts++;
    }

    // „Ç¢„ÇØ„Ç∑„Éß„É≥ÂèØËÉΩ„Å™„Éó„É¨„Ç§„É§„Éº„Åå„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØÊ¨°„ÅÆ„Éï„Çß„Éº„Ç∫„Å∏
    if (attempts >= players.length) {
        setTimeout(() => nextPhase(), DELAYS.ANIMATION_CLEAR);
        return;
    }

    if (currentPlayerIndex !== 0) {
        setTimeout(() => cpuTurn(), DELAYS.CPU_TURN);
    }
}

// „É©„Ç¶„É≥„ÉâÁµÇ‰∫Ü
function endRound() {
    const winner = players.find(p => p.isActive && !p.folded);
    const winAmount = pot;
    winner.chips += pot;
    addLog(`üéâ ${winner.name} „Åå $${winAmount} „ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ`);
    highlightWinner(winner.id, winAmount);
    playSound('win');

    setTimeout(() => {
        showNextRoundPrompt(`${winner.name} „ÅåÂãùÂà©ÔºÅ`, `+$${winAmount}`);
    }, DELAYS.NEXT_ROUND_PROMPT);
}

// „Ç∑„Éß„Éº„ÉÄ„Ç¶„É≥
function showdown() {
    addLog('--- „Ç∑„Éß„Éº„ÉÄ„Ç¶„É≥ ---');

    const activePlayers = players.filter(p => p.isActive && !p.folded);
    const hands = activePlayers.map(p => ({
        player: p,
        hand: evaluateHand(p.cards, communityCards)
    }));

    // ÂÖ®Âì°„ÅÆÊâãÊú≠„ÇíË°®Á§∫
    activePlayers.forEach(p => {
        const hand = hands.find(h => h.player.id === p.id).hand;
        addLog(`${p.name}: ${hand.name} ${p.cards.map(c => c.value + c.suit).join(' ')}`);
    });

    // ÊúÄÂº∑„ÅÆ„Éè„É≥„Éâ„ÇíË¶ã„Å§„Åë„Çã
    hands.sort((a, b) => compareHands(b.hand, a.hand));

    const winner = hands[0].player;
    const winAmount = pot;
    winner.chips += pot;

    addLog(`üéâ ${winner.name} „Åå ${hands[0].hand.name} „Åß $${winAmount} „ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ`);

    // ÂÖ®Âì°„ÅÆ„Ç´„Éº„Éâ„ÇíË°®Á§∫Ôºà„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥‰ªò„ÅçÔºâ
    updateDisplay();
    setTimeout(() => {
        activePlayers.forEach((p, idx) => {
            const cardsEl = document.getElementById(`cards-${p.id}`);
            const infoEl = document.getElementById(`info-${p.id}`);

            if (cardsEl && p.id !== 0) {
                cardsEl.innerHTML = p.cards.map((card, cardIdx) =>
                    `<div class="card ${card.suitName}" style="animation-delay: ${idx * 0.2 + cardIdx * 0.1}s">
                        <div class="card-value">${card.value}</div>
                        <div class="card-suit">${card.suit}</div>
                    </div>`
                ).join('');
            }

            // ÂΩπÂêç„Éê„ÉÉ„Ç∏„ÇíË°®Á§∫
            if (infoEl) {
                const hand = hands.find(h => h.player.id === p.id).hand;
                const handBadge = document.createElement('div');
                handBadge.className = 'hand-badge';
                handBadge.style.animationDelay = `${idx * 0.2}s`;
                handBadge.textContent = hand.name;
                infoEl.appendChild(handBadge);

                // Âæå„ÅßÂâäÈô§
                setTimeout(() => handBadge.remove(), 6000);
            }
        });
    }, DELAYS.SHOWDOWN_CARDS);

    playSound('win');

    // ÂãùËÄÖ„Çí„Éè„Ç§„É©„Ç§„Éà
    setTimeout(() => {
        highlightWinner(winner.id, winAmount);
    }, DELAYS.WINNER_HIGHLIGHT);

    setTimeout(() => {
        showNextRoundPrompt(`${winner.name} „Åå ${hands[0].hand.name} „ÅßÂãùÂà©ÔºÅ`, `+$${winAmount}`);
    }, DELAYS.SHOWDOWN_NEXT_ROUND);
}

// „Ç≤„Éº„É†ÁµÇ‰∫Ü„ÉÅ„Çß„ÉÉ„ÇØ
function checkGameEnd() {
    // „ÉÅ„ÉÉ„Éó0„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÇíÈÄÄÂ†¥„Åï„Åõ„Çã
    players.forEach(p => {
        if (p.chips === 0) {
            p.isActive = false;
            if (p.id === 0) {
                // „Éó„É¨„Ç§„É§„Éº„ÅåÁ†¥Áî£
                showResult('üí∏ Á†¥Áî£', '„ÉÅ„ÉÉ„Éó„Åå„Å™„Åè„Å™„Çä„Åæ„Åó„Åü...');
            } else {
                addLog(`${p.name} „ÅåÁ†¥Áî£„Åó„Åæ„Åó„Åü`);
            }
        }
    });
    
    const activePlayers = players.filter(p => p.isActive);
    
    if (activePlayers.length === 1) {
        if (activePlayers[0].id === 0) {
            showResult('üéâ ÂÑ™ÂãùÔºÅ', '„Åô„Åπ„Å¶„ÅÆÁõ∏Êâã„ÇíÂÄí„Åó„Åæ„Åó„ÅüÔºÅ');
        }
        return;
    }
    
    // Ê¨°„ÅÆ„É©„Ç¶„É≥„Éâ„Å∏
    setTimeout(() => startNewRound(), DELAYS.GAME_END_CHECK);
}

// ÁµêÊûúË°®Á§∫
function showResult(title, message) {
    document.getElementById('resultTitle').textContent = title;
    document.getElementById('resultMessage').textContent = message;
    document.getElementById('resultOverlay').style.display = 'flex';
}

// „Ç≤„Éº„É†ÂÜç„Çπ„Çø„Éº„Éà
function restartGame() {
    document.getElementById('resultOverlay').style.display = 'none';
    stopBGM();
    initGame();
    if (soundEnabled) {
        playBGM();
    }
    startNewRound();
}

// „É°„Éã„É•„Éº„Å´Êàª„Çã
function backToMenu() {
    stopBGM();
    document.getElementById('resultOverlay').style.display = 'none';
    document.getElementById('gameScreen').style.display = 'none';
    document.getElementById('difficultyScreen').style.display = 'flex';
}

// „É≠„Ç∞ËøΩÂä†
function addLog(message) {
    const logEl = document.getElementById('gameLog');
    const entry = document.createElement('div');
    entry.className = 'log-entry';
    entry.textContent = message;
    logEl.insertBefore(entry, logEl.firstChild);

    // ÊúÄÂ§ß20„Ç®„É≥„Éà„É™„Éº„Åæ„Åß
    while (logEl.children.length > 20) {
        logEl.removeChild(logEl.lastChild);
    }
}

// „Ç¢„ÇØ„Ç∑„Éß„É≥„Ç§„É≥„Ç∏„Ç±„Éº„Çø„ÉºË°®Á§∫
function showActionIndicator(playerIndex, actionType, amount = null) {
    const infoEl = document.getElementById(`info-${playerIndex}`);
    if (!infoEl) return;

    // Êó¢Â≠ò„ÅÆ„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº„ÇíÂâäÈô§
    const existing = infoEl.querySelector('.action-indicator');
    if (existing) existing.remove();

    const indicator = document.createElement('div');
    indicator.className = `action-indicator ${actionType}`;

    let text = actionType.toUpperCase();
    if (amount !== null) {
        text += ` $${amount}`;
    }
    indicator.textContent = text;

    infoEl.appendChild(indicator);

    // 2ÁßíÂæå„Å´ÂâäÈô§
    setTimeout(() => {
        if (indicator.parentNode) {
            indicator.remove();
        }
    }, 2000);
}

// „ÉÅ„ÉÉ„Éó„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
function animateChipToPot(playerIndex, amount) {
    const playerEl = document.getElementById(`player-${playerIndex}`);
    const potEl = document.getElementById('potDisplay');
    if (!playerEl || !potEl) {
        console.warn(`Cannot animate chip: player-${playerIndex} or pot not found`);
        return;
    }

    const playerRect = playerEl.getBoundingClientRect();
    const potRect = potEl.getBoundingClientRect();

    // Ë¶ÅÁ¥†„ÅåÁîªÈù¢‰∏ä„Å´Ë°®Á§∫„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç
    if (playerRect.width === 0 || playerRect.height === 0) {
        console.warn(`Player element not rendered yet: player-${playerIndex}`);
        return;
    }

    const chip = document.createElement('div');
    chip.className = 'chip-animation';
    chip.textContent = 'üí∞';
    chip.style.position = 'fixed';
    chip.style.left = (playerRect.left + playerRect.width / 2) + 'px';
    chip.style.top = (playerRect.top + playerRect.height / 2) + 'px';
    chip.style.setProperty('--tx', (potRect.left + potRect.width / 2 - playerRect.left - playerRect.width / 2) + 'px');
    chip.style.setProperty('--ty', (potRect.top + potRect.height / 2 - playerRect.top - playerRect.height / 2) + 'px');

    document.body.appendChild(chip);

    setTimeout(() => chip.remove(), 1000);
}

// ÂãùËÄÖ„Éè„Ç§„É©„Ç§„Éà
function highlightWinner(playerIndex, amount) {
    const infoEl = document.getElementById(`info-${playerIndex}`);
    if (!infoEl) return;

    infoEl.classList.add('winner-glow');

    // Win „Éê„ÉÉ„Ç∏„ÇíË°®Á§∫
    const winBadge = document.createElement('div');
    winBadge.className = 'win-badge';
    winBadge.textContent = `WIN +$${amount}`;
    infoEl.appendChild(winBadge);

    setTimeout(() => {
        infoEl.classList.remove('winner-glow');
        winBadge.remove();
    }, 4000);
}

// „Éè„É≥„ÉâË©ï‰æ°ÔºàÂÆåÂÖ®ÁâàÔºâ
function evaluateHand(holeCards, community) {
    const allCards = [...holeCards, ...community];
    if (allCards.length < 2) return { rank: 0, name: '„Éè„Ç§„Ç´„Éº„Éâ', highCard: 0 };

    // 5Êûö„ÅÆÊúÄÂº∑„Éè„É≥„Éâ„ÇíË¶ã„Å§„Åë„Çã
    let bestHand = { rank: 0, name: '„Éè„Ç§„Ç´„Éº„Éâ', highCard: 0 };

    // 7Êûö„Åã„Çâ5Êûö„ÇíÈÅ∏„Å∂ÁµÑ„ÅøÂêà„Çè„Åõ„ÇíË©ï‰æ°
    if (allCards.length >= 5) {
        const combinations = getCombinations(allCards, 5);
        combinations.forEach(fiveCards => {
            const hand = evaluateFiveCards(fiveCards);
            if (hand.rank > bestHand.rank ||
                (hand.rank === bestHand.rank && hand.highCard > bestHand.highCard)) {
                bestHand = hand;
            }
        });
    } else {
        bestHand = evaluateFiveCards(allCards);
    }

    return bestHand;
}

// 5Êûö„ÅÆ„Ç´„Éº„Éâ„ÇíË©ï‰æ°
function evaluateFiveCards(cards) {
    const values = cards.map(c => c.numValue).sort((a, b) => b - a);
    const suits = cards.map(c => c.suit);
    const highCard = Math.max(...values);

    // „Çπ„Éº„Éà„ÅÆ„Ç´„Ç¶„É≥„Éà
    const suitCounts = {};
    suits.forEach(s => {
        suitCounts[s] = (suitCounts[s] || 0) + 1;
    });
    const isFlush = Object.values(suitCounts).some(count => count >= 5);

    // „Çπ„Éà„É¨„Éº„ÉàÂà§ÂÆö
    const isStraight = checkStraight(values);
    const isLowStraight = checkLowStraight(values); // A-2-3-4-5

    // Êï∞Â≠ó„ÅÆ„Ç´„Ç¶„É≥„Éà
    const valueCounts = {};
    values.forEach(v => {
        valueCounts[v] = (valueCounts[v] || 0) + 1;
    });
    const counts = Object.values(valueCounts).sort((a, b) => b - a);

    // „É≠„Ç§„É§„É´„Éï„É©„ÉÉ„Ç∑„É•Âà§ÂÆö (10-J-Q-K-A „ÅÆÂêå„Åò„Çπ„Éº„Éà)
    if (isFlush && isStraight && values[0] === 14 && values[1] === 13) {
        return { rank: 10, name: '„É≠„Ç§„É§„É´„Éï„É©„ÉÉ„Ç∑„É•', highCard: 14 };
    }

    // „Çπ„Éà„É¨„Éº„Éà„Éï„É©„ÉÉ„Ç∑„É•Âà§ÂÆö
    if (isFlush && (isStraight || isLowStraight)) {
        return { rank: 9, name: '„Çπ„Éà„É¨„Éº„Éà„Éï„É©„ÉÉ„Ç∑„É•', highCard: isLowStraight ? 5 : highCard };
    }

    // „Éï„Ç©„Éº„Ç´„Éº„ÉâÂà§ÂÆö
    if (counts[0] === 4) {
        return { rank: 8, name: '„Éï„Ç©„Éº„Ç´„Éº„Éâ', highCard };
    }

    // „Éï„É´„Éè„Ç¶„ÇπÂà§ÂÆö
    if (counts[0] === 3 && counts[1] >= 2) {
        return { rank: 7, name: '„Éï„É´„Éè„Ç¶„Çπ', highCard };
    }

    // „Éï„É©„ÉÉ„Ç∑„É•Âà§ÂÆö
    if (isFlush) {
        return { rank: 6, name: '„Éï„É©„ÉÉ„Ç∑„É•', highCard };
    }

    // „Çπ„Éà„É¨„Éº„ÉàÂà§ÂÆö
    if (isStraight || isLowStraight) {
        return { rank: 5, name: '„Çπ„Éà„É¨„Éº„Éà', highCard: isLowStraight ? 5 : highCard };
    }

    // „Çπ„É™„Éº„Ç´„Éº„ÉâÂà§ÂÆö
    if (counts[0] === 3) {
        return { rank: 4, name: '„Çπ„É™„Éº„Ç´„Éº„Éâ', highCard };
    }

    // „ÉÑ„Éº„Éö„Ç¢Âà§ÂÆö
    if (counts[0] === 2 && counts[1] === 2) {
        return { rank: 3, name: '„ÉÑ„Éº„Éö„Ç¢', highCard };
    }

    // „ÉØ„É≥„Éö„Ç¢Âà§ÂÆö
    if (counts[0] === 2) {
        return { rank: 2, name: '„ÉØ„É≥„Éö„Ç¢', highCard };
    }

    // „Éè„Ç§„Ç´„Éº„Éâ
    return { rank: 1, name: '„Éè„Ç§„Ç´„Éº„Éâ', highCard };
}

// „Çπ„Éà„É¨„Éº„ÉàÂà§ÂÆöÔºàÈÄöÂ∏∏Ôºâ
function checkStraight(sortedValues) {
    for (let i = 0; i < sortedValues.length - 4; i++) {
        let isStraight = true;
        for (let j = 0; j < 4; j++) {
            if (sortedValues[i + j] - sortedValues[i + j + 1] !== 1) {
                isStraight = false;
                break;
            }
        }
        if (isStraight) return true;
    }
    return false;
}

// „É≠„Éº„Çπ„Éà„É¨„Éº„ÉàÂà§ÂÆöÔºàA-2-3-4-5Ôºâ
function checkLowStraight(sortedValues) {
    const hasAce = sortedValues.includes(14);
    const hasTwo = sortedValues.includes(2);
    const hasThree = sortedValues.includes(3);
    const hasFour = sortedValues.includes(4);
    const hasFive = sortedValues.includes(5);
    return hasAce && hasTwo && hasThree && hasFour && hasFive;
}

// ÈÖçÂàó„Åã„ÇâÁµÑ„ÅøÂêà„Çè„Åõ„ÇíÁîüÊàê
function getCombinations(arr, k) {
    const result = [];

    function backtrack(start, current) {
        if (current.length === k) {
            result.push([...current]);
            return;
        }

        for (let i = start; i < arr.length; i++) {
            current.push(arr[i]);
            backtrack(i + 1, current);
            current.pop();
        }
    }

    backtrack(0, []);
    return result;
}

// „Éè„É≥„ÉâÊØîËºÉ
function compareHands(hand1, hand2) {
    if (hand1.rank !== hand2.rank) {
        return hand1.rank - hand2.rank;
    }
    // Âêå„ÅòÂΩπ„ÅÆÂ†¥Âêà„ÅØ„Éè„Ç§„Ç´„Éº„Éâ„ÅßÊØîËºÉ
    return hand1.highCard - hand2.highCard;
}

// Ê¨°„ÅÆ„É©„Ç¶„É≥„Éâ„Å∏„ÅÆ„Éó„É≠„É≥„Éó„ÉàË°®Á§∫
function showNextRoundPrompt(title, text) {
    document.getElementById('roundResultTitle').textContent = title;
    document.getElementById('roundResultText').textContent = text;
    document.getElementById('nextRoundOverlay').style.display = 'flex';
}

// Ê¨°„ÅÆ„É©„Ç¶„É≥„Éâ„Å∏ÈÄ≤„ÇÄ
function proceedToNextRound() {
    document.getElementById('nextRoundOverlay').style.display = 'none';
    checkGameEnd();
}

// ÊÉÖÂ†±Ë°®Á§∫„ÅÆÂàá„ÇäÊõø„Åà
function toggleInfo() {
    const log = document.getElementById('gameLog');
    const ranking = document.querySelector('.hand-ranking');

    log.classList.toggle('visible');
    ranking.classList.toggle('visible');
}

console.log('Texas Hold\'em Poker loaded successfully!');
    </script>
</body>
</html>
