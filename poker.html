<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„ÉÜ„Ç≠„Çµ„Çπ„Éõ„Éº„É´„Éá„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f4c29 0%, #1a5f3f 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Èõ£ÊòìÂ∫¶ÈÅ∏ÊäûÁîªÈù¢ */
        .screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .screen-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 600px;
        }

        h1 {
            color: #0f4c29;
            margin-bottom: 10px;
            font-size: 3em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.3em;
        }

        .difficulty-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .difficulty-btn {
            background: white;
            border: 3px solid #e0e0e0;
            padding: 25px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            font-size: 1em;
        }

        .difficulty-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .difficulty-btn.easy:hover { border-color: #4caf50; }
        .difficulty-btn.normal:hover { border-color: #ff9800; }
        .difficulty-btn.hard:hover { border-color: #f44336; }

        .diff-icon { font-size: 3em; }
        .diff-name {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }
        .diff-desc {
            font-size: 0.9em;
            color: #666;
        }

        /* „Ç≤„Éº„É†ÁîªÈù¢ */
        #gameScreen {
            display: none;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* „Éò„ÉÉ„ÉÄ„Éº */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px 25px;
            border-radius: 10px;
        }

        .game-title {
            color: #ffd700;
            font-size: 1.8em;
            font-weight: bold;
        }

        .sound-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .sound-toggle {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .sound-toggle.off {
            background: #f44336;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }

        .volume-slider {
            width: 100px;
        }

        /* „Éù„Éº„Ç´„Éº„ÉÜ„Éº„Éñ„É´ */
        .poker-table {
            background: radial-gradient(ellipse at center, #2d5016 0%, #1a3d0f 100%);
            border: 15px solid #8b4513;
            border-radius: 50%;
            aspect-ratio: 16/10;
            max-width: 1000px;
            margin: 0 auto 30px;
            position: relative;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), inset 0 0 50px rgba(0, 0, 0, 0.3);
        }

        /* „Éó„É¨„Ç§„É§„ÉºÈÖçÁΩÆ */
        .player-seat {
            position: absolute;
            width: 180px;
            text-align: center;
        }

        .player-seat.seat-0 { bottom: -40px; left: 50%; transform: translateX(-50%); }
        .player-seat.seat-1 { bottom: 20%; left: 5%; }
        .player-seat.seat-2 { top: 10%; left: 15%; }
        .player-seat.seat-3 { top: 10%; right: 15%; }
        .player-seat.seat-4 { bottom: 20%; right: 5%; }

        .player-info {
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #ffd700;
            border-radius: 15px;
            padding: 15px 10px;
            margin-bottom: 10px;
        }

        .player-info.active {
            border-color: #4caf50;
            box-shadow: 0 0 20px #4caf50;
            animation: pulse-border 1s infinite;
        }

        @keyframes pulse-border {
            0%, 100% { border-color: #4caf50; }
            50% { border-color: #8bc34a; }
        }

        .player-info.folded {
            opacity: 0.5;
            border-color: #666;
        }

        .player-info.all-in {
            border-color: #ff5722;
        }

        .player-name {
            color: #ffd700;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .player-chips {
            color: white;
            font-size: 1.2em;
            margin: 5px 0;
        }

        .player-bet {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            padding: 5px;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .player-status {
            color: #4caf50;
            font-size: 0.85em;
            margin-top: 5px;
            font-style: italic;
        }

        .dealer-button {
            background: white;
            color: #0f4c29;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            position: absolute;
            top: -15px;
            right: -15px;
            border: 2px solid #ffd700;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .blind-indicator {
            position: absolute;
            top: -15px;
            left: -15px;
            background: #f44336;
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.75em;
            font-weight: bold;
        }

        /* „Ç´„Éº„ÉâË°®Á§∫ */
        .player-cards {
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .card {
            width: 50px;
            height: 70px;
            background: white;
            border: 2px solid #333;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .card.back {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }

        .card.hearts, .card.diamonds {
            color: #f44336;
        }

        .card.spades, .card.clubs {
            color: #333;
        }

        .card-suit {
            font-size: 1em;
        }

        .card-value {
            font-size: 1.3em;
        }

        /* „Ç≥„Éü„É•„Éã„ÉÜ„Ç£„Ç´„Éº„Éâ */
        .community-cards {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 10px;
        }

        .community-cards .card {
            width: 60px;
            height: 85px;
        }

        /* „Éù„ÉÉ„Éà */
        .pot-display {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 15px 30px;
            color: #ffd700;
            font-size: 1.5em;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        /* „Ç¢„ÇØ„Ç∑„Éß„É≥„Éë„Éç„É´ */
        .action-panel {
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #ffd700;
            border-radius: 15px;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .action-btn {
            flex: 1;
            min-width: 120px;
            padding: 15px 20px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .action-btn.fold {
            background: #f44336;
            color: white;
        }

        .action-btn.check {
            background: #4caf50;
            color: white;
        }

        .action-btn.call {
            background: #2196f3;
            color: white;
        }

        .action-btn.raise {
            background: #ff9800;
            color: white;
        }

        .action-btn.all-in {
            background: #9c27b0;
            color: white;
        }

        .action-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .raise-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .raise-amount {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 10px;
        }

        .amount-display {
            color: #ffd700;
            font-size: 1.5em;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
        }

        .amount-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
        }

        .amount-btn:hover {
            background: #45a049;
        }

        .increment-selector {
            display: flex;
            gap: 10px;
        }

        .increment-radio {
            display: none;
        }

        .increment-label {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .increment-radio:checked + .increment-label {
            background: #ffd700;
            color: #333;
        }

        /* „Ç≤„Éº„É†„É≠„Ç∞ */
        .game-log {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid #555;
            border-radius: 10px;
            padding: 15px;
            max-width: 600px;
            margin: 20px auto;
            max-height: 150px;
            overflow-y: auto;
        }

        .log-entry {
            color: white;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9em;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        /* „Éè„É≥„Éâ„É©„É≥„Ç≠„É≥„Ç∞ */
        .hand-ranking {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 15px;
            max-width: 400px;
            margin: 20px auto;
            color: white;
        }

        .hand-ranking h3 {
            color: #ffd700;
            margin-bottom: 10px;
            text-align: center;
        }

        .hand-list {
            font-size: 0.9em;
            line-height: 1.8;
        }

        .back-btn {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 30px;
            background: #e0e0e0;
            color: #333;
            text-decoration: none;
            border-radius: 50px;
            transition: all 0.3s;
            font-weight: bold;
        }

        .back-btn:hover {
            background: #d0d0d0;
            transform: translateY(-2px);
        }

        /* ÁµêÊûúÁîªÈù¢ */
        .result-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .result-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
        }

        .result-title {
            font-size: 3em;
            margin-bottom: 20px;
        }

        .result-message {
            font-size: 1.3em;
            color: #666;
            margin-bottom: 30px;
        }

        .result-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .result-btn {
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .result-btn.primary {
            background: linear-gradient(135deg, #0f4c29 0%, #1a5f3f 100%);
            color: white;
        }

        .result-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* „É¨„Çπ„Éù„É≥„Ç∑„Éñ */
        @media (max-width: 900px) {
            .poker-table {
                aspect-ratio: 1;
            }
            
            .player-seat {
                width: 140px;
            }

            .card {
                width: 40px;
                height: 56px;
                font-size: 0.9em;
            }

            .community-cards .card {
                width: 50px;
                height: 70px;
            }
        }
    </style>
</head>
<body>
    <!-- Èõ£ÊòìÂ∫¶ÈÅ∏ÊäûÁîªÈù¢ -->
    <div id="difficultyScreen" class="screen">
        <div class="screen-container">
            <h1>üé∞ „ÉÜ„Ç≠„Çµ„Çπ„Éõ„Éº„É´„Éá„É†</h1>
            <h2>Èõ£ÊòìÂ∫¶„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h2>
            <div class="difficulty-buttons">
                <button class="difficulty-btn easy" onclick="startGame('easy')">
                    <span class="diff-icon">üòä</span>
                    <span class="diff-name">ÂàùÁ¥ö</span>
                    <span class="diff-desc">„Çø„Ç§„Éà„Éó„É¨„Ç§ - Âº∑„ÅÑÊâã„ÅÆ„Åø</span>
                </button>
                <button class="difficulty-btn normal" onclick="startGame('normal')">
                    <span class="diff-icon">ü§î</span>
                    <span class="diff-name">‰∏≠Á¥ö</span>
                    <span class="diff-desc">„Éê„É©„É≥„ÇπÂûã - ÈÅ©Â∫¶„Å´„Éñ„É©„Éï</span>
                </button>
                <button class="difficulty-btn hard" onclick="startGame('hard')">
                    <span class="diff-icon">üß†</span>
                    <span class="diff-name">‰∏äÁ¥ö</span>
                    <span class="diff-desc">„Ç¢„Ç∞„É¨„ÉÉ„Ç∑„Éñ - „Éñ„É©„ÉïÂ§öÁî®</span>
                </button>
            </div>
            <a href="index.html" class="back-btn">„É°„Éã„É•„Éº„Å´Êàª„Çã</a>
        </div>
    </div>

    <!-- „Ç≤„Éº„É†ÁîªÈù¢ -->
    <div id="gameScreen">
        <div class="game-header">
            <div class="game-title">üé∞ Texas Hold'em</div>
            <div class="sound-controls">
                <button id="soundToggle" class="sound-toggle" onclick="toggleSound()">üîä ON</button>
                <div class="volume-control">
                    <span>üîâ</span>
                    <input type="range" id="volumeSlider" class="volume-slider" min="0" max="100" value="50" oninput="changeVolume(this.value)">
                    <span id="volumeDisplay">50%</span>
                </div>
            </div>
        </div>

        <div class="poker-table" id="pokerTable">
            <!-- „Éó„É¨„Ç§„É§„ÉºÂ∏≠ÔºàÂãïÁöÑ„Å´ÁîüÊàêÔºâ -->
            <div class="pot-display" id="potDisplay">Pot: $0</div>
            <div class="community-cards" id="communityCards"></div>
        </div>

        <div class="action-panel" id="actionPanel">
            <div class="action-buttons">
                <button class="action-btn fold" onclick="playerAction('fold')">Fold</button>
                <button class="action-btn check" id="checkBtn" onclick="playerAction('check')">Check</button>
                <button class="action-btn call" id="callBtn" onclick="playerAction('call')">Call</button>
                <button class="action-btn raise" onclick="playerAction('raise')">Raise</button>
                <button class="action-btn all-in" onclick="playerAction('allin')">All In</button>
            </div>
            <div class="raise-controls" id="raiseControls">
                <div class="increment-selector">
                    <input type="radio" name="increment" id="inc100" class="increment-radio" value="100" checked>
                    <label for="inc100" class="increment-label">+100</label>
                    <input type="radio" name="increment" id="inc1000" class="increment-radio" value="1000">
                    <label for="inc1000" class="increment-label">+1000</label>
                </div>
                <div class="raise-amount">
                    <button class="amount-btn" onclick="adjustRaise(-1)">‚ñº</button>
                    <div class="amount-display" id="raiseAmount">400</div>
                    <button class="amount-btn" onclick="adjustRaise(1)">‚ñ≤</button>
                </div>
            </div>
        </div>

        <div class="game-log" id="gameLog"></div>

        <div class="hand-ranking">
            <h3>„Éè„É≥„Éâ„É©„É≥„Ç≠„É≥„Ç∞</h3>
            <div class="hand-list">
                1. „É≠„Ç§„É§„É´„Éï„É©„ÉÉ„Ç∑„É•<br>
                2. „Çπ„Éà„É¨„Éº„Éà„Éï„É©„ÉÉ„Ç∑„É•<br>
                3. „Éï„Ç©„Éº„Ç´„Éº„Éâ<br>
                4. „Éï„É´„Éè„Ç¶„Çπ<br>
                5. „Éï„É©„ÉÉ„Ç∑„É•<br>
                6. „Çπ„Éà„É¨„Éº„Éà<br>
                7. „Çπ„É™„Éº„Ç´„Éº„Éâ<br>
                8. „ÉÑ„Éº„Éö„Ç¢<br>
                9. „ÉØ„É≥„Éö„Ç¢<br>
                10. „Éè„Ç§„Ç´„Éº„Éâ
            </div>
        </div>
    </div>

    <!-- ÁµêÊûú„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
    <div class="result-overlay" id="resultOverlay">
        <div class="result-content">
            <div class="result-title" id="resultTitle"></div>
            <div class="result-message" id="resultMessage"></div>
            <div class="result-buttons">
                <button class="result-btn primary" onclick="restartGame()">ÂÜçÊåëÊà¶</button>
                <button class="result-btn" onclick="backToMenu()">Èõ£ÊòìÂ∫¶ÈÅ∏Êäû</button>
            </div>
        </div>
    </div>

    <script>
// „Ç≤„Éº„É†Ë®≠ÂÆö
const INITIAL_CHIPS = 10000;
const SMALL_BLIND = 100;
const BIG_BLIND = 200;
const PLAYER_NAMES = ['„ÅÇ„Å™„Åü', 'CPU1', 'CPU2', 'CPU3', 'CPU4'];

// „Ç≤„Éº„É†Áä∂ÊÖã
let difficulty = 'normal';
let players = [];
let deck = [];
let communityCards = [];
let pot = 0;
let currentBet = 0;
let dealerPosition = 0;
let currentPlayerIndex = 0;
let gamePhase = 'preflop'; // preflop, flop, turn, river, showdown
let roundBets = [];
let soundEnabled = true;
let volume = 0.5;

// „Çµ„Ç¶„É≥„ÉâË®≠ÂÆö
function toggleSound() {
    soundEnabled = !soundEnabled;
    const btn = document.getElementById('soundToggle');
    btn.textContent = soundEnabled ? 'üîä ON' : 'üîá OFF';
    btn.classList.toggle('off', !soundEnabled);
    localStorage.setItem('soundEnabled', soundEnabled);
}

function changeVolume(value) {
    volume = value / 100;
    document.getElementById('volumeDisplay').textContent = value + '%';
    localStorage.setItem('volume', volume);
}

// localStorage „Åã„ÇâË®≠ÂÆö„ÇíË™≠„ÅøËæº„Åø
window.addEventListener('load', () => {
    const savedSound = localStorage.getItem('soundEnabled');
    const savedVolume = localStorage.getItem('volume');
    if (savedSound !== null) {
        soundEnabled = savedSound === 'true';
        const btn = document.getElementById('soundToggle');
        btn.textContent = soundEnabled ? 'üîä ON' : 'üîá OFF';
        btn.classList.toggle('off', !soundEnabled);
    }
    if (savedVolume !== null) {
        volume = parseFloat(savedVolume);
        const slider = document.getElementById('volumeSlider');
        slider.value = volume * 100;
        document.getElementById('volumeDisplay').textContent = Math.round(volume * 100) + '%';
    }
});

// „Çµ„Ç¶„É≥„ÉâÂÜçÁîüÔºàÂÆüË£Ö„ÅØ„Ç∑„É≥„Éó„É´„Å´Ôºâ
function playSound(type) {
    if (!soundEnabled) return;
    // ÂÆüÈöõ„ÅÆ„Çµ„Ç¶„É≥„Éâ„Éï„Ç°„Ç§„É´„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„Åì„Åì„ÅßÂÜçÁîü
    console.log(`Playing sound: ${type} at volume ${volume}`);
}

// „Ç≤„Éº„É†ÈñãÂßã
function startGame(selectedDifficulty) {
    difficulty = selectedDifficulty;
    initGame();
    document.getElementById('difficultyScreen').style.display = 'none';
    document.getElementById('gameScreen').style.display = 'block';
    startNewRound();
}

// „Ç≤„Éº„É†ÂàùÊúüÂåñ
function initGame() {
    players = PLAYER_NAMES.map((name, index) => ({
        id: index,
        name: name,
        chips: INITIAL_CHIPS,
        cards: [],
        bet: 0,
        folded: false,
        allIn: false,
        isDealer: false,
        isSmallBlind: false,
        isBigBlind: false,
        isActive: true
    }));
    
    dealerPosition = 0;
    renderPlayers();
    addLog('„Ç≤„Éº„É†ÈñãÂßãÔºÅÂàùÊúü„ÉÅ„ÉÉ„Éó: $' + INITIAL_CHIPS);
}

// „Éó„É¨„Ç§„É§„ÉºË°®Á§∫„Çí‰ΩúÊàê
function renderPlayers() {
    const table = document.getElementById('pokerTable');
    // Êó¢Â≠ò„ÅÆ„Éó„É¨„Ç§„É§„ÉºÂ∏≠„ÇíÂâäÈô§
    document.querySelectorAll('.player-seat').forEach(el => el.remove());
    
    players.forEach((player, index) => {
        if (!player.isActive) return;
        
        const seat = document.createElement('div');
        seat.className = `player-seat seat-${index}`;
        seat.id = `player-${index}`;
        
        seat.innerHTML = `
            <div class="player-info" id="info-${index}">
                ${player.isDealer ? '<div class="dealer-button">D</div>' : ''}
                ${player.isSmallBlind ? '<div class="blind-indicator">SB</div>' : ''}
                ${player.isBigBlind ? '<div class="blind-indicator">BB</div>' : ''}
                <div class="player-name">${player.name}</div>
                <div class="player-chips" id="chips-${index}">üí∞ $${player.chips}</div>
                <div class="player-bet" id="bet-${index}">${player.bet > 0 ? 'Bet: $' + player.bet : ''}</div>
                <div class="player-cards" id="cards-${index}"></div>
                <div class="player-status" id="status-${index}"></div>
            </div>
        `;
        
        table.appendChild(seat);
    });
}

// Êñ∞„Åó„ÅÑ„É©„Ç¶„É≥„ÉâÈñãÂßã
function startNewRound() {
    // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Éó„É¨„Ç§„É§„Éº„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    const activePlayers = players.filter(p => p.isActive);
    if (activePlayers.length === 1) {
        endGame(activePlayers[0]);
        return;
    }
    
    // Áä∂ÊÖã„É™„Çª„ÉÉ„Éà
    deck = createDeck();
    communityCards = [];
    pot = 0;
    currentBet = 0;
    gamePhase = 'preflop';
    roundBets = players.map(() => 0);
    
    players.forEach(player => {
        player.cards = [];
        player.bet = 0;
        player.folded = false;
        player.allIn = false;
        player.isDealer = false;
        player.isSmallBlind = false;
        player.isBigBlind = false;
    });
    
    // „Éá„Ç£„Éº„É©„Éº„Éª„Éñ„É©„Ç§„É≥„Éâ„ÇíË®≠ÂÆö
    setPositions();
    
    // „Ç´„Éº„Éâ„ÇíÈÖç„Çã
    dealCards();
    
    // „Éñ„É©„Ç§„É≥„Éâ„ÇíÂæ¥Âèé
    collectBlinds();
    
    // „Éó„É™„Éï„É≠„ÉÉ„ÉóÈñãÂßã
    currentPlayerIndex = (dealerPosition + 3) % players.length;
    // „Çπ„Ç≠„ÉÉ„Éó„Åó„Å¶Ê¨°„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Éó„É¨„Ç§„É§„Éº„Å∏
    while (!players[currentPlayerIndex].isActive || players[currentPlayerIndex].folded) {
        currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
    }
    
    updateDisplay();
    playSound('shuffle');
    addLog('--- Êñ∞„Åó„ÅÑ„É©„Ç¶„É≥„ÉâÈñãÂßã ---');
    
    if (currentPlayerIndex !== 0) {
        setTimeout(() => cpuTurn(), 1000);
    }
}

// „Éá„ÉÉ„Ç≠„Çí‰ΩúÊàê
function createDeck() {
    const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
    const suitNames = ['spades', 'hearts', 'diamonds', 'clubs'];
    const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    const deck = [];
    
    suits.forEach((suit, suitIndex) => {
        values.forEach(value => {
            deck.push({
                suit: suit,
                suitName: suitNames[suitIndex],
                value: value,
                numValue: value === 'A' ? 14 : (value === 'K' ? 13 : (value === 'Q' ? 12 : (value === 'J' ? 11 : parseInt(value))))
            });
        });
    });
    
    // „Ç∑„É£„ÉÉ„Éï„É´
    for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
    }
    
    return deck;
}

// „Éù„Ç∏„Ç∑„Éß„É≥Ë®≠ÂÆö
function setPositions() {
    // „Éá„Ç£„Éº„É©„Éº„Éú„Çø„É≥„ÇíÊ¨°„ÅÆ‰∫∫„Å´
    do {
        dealerPosition = (dealerPosition + 1) % players.length;
    } while (!players[dealerPosition].isActive);
    
    players[dealerPosition].isDealer = true;
    
    // „Çπ„É¢„Éº„É´„Éñ„É©„Ç§„É≥„Éâ
    let sbPos = (dealerPosition + 1) % players.length;
    while (!players[sbPos].isActive) {
        sbPos = (sbPos + 1) % players.length;
    }
    players[sbPos].isSmallBlind = true;
    
    // „Éì„ÉÉ„Ç∞„Éñ„É©„Ç§„É≥„Éâ
    let bbPos = (sbPos + 1) % players.length;
    while (!players[bbPos].isActive) {
        bbPos = (bbPos + 1) % players.length;
    }
    players[bbPos].isBigBlind = true;
}

// „Ç´„Éº„Éâ„ÇíÈÖç„Çã
function dealCards() {
    players.forEach(player => {
        if (player.isActive && !player.folded) {
            player.cards = [deck.pop(), deck.pop()];
        }
    });
}

// „Éñ„É©„Ç§„É≥„ÉâÂæ¥Âèé
function collectBlinds() {
    const sbPlayer = players.find(p => p.isSmallBlind);
    const bbPlayer = players.find(p => p.isBigBlind);
    
    const sbAmount = Math.min(SMALL_BLIND, sbPlayer.chips);
    const bbAmount = Math.min(BIG_BLIND, bbPlayer.chips);
    
    sbPlayer.chips -= sbAmount;
    sbPlayer.bet = sbAmount;
    pot += sbAmount;
    
    bbPlayer.chips -= bbAmount;
    bbPlayer.bet = bbAmount;
    pot += bbAmount;
    
    currentBet = BIG_BLIND;
    
    addLog(`${sbPlayer.name} „Åå„Çπ„É¢„Éº„É´„Éñ„É©„Ç§„É≥„Éâ $${sbAmount} „ÇíÊîØÊâï„ÅÑ„Åæ„Åó„Åü`);
    addLog(`${bbPlayer.name} „Åå„Éì„ÉÉ„Ç∞„Éñ„É©„Ç§„É≥„Éâ $${bbAmount} „ÇíÊîØÊâï„ÅÑ„Åæ„Åó„Åü`);
}

// Ë°®Á§∫Êõ¥Êñ∞
function updateDisplay() {
    // „Éù„ÉÉ„ÉàË°®Á§∫
    document.getElementById('potDisplay').textContent = `Pot: $${pot}`;
    
    // „Éó„É¨„Ç§„É§„ÉºÊÉÖÂ†±Êõ¥Êñ∞
    players.forEach((player, index) => {
        if (!player.isActive) return;
        
        const infoEl = document.getElementById(`info-${index}`);
        if (infoEl) {
            infoEl.className = 'player-info';
            if (index === currentPlayerIndex) infoEl.classList.add('active');
            if (player.folded) infoEl.classList.add('folded');
            if (player.allIn) infoEl.classList.add('all-in');
        }
        
        document.getElementById(`chips-${index}`).textContent = `üí∞ $${player.chips}`;
        document.getElementById(`bet-${index}`).textContent = player.bet > 0 ? `Bet: $${player.bet}` : '';
        
        // „Ç´„Éº„ÉâË°®Á§∫
        const cardsEl = document.getElementById(`cards-${index}`);
        if (cardsEl) {
            if (index === 0 && player.cards.length > 0) {
                // „Éó„É¨„Ç§„É§„Éº„ÅÆ„Ç´„Éº„Éâ„ÅØË°®Á§∫
                cardsEl.innerHTML = player.cards.map(card => 
                    `<div class="card ${card.suitName}">
                        <div class="card-value">${card.value}</div>
                        <div class="card-suit">${card.suit}</div>
                    </div>`
                ).join('');
            } else if (player.cards.length > 0 && !player.folded) {
                // CPU„ÅÆ„Ç´„Éº„Éâ„ÅØË£èÂêë„Åç
                cardsEl.innerHTML = '<div class="card back"></div><div class="card back"></div>';
            } else {
                cardsEl.innerHTML = '';
            }
        }
        
        // „Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫
        const statusEl = document.getElementById(`status-${index}`);
        if (statusEl) {
            if (player.folded) statusEl.textContent = 'Folded';
            else if (player.allIn) statusEl.textContent = 'All In!';
            else statusEl.textContent = '';
        }
    });
    
    // „Ç≥„Éü„É•„Éã„ÉÜ„Ç£„Ç´„Éº„ÉâË°®Á§∫
    const communityEl = document.getElementById('communityCards');
    communityEl.innerHTML = communityCards.map(card =>
        `<div class="card ${card.suitName}">
            <div class="card-value">${card.value}</div>
            <div class="card-suit">${card.suit}</div>
        </div>`
    ).join('');
    
    // „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥„ÅÆÊúâÂäπ/ÁÑ°Âäπ
    updateActionButtons();
    
    renderPlayers();
}

// „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥„ÅÆÊõ¥Êñ∞
function updateActionButtons() {
    const player = players[0];
    const canCheck = currentBet === player.bet;
    const callAmount = currentBet - player.bet;
    
    document.getElementById('checkBtn').style.display = canCheck ? 'inline-block' : 'none';
    document.getElementById('callBtn').style.display = !canCheck ? 'inline-block' : 'none';
    if (!canCheck) {
        document.getElementById('callBtn').textContent = `Call $${callAmount}`;
    }
    
    // „É¨„Ç§„Ç∫„Ç≥„É≥„Éà„É≠„Éº„É´
    const minRaise = currentBet === 0 ? BIG_BLIND : currentBet * 2;
    document.getElementById('raiseAmount').textContent = minRaise;
}

// „Éó„É¨„Ç§„É§„Éº„Ç¢„ÇØ„Ç∑„Éß„É≥
function playerAction(action) {
    if (currentPlayerIndex !== 0) return;
    
    const player = players[0];
    
    switch(action) {
        case 'fold':
            player.folded = true;
            addLog(`${player.name} „Åå„Éï„Ç©„Éº„É´„Éâ„Åó„Åæ„Åó„Åü`);
            playSound('click');
            break;
            
        case 'check':
            addLog(`${player.name} „Åå„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Åæ„Åó„Åü`);
            playSound('click');
            break;
            
        case 'call':
            const callAmount = Math.min(currentBet - player.bet, player.chips);
            player.chips -= callAmount;
            player.bet += callAmount;
            pot += callAmount;
            addLog(`${player.name} „Åå $${callAmount} „Çí„Ç≥„Éº„É´„Åó„Åæ„Åó„Åü`);
            playSound('chips');
            break;
            
        case 'raise':
            const raiseAmount = parseInt(document.getElementById('raiseAmount').textContent);
            const totalBet = raiseAmount - player.bet;
            if (totalBet > player.chips) {
                alert('„ÉÅ„ÉÉ„Éó„ÅåË∂≥„Çä„Åæ„Åõ„ÇìÔºÅ');
                return;
            }
            player.chips -= totalBet;
            player.bet = raiseAmount;
            pot += totalBet;
            currentBet = raiseAmount;
            addLog(`${player.name} „Åå $${raiseAmount} „Å´„É¨„Ç§„Ç∫„Åó„Åæ„Åó„Åü`);
            playSound('chips');
            break;
            
        case 'allin':
            const allInAmount = player.chips;
            player.chips = 0;
            player.bet += allInAmount;
            pot += allInAmount;
            if (player.bet > currentBet) currentBet = player.bet;
            player.allIn = true;
            addLog(`${player.name} „Åå„Ç™„Éº„É´„Ç§„É≥ÔºÅ $${allInAmount}`);
            playSound('chips');
            break;
    }
    
    updateDisplay();
    nextPlayer();
}

// „É¨„Ç§„Ç∫ÈáëÈ°çË™øÊï¥
function adjustRaise(direction) {
    const incrementRadios = document.getElementsByName('increment');
    let increment = 100;
    for (const radio of incrementRadios) {
        if (radio.checked) {
            increment = parseInt(radio.value);
            break;
        }
    }
    
    const currentAmount = parseInt(document.getElementById('raiseAmount').textContent);
    const minRaise = currentBet === 0 ? BIG_BLIND : currentBet * 2;
    const maxRaise = players[0].chips + players[0].bet;
    
    let newAmount = currentAmount + (increment * direction);
    newAmount = Math.max(minRaise, Math.min(maxRaise, newAmount));
    
    document.getElementById('raiseAmount').textContent = newAmount;
}

// Ê¨°„ÅÆ„Éó„É¨„Ç§„É§„Éº„Å∏
function nextPlayer() {
    const activePlayers = players.filter(p => p.isActive && !p.folded && !p.allIn);
    
    if (activePlayers.length === 1) {
        // 1‰∫∫„Åó„ÅãÊÆã„Å£„Å¶„ÅÑ„Å™„ÅÑ
        endRound();
        return;
    }
    
    // ÂÖ®Âì°„Åå„Éô„ÉÉ„Éà„ÇíÊèÉ„Åà„Åü„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    const allBetsEqual = activePlayers.every(p => p.bet === currentBet || p.allIn);
    
    let nextIndex = (currentPlayerIndex + 1) % players.length;
    while (!players[nextIndex].isActive || players[nextIndex].folded || players[nextIndex].allIn) {
        nextIndex = (nextIndex + 1) % players.length;
        if (nextIndex === currentPlayerIndex) break;
    }
    
    // ÂÖ®Âì°„Åå„Ç¢„ÇØ„Ç∑„Éß„É≥ÂÆå‰∫Ü
    if (allBetsEqual && nextIndex === currentPlayerIndex) {
        nextPhase();
        return;
    }
    
    currentPlayerIndex = nextIndex;
    updateDisplay();
    
    if (currentPlayerIndex !== 0) {
        setTimeout(() => cpuTurn(), 1000);
    }
}

// CPU„ÅÆ„Çø„Éº„É≥
function cpuTurn() {
    const cpu = players[currentPlayerIndex];
    if (!cpu.isActive || cpu.folded || cpu.allIn) {
        nextPlayer();
        return;
    }
    
    // Èõ£ÊòìÂ∫¶Âà•„ÅÆAI
    const action = decideCpuAction(cpu);
    executeCpuAction(cpu, action);
    
    updateDisplay();
    setTimeout(() => nextPlayer(), 800);
}

// CPU„ÅÆË°åÂãïÊ±∫ÂÆö
function decideCpuAction(cpu) {
    const callAmount = currentBet - cpu.bet;
    const hand = evaluateHand(cpu.cards, communityCards);
    
    // Á∞°ÊòìAIÔºàÈõ£ÊòìÂ∫¶„Å´„Çà„ÇäË™øÊï¥Ôºâ
    let aggression = difficulty === 'easy' ? 0.3 : (difficulty === 'normal' ? 0.5 : 0.7);
    let bluffChance = difficulty === 'easy' ? 0.1 : (difficulty === 'normal' ? 0.2 : 0.4);
    
    const random = Math.random();
    
    // „Éè„É≥„Éâ„ÅåÂº∑„ÅÑÂ†¥Âêà
    if (hand.rank >= 7 || random < bluffChance) {
        if (random < aggression) {
            return { type: 'raise', amount: currentBet + BIG_BLIND * 2 };
        } else {
            return { type: 'call' };
        }
    }
    
    // „Éè„É≥„Éâ„Åå‰∏≠Á®ãÂ∫¶
    if (hand.rank >= 4) {
        if (callAmount <= cpu.chips * 0.1) {
            return { type: 'call' };
        } else {
            return { type: 'fold' };
        }
    }
    
    // „Éè„É≥„Éâ„ÅåÂº±„ÅÑ
    if (callAmount === 0) {
        return { type: 'check' };
    } else {
        return { type: 'fold' };
    }
}

// CPU„Ç¢„ÇØ„Ç∑„Éß„É≥ÂÆüË°å
function executeCpuAction(cpu, action) {
    switch(action.type) {
        case 'fold':
            cpu.folded = true;
            addLog(`${cpu.name} „Åå„Éï„Ç©„Éº„É´„Éâ„Åó„Åæ„Åó„Åü`);
            break;
        case 'check':
            addLog(`${cpu.name} „Åå„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Åæ„Åó„Åü`);
            break;
        case 'call':
            const callAmount = Math.min(currentBet - cpu.bet, cpu.chips);
            cpu.chips -= callAmount;
            cpu.bet += callAmount;
            pot += callAmount;
            addLog(`${cpu.name} „Åå $${callAmount} „Çí„Ç≥„Éº„É´„Åó„Åæ„Åó„Åü`);
            break;
        case 'raise':
            const raiseAmount = Math.min(action.amount, cpu.chips + cpu.bet);
            const totalBet = raiseAmount - cpu.bet;
            cpu.chips -= totalBet;
            cpu.bet = raiseAmount;
            pot += totalBet;
            currentBet = raiseAmount;
            addLog(`${cpu.name} „Åå $${raiseAmount} „Å´„É¨„Ç§„Ç∫„Åó„Åæ„Åó„Åü`);
            break;
    }
}

// Ê¨°„ÅÆ„Éï„Çß„Éº„Ç∫„Å∏
function nextPhase() {
    players.forEach(p => p.bet = 0);
    currentBet = 0;
    
    switch(gamePhase) {
        case 'preflop':
            // „Éï„É≠„ÉÉ„Éó
            communityCards = [deck.pop(), deck.pop(), deck.pop()];
            gamePhase = 'flop';
            addLog('--- „Éï„É≠„ÉÉ„Éó ---');
            playSound('card');
            break;
        case 'flop':
            // „Çø„Éº„É≥
            communityCards.push(deck.pop());
            gamePhase = 'turn';
            addLog('--- „Çø„Éº„É≥ ---');
            playSound('card');
            break;
        case 'turn':
            // „É™„Éê„Éº
            communityCards.push(deck.pop());
            gamePhase = 'river';
            addLog('--- „É™„Éê„Éº ---');
            playSound('card');
            break;
        case 'river':
            // „Ç∑„Éß„Éº„ÉÄ„Ç¶„É≥
            gamePhase = 'showdown';
            showdown();
            return;
    }
    
    // Ê¨°„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Éó„É¨„Ç§„É§„Éº„Åã„ÇâÈñãÂßã
    currentPlayerIndex = (dealerPosition + 1) % players.length;
    while (!players[currentPlayerIndex].isActive || players[currentPlayerIndex].folded || players[currentPlayerIndex].allIn) {
        currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
    }
    
    updateDisplay();
    
    if (currentPlayerIndex !== 0) {
        setTimeout(() => cpuTurn(), 1000);
    }
}

// „É©„Ç¶„É≥„ÉâÁµÇ‰∫Ü
function endRound() {
    const winner = players.find(p => p.isActive && !p.folded);
    winner.chips += pot;
    addLog(`${winner.name} „Åå $${pot} „ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ`);
    playSound('win');
    
    setTimeout(() => {
        checkGameEnd();
    }, 3000);
}

// „Ç∑„Éß„Éº„ÉÄ„Ç¶„É≥
function showdown() {
    addLog('--- „Ç∑„Éß„Éº„ÉÄ„Ç¶„É≥ ---');
    
    const activePlayers = players.filter(p => p.isActive && !p.folded);
    const hands = activePlayers.map(p => ({
        player: p,
        hand: evaluateHand(p.cards, communityCards)
    }));
    
    // ÊúÄÂº∑„ÅÆ„Éè„É≥„Éâ„ÇíË¶ã„Å§„Åë„Çã
    hands.sort((a, b) => compareHands(b.hand, a.hand));
    
    const winner = hands[0].player;
    winner.chips += pot;
    
    addLog(`${winner.name} „Åå ${hands[0].hand.name} „Åß $${pot} „ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ`);
    playSound('win');
    
    setTimeout(() => {
        checkGameEnd();
    }, 4000);
}

// „Ç≤„Éº„É†ÁµÇ‰∫Ü„ÉÅ„Çß„ÉÉ„ÇØ
function checkGameEnd() {
    // „ÉÅ„ÉÉ„Éó0„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÇíÈÄÄÂ†¥„Åï„Åõ„Çã
    players.forEach(p => {
        if (p.chips === 0) {
            p.isActive = false;
            if (p.id === 0) {
                // „Éó„É¨„Ç§„É§„Éº„ÅåÁ†¥Áî£
                showResult('üí∏ Á†¥Áî£', '„ÉÅ„ÉÉ„Éó„Åå„Å™„Åè„Å™„Çä„Åæ„Åó„Åü...');
            } else {
                addLog(`${p.name} „ÅåÁ†¥Áî£„Åó„Åæ„Åó„Åü`);
            }
        }
    });
    
    const activePlayers = players.filter(p => p.isActive);
    
    if (activePlayers.length === 1) {
        if (activePlayers[0].id === 0) {
            showResult('üéâ ÂÑ™ÂãùÔºÅ', '„Åô„Åπ„Å¶„ÅÆÁõ∏Êâã„ÇíÂÄí„Åó„Åæ„Åó„ÅüÔºÅ');
        }
        return;
    }
    
    // Ê¨°„ÅÆ„É©„Ç¶„É≥„Éâ„Å∏
    setTimeout(() => startNewRound(), 2000);
}

// ÁµêÊûúË°®Á§∫
function showResult(title, message) {
    document.getElementById('resultTitle').textContent = title;
    document.getElementById('resultMessage').textContent = message;
    document.getElementById('resultOverlay').style.display = 'flex';
}

// „Ç≤„Éº„É†ÂÜç„Çπ„Çø„Éº„Éà
function restartGame() {
    document.getElementById('resultOverlay').style.display = 'none';
    initGame();
    startNewRound();
}

// „É°„Éã„É•„Éº„Å´Êàª„Çã
function backToMenu() {
    document.getElementById('resultOverlay').style.display = 'none';
    document.getElementById('gameScreen').style.display = 'none';
    document.getElementById('difficultyScreen').style.display = 'flex';
}

// „É≠„Ç∞ËøΩÂä†
function addLog(message) {
    const logEl = document.getElementById('gameLog');
    const entry = document.createElement('div');
    entry.className = 'log-entry';
    entry.textContent = message;
    logEl.insertBefore(entry, logEl.firstChild);
    
    // ÊúÄÂ§ß20„Ç®„É≥„Éà„É™„Éº„Åæ„Åß
    while (logEl.children.length > 20) {
        logEl.removeChild(logEl.lastChild);
    }
}

// „Éè„É≥„ÉâË©ï‰æ°ÔºàÁ∞°ÊòìÁâàÔºâ
function evaluateHand(holeCards, community) {
    const allCards = [...holeCards, ...community];
    if (allCards.length < 2) return { rank: 0, name: '„Éè„Ç§„Ç´„Éº„Éâ' };
    
    // Á∞°ÊòìË©ï‰æ°ÔºàÊú¨Êù•„ÅØ„ÇÇ„Å£„Å®Ë§áÈõëÔºâ
    const values = allCards.map(c => c.numValue);
    const suits = allCards.map(c => c.suit);
    
    // Âêå„ÅòÊï∞Â≠ó„ÅÆ„Ç´„Ç¶„É≥„Éà
    const valueCounts = {};
    values.forEach(v => {
        valueCounts[v] = (valueCounts[v] || 0) + 1;
    });
    
    const counts = Object.values(valueCounts).sort((a, b) => b - a);
    
    // „Éö„Ç¢Âà§ÂÆö
    if (counts[0] === 4) return { rank: 8, name: '„Éï„Ç©„Éº„Ç´„Éº„Éâ' };
    if (counts[0] === 3 && counts[1] === 2) return { rank: 7, name: '„Éï„É´„Éè„Ç¶„Çπ' };
    if (counts[0] === 3) return { rank: 4, name: '„Çπ„É™„Éº„Ç´„Éº„Éâ' };
    if (counts[0] === 2 && counts[1] === 2) return { rank: 3, name: '„ÉÑ„Éº„Éö„Ç¢' };
    if (counts[0] === 2) return { rank: 2, name: '„ÉØ„É≥„Éö„Ç¢' };
    
    return { rank: 1, name: '„Éè„Ç§„Ç´„Éº„Éâ' };
}

// „Éè„É≥„ÉâÊØîËºÉ
function compareHands(hand1, hand2) {
    return hand1.rank - hand2.rank;
}

console.log('Texas Hold\'em Poker loaded successfully!');
    </script>
</body>
</html>
